<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>展示轮廓</title>
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #mapContainer {
            width: 100vw;
            height: 100vh;
            position: relative;
        }

        #mapLoading {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 999;
            transition: opacity 0.3s;
        }

        .loading-text {
            font-size: 16px;
            color: #333;
            padding: 10px 20px;
            background: white;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .wkt-input-container {
            position: absolute;
            top: 20px;
            right: 10px;
            z-index: 1000;
            background: white;
            padding: 12px;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            width: min(320px, 90vw);
            box-sizing: border-box;
            transition: all 0.3s;
        }

        .minimize-btn {
            position: absolute;
            top: -5px;
            right: -4px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #f0f0f0;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: #666;
            z-index: 1001;
            transition: background 0.2s;
        }

        .minimize-btn:hover {
            background: #e0e0e0;
        }

        .content-wrapper {
            transition: all 0.3s;
        }

        .wkt-input-container.minimized {
            width: 40px;
            height: 40px;
            padding: 0;
        }

        .wkt-input-container.minimized .content-wrapper {
            display: none;
        }

        .wkt-input-container.minimized .min-icon {
            display: none;
        }

        .wkt-input-container.minimized .restore-icon {
            display: inline;
        }

        #wktTextarea {
            width: 100%;
            height: 120px;
            margin-bottom: 10px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
            resize: vertical;
            box-sizing: border-box;
        }

        .button-group {
            display: flex;
            gap: 10px;
        }

        /* 页签样式 */
        .tabs-header {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
        }
        .tab-btn {
            flex: 1;
            padding: 6px 0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            background: #f5f5f5;
            color: #333;
            transition: background 0.2s;
        }
        .tab-btn.active { background: #337AFF; color: #fff; }
        .tab-pane { display: none; }
        .tab-pane.active { display: block; }

        /* Multi → Polygons 分割器样式 */
        .split-section {
            margin-top: 10px;
            padding: 10px;
            background: #fafafa;
            border: 1px solid #eee;
            border-radius: 6px;
        }
        .split-section .title {
            font-size: 13px;
            font-weight: 600;
            color: #333;
            margin-bottom: 6px;
        }
        .split-section .desc {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
        }
        #multiInput, #polyOutput {
            width: 100%;
            height: 90px;
            margin-bottom: 8px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
            resize: vertical;
            box-sizing: border-box;
        }
        .split-actions {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
        }
        .split-actions button {
            flex: 1;
            padding: 6px 0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: background 0.2s;
        }
        #splitMultiBtn { background: #337AFF; color: #fff; }
        #splitMultiBtn:hover { background: #2860E0; }
        #copyPolysBtn { background: #f5f5f5; color: #333; }
        #copyPolysBtn:hover { background: #e0e0e0; }
        #drawButton,
        #clearButton,
        #drawTrackButton,
        #clearTrackButton {
            width: 50%;
            padding: 8px 0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }

        #drawButton,
        #drawTrackButton {
            background: #337AFF;
            color: white;
        }

        #drawButton:hover,
        #drawTrackButton:hover {
            background: #2860E0;
        }

        #clearButton,
        #clearTrackButton {
            background: #f5f5f5;
            color: #333;
        }

        #clearButton:hover,
        #clearTrackButton:hover {
            background: #e0e0e0;
        }

        #drawButton:disabled,
        #clearButton:disabled,
        #drawTrackButton:disabled,
        #clearTrackButton:disabled {
            background: #e0e0e0;
            color: #999;
            cursor: not-allowed;
        }

        .tip {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .area-label {
             position: absolute;
             background: rgba(255, 0, 0, 0.85);
             border: 1px solid #000;
             border-radius: 3px;
             padding: 4px 6px;
             font-size: 12px;
             color: #fff;
             font-weight: 600;
             box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25);
             white-space: nowrap;
             z-index: 9999;
             pointer-events: none;
         }
         /* 默认隐藏标签容器下的标签 */
          .labels-hidden .area-label { display: none; }

          /* Batch → Generator 样式 */
          .batch-section { margin-top: 10px; padding: 10px; background: #fafafa; border: 1px solid #eee; border-radius: 6px; }
          .batch-section .title { font-size: 13px; font-weight: 600; color: #333; margin-bottom: 6px; }
          .batch-section .desc { font-size: 12px; color: #666; margin-bottom: 8px; }
          #batchInput, #multiOutput { width: 100%; height: 90px; margin-bottom: 8px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace; resize: vertical; box-sizing: border-box; }
          .batch-actions { display: flex; gap: 8px; margin-bottom: 8px; }
          .batch-actions button { flex: 1; padding: 6px 0; border: none; border-radius: 4px; cursor: pointer; font-size: 13px; transition: background 0.2s; }
          #generateMultiBtn { background: #337AFF; color: #fff; }
          #generateMultiBtn:hover { background: #2860E0; }
          #copyMultiBtn { background: #f5f5f5; color: #333; }
          #copyMultiBtn:hover { background: #e0e0e0; }
          
          /* 左侧工具条样式 */
          #leftToolbar {
              position: absolute;
              bottom: 20px;
              left: 20px;
              z-index: 1000;
              background: white;
              border-radius: 4px;
              box-shadow: 0 1px 4px rgba(0, 0, 0, 0.15);
              padding: 6px 0;
              display: flex;
              flex-direction: column;
              gap: 2px;
              width: 40px;
          }
          
          .toolbar-btn {
              width: 100%;
              padding: 6px 0;
              border: none;
              background: transparent;
              cursor: pointer;
              font-size: 12px;
              color: #333;
              transition: background 0.2s;
              display: flex;
              flex-direction: column;
              align-items: center;
              justify-content: center;
          }
          
          .toolbar-btn:hover {
              background: #f5f5f5;
          }
          
          .toolbar-btn span {
              font-size: 12px;
              margin-top: 4px;
          }
          
          .toolbar-divider {
            height: 1px;
            background-color: #e0e0e0;
            margin: 2px 4px;
        }
        
        /* 颜色选择器样式 */
        .color-picker-container {
            margin-top: 10px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 4px;
            border: 1px solid #e0e0e0;
        }
        
        .color-picker-title {
            font-size: 13px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }
        
        .color-picker-row {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .color-picker-label {
            font-size: 12px;
            color: #555;
            width: 60px;
            flex-shrink: 0;
        }
        
        .color-picker {
            width: 30px;
            height: 30px;
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 8px;
            flex-shrink: 0;
        }
        
        .color-input {
            flex: 1;
            padding: 4px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
            font-family: monospace;
        }
        
        .opacity-slider-container {
            display: flex;
            align-items: center;
            margin-top: 8px;
        }
        
        .opacity-slider {
            flex: 1;
            margin-right: 8px;
        }
        
        .opacity-value {
            font-size: 12px;
            color: #555;
            width: 40px;
            text-align: right;
        }
      </style>
    <script src="https://api.tianditu.gov.cn/api?v=4.0&tk=648f621977051d0199ff0f965d3fd322"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/Turf.js/6.5.0/turf.min.js"></script>
    <script src="https://lib.baomitu.com/terraformer/1.0.12/terraformer.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://unpkg.com/terraformer-wkt-parser@1.2.1/terraformer-wkt-parser.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- 已移除动态备用加载器 ensureTerraformer：改为仅使用静态脚本标签加载 Terraformer 核心库与 WKT 解析器 -->
    <script>
        // 检查Turf.js是否加载成功
        window.addEventListener('load', function () {
            if (typeof turf === 'undefined') {
                console.warn('Turf.js加载失败，已启用备用面积算法');
            } else {
                console.log('Turf.js加载成功');
            }
        });
    </script>
</head>

<body>
<!-- 左侧工具条 -->
<div id="leftToolbar">
    <button class="toolbar-btn" id="measureDistanceBtn" title="测距">
        <span>测距</span>
    </button>
    <div class="toolbar-divider"></div>
    <button class="toolbar-btn" id="measureAreaBtn" title="测面">
        <span>测面</span>
    </button>
    <div class="toolbar-divider"></div>
    <button class="toolbar-btn" id="mapTypeBtn" title="切换地图类型">
        <span>地图</span>
    </button>
</div>

<div id="mapContainer">
    <div id="mapLoading">
        <div class="loading-text">地图正在加载中...</div>
    </div>
</div>

<div class="wkt-input-container">
    <div class="minimize-btn" id="minimizeBtn">
        <span class="min-icon">−</span>
        <span class="restore-icon" style="display:none;">+</span>
    </div>

    <div class="content-wrapper">
        <div class="tabs-header">
            <button class="tab-btn active" id="tabDrawBtn">轮廓</button>
            <button class="tab-btn" id="tabTrackBtn">轨迹</button>
            <button class="tab-btn" id="tabSplitBtn">分割器</button>
            <button class="tab-btn" id="tabBatchBtn">合并器</button>
        </div>
        <div class="tab-pane active" id="tabDraw">
            <div class="tip">请输入WKT字符串（支持POLYGON/MULTIPOLYGON）：</div>
            <textarea id="wktTextarea">MULTIPOLYGON (((124.52838888873373 45.287949319365765, 124.52838888422332 45.28794929684664, 124.528385357195 45.28792166849418, 124.52838535678245 45.287921631667814, 124.52838536488943 45.28792159528764, 124.52838538129843 45.28792156032909, 124.52842268811688 45.28785960435381, 124.52842272142514 45.28785956225319, 124.52842276668153 45.28785952613227, 124.52842282180569 45.287859497651496, 124.5284228842637 45.287859478120154, 124.52857686813991 45.28782470630332, 124.52857970629323 45.287823840836744, 124.52857973354457 45.28782383017857, 124.52858227796978 45.287822590492176, 124.5285823017515 45.28782257628619, 124.52858445466923 45.287821010019904, 124.52858447406827 45.28782099281141, 124.528586152743 45.2878191601561, 124.52858616701276 45.28781914060771, 124.52858730693437 45.28781711199069, 124.5285873155274 45.28781709085218, 124.52858787288885 45.28781494423331, 124.5285878754747 45.28781492231738, 124.52858782885716 45.28781274018955, 124.52858782533626 45.287812718338245, 124.52858764045898 45.287812110316786, 124.52858763337322 45.287812064818226, 124.52858763948392 45.28781201924927, 124.52858765853809 45.28781197549736, 124.52858768974636 45.287811935374684, 124.52858773181606 45.287811900543105, 124.52858778300494 45.287811872445346, 124.52858784119252 45.287811852245206, 124.52872539836385 45.287775842328195, 124.52872544408886 45.28777583303326, 124.52888726784775 45.2877520051144, 124.52889021791015 45.2877513522328, 124.52889024658096 45.28775134362861, 124.5288929595183 45.28775029703033, 124.52889298526034 45.28775028464308, 124.52889535681692 45.287748884548215, 124.52889537864104 45.287748868853804, 124.52889731767948 45.287747169067124, 124.52889733474643 45.28774715066918, 124.52889876675087 45.28774521651229, 124.52889877840543 45.287745196116994, 124.52889964834434 45.287743101919084, 124.5288996541381 45.28774308031143, 124.52889992858051 45.28774090655038, 124.52889992829115 45.28774088455996, 124.52889959669034 45.28773871477317, 124.52889959032888 45.28773869324475, 124.52889866542814 45.287736610815244, 124.52889865323955 45.28773659057739, 124.52889717058211 45.28773467553184, 124.52889715303407 45.28773465736102, 124.52889516959827 45.28773298329422, 124.52889514736515 45.28773296788887, 124.5288927393731 45.28773159913375, 124.52889271330945 45.28773158708617, 124.52888997329853 45.28773057624313, 124.52888994440673 45.28773056801652, 124.5288869776742 45.28772995393173, 124.52888694706346 45.28772994984191, 124.52888386761947 45.28772975611433, 124.52888383654431 45.287729756318086, 124.52888073184401 45.28772999382294, 124.52871773573032 45.28775399389155, 124.52871544960946 45.28775445925046, 124.52843679044973 45.2878274068319, 124.52843672565727 45.28782741850994, 124.52843665883888 45.28782742038452, 124.52843659293788 45.28782741237304, 124.52843653085716 45.28782739482844, 124.52843647533157 45.28782736852353, 124.5284364288069 45.2878273346171, 124.52843639333261 45.28782729460271, 124.52843559505095 45.287826140000675, 124.52843557929432 45.287826121824644, 124.52843378030067 45.28782443127812, 124.52843375995965 45.2878244155326, 124.52843154061435 45.28782299557276, 124.52843151642243 45.28782298282572, 124.52842895678069 45.28782188467287, 124.5284289296114 45.287821875384566, 124.52842612200382 45.28782113865088, 124.52842609283688 45.28782113315618, 124.5284231385392 45.28782078441711, 124.52842310842652 45.287820782914174, 124.52842011400551 45.28782083474929, 124.52842008410802 45.287820837286, 124.5284171283211 45.28782129335958, 124.5282401285763 45.28786129440093, 124.52823733488734 45.28786214310585, 124.52823730803279 45.28786215353531, 124.52823479707835 45.28786336499241, 124.52823477355992 45.287863378866284, 124.52823263872418 45.28786490802052, 124.52823261941519 45.28786492482353, 124.52823094009415 45.2878667148046, 124.52823092571343 45.28786673391132, 124.52822976436184 45.28786871814905, 124.52822975544422 45.28786873884874, 124.52822915525383 45.28787084354749, 124.52822915213088 45.287870865071056, 124.5282291354232 45.28787301195529, 124.52822913821105 45.287873033501654, 124.52822970560764 45.287875142728126, 124.5282297142027 45.287875163495926, 124.52823084460132 45.28787715661983, 124.52823085868415 45.28787717583748, 124.52823251004494 45.28787897873405, 124.5282325290911 45.287878995685666, 124.52823463999889 45.287880541303736, 124.5282346633008 45.287880555359585, 124.52823715524865 45.28788178621605, 124.52823718187301 45.287881796826774, 124.52823999086495 45.28788267498844, 124.52824593255855 45.287884068721446, 124.52824599073872 45.28788408711228, 124.5282460425679 45.28788411331075, 124.52824608597123 45.28788414626808, 124.52824611921143 45.28788418466497, 124.5282461409577 45.28788422696436, 124.52824615033961 45.28788427147301, 124.52824624310281 45.28788564885596, 124.5282462478181 45.2878856711549, 124.52824702852172 45.287887839872624, 124.52824703945906 45.28788786105529, 124.52824841879621 45.28788987575627, 124.52824843551356 45.287889894966895, 124.5282503577583 45.28789167425624, 124.52825037958065 45.28789169071911, 124.52825276707328 45.287893162712415, 124.52825279311831 45.28789317576197, 124.52825554940347 45.287894280990294, 124.5282555785463 45.287894290076785, 124.52825862320562 45.28789498982446, 124.52832344926213 45.28790496306388, 124.52832351630542 45.28790497905618, 124.52832357669418 45.28790500510046, 124.52832449008659 45.28790550522051, 124.52832451615137 45.28790551682328, 124.52832724857525 45.287906485778294, 124.52832727732232 45.28790649361251, 124.52833022327813 45.287907072142715, 124.5283302536268 45.287907075913765, 124.52833330236717 45.287907242270485, 124.52833333317595 45.28790724183657, 124.52833637008902 45.287906989765894, 124.52833640020016 45.28790698514334, 124.52833931111846 45.28790632412148, 124.52833933940032 45.28790631548392, 124.52834201489344 45.28790527036078, 124.52834204028218 45.28790525803313, 124.52834437977002 45.28790386809806, 124.52834440131105 45.28790385254392, 124.52834513981816 45.28790320388176, 124.5283451855482 45.287903171203034, 124.52834523972989 45.287903145764176, 124.52834530010344 45.28790312862631, 124.52834536415027 45.28790312050429, 124.52834542919904 45.28790312173689, 124.52834549253643 45.28790313227272, 124.52834555152046 45.28790315167228, 124.52834560369074 45.28790317912639, 124.52834564687122 45.287903213489884, 124.52834567926075 45.28790325332939, 124.52835234931396 45.287913833411295, 124.52835236659118 45.287913868276604, 124.52835237555104 45.28791390466788, 124.52835289233653 45.287917952837034, 124.52835289275218 45.28791798963391, 124.52835288466181 45.2879180259861, 124.52835286828213 45.28791806092047, 124.52835133407632 45.28792061158675, 124.52835040518977 45.287922708287425, 124.52835039882848 45.2879227299638, 124.52835007129791 45.28792491455533, 124.52835007109097 45.28792493663568, 124.52835036207894 45.28792714609065, 124.52835729452507 45.28795244956703, 124.52835729903548 45.287952472086175, 124.52836413313679 45.28800600595439, 124.52836424665816 45.28800667348665, 124.52837424977541 45.28805368090919, 124.52837500642592 45.288055796920474, 124.52837501697446 45.28805581761271, 124.52837634389712 45.28805778876279, 124.52837635996221 45.288057807605114, 124.52837820616543 45.288059558146635, 124.52837822712893 45.288059574414284, 124.52838052166395 45.288061037074776, 124.52838054672104 45.28806105014313, 124.52838124420913 45.28806134403415, 124.52838129383842 45.28806136984866, 124.52838133549606 45.28806140192655, 124.52838136762252 45.288061439066894, 124.528381389015 45.28806147987929, 124.52838139887275 45.288061522835825, 124.52838139682672 45.28806156632835, 124.5283813829535 45.28806160872862, 124.52838135777245 45.288061648449286, 124.52838132222614 45.28806168400335, 124.5283812776456 45.288061714059744, 124.52838099437082 45.288061871035424, 124.52838097186935 45.288061886244925, 124.52837895919802 45.288063542840874, 124.52837894133202 45.288063560857275, 124.52837742517558 45.28806546279141, 124.52837741263215 45.288065482921915, 124.52837645125527 45.28806755710412, 124.52837644451644 45.288067578575365, 124.52837607486431 45.288069745297, 124.52837607419085 45.28806976722749, 124.52837631437033 45.28807196511663, 124.52838431587212 45.288103964931196, 124.5283843924381 45.28810415807581, 124.52838440204135 45.28810419239868, 124.52838443524605 45.288104391585115, 124.52838444190208 45.2881044130686, 124.5283848172559 45.288105230405215, 124.52838514900331 45.2881060665785, 124.52838516029905 45.28810608707388, 124.52838528877189 45.288106265959875, 124.52838530767653 45.288106298300754, 124.52838539529353 45.28810648908758, 124.52838540775889 45.2881065092412, 124.52838600179301 45.28810725918322, 124.52838655826329 45.288108033603606, 124.52838657500601 45.28810805214914, 124.52838675045005 45.28810820990569, 124.5283867779298 45.288108239021824, 124.5283869165918 45.28810841407658, 124.52838693438785 45.288108432126585, 124.52838772427259 45.28810908585239, 124.5283884840815 45.28810976876003, 124.52838850562848 45.288109784643915, 124.52838872130157 45.288109915208494, 124.52838875630026 45.2881099399809, 124.52838894067823 45.28811009257616, 124.52838896312132 45.288110107828864, 124.5283899284975 45.28811064602319, 124.52839085245044 45.28811120536757, 124.52839087797346 45.28811121797904, 124.52839112558696 45.28811131633393, 124.5283911667597 45.28811133581058, 124.52839138976881 45.28811146008282, 124.52839141599566 45.288111471951574, 124.52839251156637 45.288111866860646, 124.52839357235506 45.288112288217945, 124.52839360087246 45.288112297072026, 124.52839387091119 45.288112359437726, 124.52839391667558 45.28811237287013, 124.5283941697456 45.28811246404352, 124.52839419874903 45.28811247207253, 124.52839537002853 45.28811270585557, 124.52839653927016 45.2881129756976, 124.52839656968682 45.28811298045439, 124.52839685177335 45.28811300443414, 124.5283969003708 45.28811301130615, 124.52839717377583 45.288113065876786, 124.52839720444132 45.28811306975743, 124.52839841782682 45.28811313774895, 124.52839963917936 45.288113241387265, 124.52839967032648 45.288113241863925, 124.52839995362005 45.288113226536154, 124.52840000318292 45.28811322658368, 124.52840028641651 45.28811324245454, 124.52840031756534 45.28811324203762, 124.528401526427 45.2881131416248, 124.52840275295473 45.28811307507664, 124.52840278363489 45.288113071254806, 124.52840305724891 45.28811301720858, 124.52840310587264 45.288113010429775, 124.52840338805055 45.28811298699095, 124.52840341848552 45.28811298229249, 124.52840457636782 45.28811271733408, 124.52840576093577 45.28811248315687, 124.52840578996997 45.288112475183496, 124.52840604338977 45.28811238449572, 124.52840608920565 45.2881123711511, 124.52840635948363 45.28811230930334, 124.5284063880351 45.28811230050392, 124.52840746186637 45.28811187688535, 124.52840854752719 45.28811148837513, 124.52840857379975 45.288111476556644, 124.52840879728649 45.28811135271232, 124.52840883853393 45.288111333314724, 124.52840908652523 45.28811123543485, 124.528409112096 45.288111222872736, 124.52841003819792 45.28811066530181, 124.5284110056415 45.28811012896045, 124.52841102814327 45.28811011375077, 124.52841121310783 45.28810996150956, 124.52841124820165 45.288109936804396, 124.52841146437635 45.28810980665379, 124.52841148598424 45.2881097908114, 124.52841224019281 45.28810911641831, 124.52841304081535 45.28810845715417, 124.52841305868135 45.28810843913779, 124.52841319801612 45.28810826435005, 124.52841322560768 45.28810823528673, 124.5284134016582 45.288108077867065, 124.52841341847227 45.28810805935369, 124.52841397180318 45.28810729405546, 124.52841457483784 45.288106537203, 124.52841458738088 45.28810651707296, 124.52841467573131 45.28810632645574, 124.52841469476034 45.2881062941512, 124.52841482392128 45.2881061155118, 124.52841483529588 45.28810609503816, 124.52841516648517 45.2881052682443, 124.52841554875705 45.2881044428903, 124.52841555549587 45.28810442141904, 124.52841558946683 45.28810422229708, 124.52841559920213 45.28810418799268, 124.52841567650971 45.288103994999105, 124.52841568200711 45.28810397335313, 124.52841577961351 45.28810310774538, 124.5284159251467 45.2881022546973, 124.52841592582189 45.288102232711836, 124.52841590410767 45.288102032737484, 124.52841590417495 45.28810199775162, 124.52841592665838 45.288101797819934, 124.52841592606777 45.28810177583283, 124.5284158737179 45.28810146179962, 124.52841587299253 45.288101414024894, 124.5284159307436 45.28810098934731, 124.5284159292419 45.28809998912116, 124.52841562618822 45.28809781713464, 124.52841562011044 45.28809779556609, 124.52841472264579 45.288095707162135, 124.52841471072335 45.28809568684442, 124.52841456732527 45.28809549746928, 124.52841454718492 45.28809546492244, 124.52841453455405 45.288095430543386, 124.5284076841205 45.288068035066374, 124.52840685098867 45.2880659334183, 124.52840683969292 45.28806591292283, 124.52840544172919 45.28806396639363, 124.52840542498637 45.288063947847995, 124.52840351591225 45.28806223123759, 124.5284034943648 45.28806221535341, 124.52840247429336 45.288061597820196, 124.52840243188633 45.28806156668411, 124.52840239869307 45.28806153039995, 124.52840237593772 45.288061490305964, 124.5284023644595 45.28806144788085, 124.52840236468167 45.28806140468922, 124.5284023765961 45.288061362324044, 124.52840239976341 45.28806132234778, 124.52840243332913 45.288061286234765, 124.5284024760553 45.28806125531689, 124.5284025263663 45.28806123073442, 124.52840258240649 45.28806121339396, 124.52840264210901 45.288061203935044, 124.52840270327218 45.288061202706515, 124.52840346943019 45.28806123938874, 124.52840350057006 45.28806123871915, 124.52840656669746 45.2880609587808, 124.52840659705387 45.28806095383574, 124.5284095268982 45.28806025703298, 124.52840955530499 45.28806024800239, 124.5284122362745 45.288059161112834, 124.52841226163874 45.28805914834426, 124.52841459070537 45.28805771313624, 124.52841461205327 45.288057697120074, 124.52841649971138 45.28805596874845, 124.52841651622327 45.288055950099384, 124.52841788993138 45.2880539949847, 124.52841790097177 45.28805397442033, 124.5284187079397 45.28805186769558, 124.52841871308432 45.28805184600643, 124.52841892230047 45.28804966863274, 124.52841892135426 45.28804964670599, 124.52841851926618 45.28804746063295, 124.5284015881014 45.287995671231194, 124.52838888873373 45.287949319365765), (124.528371240127 45.28788755058145, 124.52837121070301 45.28788758872567, 124.52837117144118 45.28788762216639, 124.5283711238058 45.28788764965653, 124.52837106957314 45.28788767017091, 124.52837101076575 45.28788768294448, 124.52837094957677 45.287887687500884, 124.52837088828797 45.287887683670206, 124.52837082918515 45.2878876715953, 124.52837077447232 45.28788765172648, 124.52837072618985 45.28788762480469, 124.52837068613826 45.287887591833915, 124.52837065581129 45.287887554043756, 124.52836181449749 45.28787352989472, 124.5283617955143 45.28787349017495, 124.52836178730274 45.28787344865844, 124.52836179014822 45.287873406787355, 124.52836180395191 45.28787336601631, 124.52836182823422 45.287873327761666, 124.52836186215153 45.28787329335234, 124.52836190452575 45.287873263983684, 124.52836195388473 45.287873240675964, 124.52836200851374 45.287873224238844, 124.52838201470874 45.28786870672128, 124.5283820738288 45.28786869762962, 124.52838213431772 45.287868696591346, 124.52838219399392 45.28786870364387, 124.52838225070528 45.28786871853289, 124.52838230240643 45.28786874072141, 124.52838234723293 45.28786876940922, 124.5283823835681 45.28786880356173, 124.52838241010159 45.287868841947244, 124.52838242587637 45.287868883181396, 124.52838243032359 45.28786892577711, 124.5283824232829 45.287868968198204, 124.52838240500814 45.287869008914804, 124.528371240127 45.28788755058145)), ((124.51007342052513 45.387666915058325, 124.51007290315283 45.3876663826988, 124.50988137489007 45.387480839735986, 124.50988135777449 45.38748082132423, 124.50987176463373 45.38746930955854, 124.50987110850154 45.38746858626792, 124.5097426928841 45.38733818383728, 124.50958174713752 45.38718923407719, 124.50947055105185 45.387084131048105, 124.50941516588193 45.3870304395624, 124.50902608835672 45.38663756606271, 124.50879956112023 45.386416026229426, 124.50879953930516 45.38641600170941, 124.50867229043281 45.38625013539806, 124.50867226566646 45.386250093475816, 124.50867225335568 45.38625004890243, 124.50865565287683 45.38612198840238, 124.50865565369622 45.38612194192721, 124.5086556680552 45.38612189656316, 124.50865569534054 45.38612185424766, 124.50865573438695 45.38612181678794, 124.50890855312488 45.38592553873267, 124.5089086082458 45.38592550474944, 124.50973005585688 45.38552625920828, 124.50973100669466 45.3855257597176, 124.50983494064171 45.38546684818475, 124.50983495567912 45.385466840165094, 124.50985824561307 45.38545516560826, 124.50985916964906 45.38545466602146, 124.50995946395304 45.38539626596579, 124.51016500346009 45.385279761508784, 124.51058172985765 45.38503832340406, 124.5106569729637 45.38499011003791, 124.5106611612328 45.384987670871446, 124.51066194777982 45.38498718165075, 124.51067310793455 45.3849797711689, 124.51099374811494 45.38477431000658, 124.51099617331397 45.384772346816455, 124.51101564848793 45.38475232403142, 124.51101569285487 45.38475228750661, 124.5110399543008 45.384736175800164, 124.51104198919418 45.3847345306627, 124.51104200729468 45.384734512748516, 124.51104354762718 45.38473261947816, 124.51104356042052 45.38473259941976, 124.5110445470032 45.3847305307693, 124.51104455399742 45.38473050933757, 124.51104494891632 45.3847283448049, 124.5110449498428 45.384728322823044, 124.51104473792174 45.38472614558929, 124.51104473274481 45.38472612390274, 124.51104392212766 45.38472401763763, 124.51104391104647 45.38472399707991, 124.5110436958996 45.384723691982906, 124.51104367238146 45.384723647273894, 124.51104366276724 45.384723600075915, 124.511043667489 45.38472355251039, 124.51104368633466 45.38472350671532, 124.51104371845689 45.384723464749044, 124.51131617040069 45.38444334781631, 124.51131766243952 45.384441435440365, 124.51131767472174 45.38444141522401, 124.51131860865203 45.384439334473846, 124.51131861510139 45.38443931295709, 124.51131895503295 45.38443714379374, 124.51131895540149 45.38443712180512, 124.51131868827063 45.38443494758868, 124.51131868254438 45.38443492597134, 124.51131781861734 45.3844328302572, 124.51131780701563 45.38443280984111, 124.51131637949292 45.38443087316582, 124.51131636246222 45.38443085473709, 124.51131442620185 45.38442915152465, 124.51131440439742 45.384429135792175, 124.51131203380885 45.38442773149654, 124.51131200806773 45.384427719063886, 124.51130929425214 45.38442666765183, 124.51130926556299 45.38442665899667, 124.51130631281065 45.38442600087318, 124.5113062822767 45.3844259963284, 124.51130320405981 45.38442575678467, 124.51130317285448 45.38442575652495, 124.51130008746715 45.38442594476654, 124.51130005678965 45.38442594880179, 124.51129708280145 45.3844265575947, 124.51129705383062 45.38442656576985, 124.51129430553 45.38442757171866, 124.51129427937964 45.38442758371927, 124.51129186238249 45.384428948166, 124.5112918401123 45.38442896349294, 124.51128982833754 45.38443065156676, 124.51099130169028 45.3847375743474, 124.51099125731267 45.384737610879306, 124.51065142619022 45.38496326584385, 124.5106360597808 45.38497311194368, 124.50993929572375 45.38537883429871, 124.50981568430439 45.385448899650974, 124.50981566926816 45.38544890767001, 124.50944685769382 45.38563378255007, 124.50902301738654 45.38583870532319, 124.50862004871261 45.386030691934344, 124.50861747683331 45.38603222227764, 124.50861745340661 45.386032239548584, 124.50861540001046 45.38603411910523, 124.50861538230775 45.38603413948183, 124.50861394061742 45.38603628292122, 124.5086139294426 45.38603630547843, 124.50861316490924 45.38603861549047, 124.50861316078051 45.3860386391437, 124.50861310937992 45.3860410348331, 124.50862256707174 45.38611399460859, 124.50862256625251 45.38611404108249, 124.50862255189452 45.386114086445374, 124.50862252461076 45.386114128759964, 124.50862248556649 45.386114166219194, 124.50857317360122 45.386152451513205, 124.50857125358922 45.38615429042808, 124.50857123704334 45.38615431025476, 124.50856988976187 45.38615638649447, 124.5085698793036 45.38615640828271, 124.50856916141214 45.38615863453045, 124.50856915748135 45.386158657364085, 124.50856909917115 45.38616093999353, 124.508569101933 45.38616096291074, 124.50856970565707 45.38616320592344, 124.50856971497221 45.38616322790714, 124.50857096940815 45.38616535782506, 124.50864103908502 45.386256692780115, 124.50864106385052 45.38625673470057, 124.50864107616161 45.386256779271996, 124.50864811036197 45.3863110329243, 124.50864862420222 45.38631300734193, 124.50864863190776 45.38631302683599, 124.50864964056525 45.386314904132846, 124.5086496530819 45.38631492228897, 124.508651139721 45.38631665832794, 124.5089320060661 45.386586530102115, 124.50921908922093 45.386878609637094, 124.50938915991095 45.387043480093276, 124.50940991595719 45.387064438192596, 124.50944456337334 45.38709718919056, 124.50954605479058 45.38719557643936, 124.51003685194063 45.38767937658937, 124.51027745471833 45.38793495445849, 124.5102774639758 45.38793496490185, 124.5105521325414 45.388264567431875, 124.51082292300067 45.3886103000071, 124.51107483255721 45.388953175870085, 124.511075869659 45.38895439185404, 124.51159265023286 45.38948216788378, 124.51189345746464 45.389821949773314, 124.51214057368938 45.39008907968366, 124.51266349548168 45.39067099280376, 124.51292847392851 45.39096896864008, 124.51318153288831 45.39124003696159, 124.5134173791771 45.39150986099928, 124.51366134549627 45.391793821874955, 124.51382585722803 45.39197848025297, 124.51382588782042 45.391978524852135, 124.51389414900295 45.3921145528723, 124.51389416553818 45.39211460451408, 124.5138941644828 45.39211465744851, 124.51385560273245 45.39231927034066, 124.5138555885619 45.39231931304571, 124.51385556289797 45.39231935300114, 124.51372717322664 45.39247638339174, 124.51372665462954 45.392477071166816, 124.5135938779541 45.392668748704, 124.51359386874834 45.39266876101237, 124.51340014143263 45.392909422181084, 124.51318638843455 45.39317111969918, 124.5131863793396 45.39317113016301, 124.51286434601981 45.39351989744648, 124.51286432492331 45.39351991771807, 124.5128187668179 45.39355892062175, 124.51281871910938 45.39355895368756, 124.51258105034258 45.3936922087491, 124.51257877313888 45.39369377386329, 124.51257875256422 45.393693791180105, 124.51257696649392 45.39369564596504, 124.51257695126013 45.39369566583407, 124.51257572872478 45.39369773510258, 124.51257571947157 45.39369775666576, 124.51257510544936 45.39369997897304, 124.51254901227226 45.39389940501584, 124.51254900157076 45.39389944557941, 124.51244763989206 45.39415194586209, 124.51244724065235 45.39415321986209, 124.51229936878208 45.39480065807799, 124.51229936230754 45.39480067963281, 124.5121766052763 45.39512902932212, 124.5119146507689 45.39577691636853, 124.51191443967674 45.39577749599306, 124.5118154385607 45.39608250689393, 124.51181504345085 45.39608527011673, 124.51182604273399 45.396425250916614, 124.51182615007339 45.39642632575484, 124.5118741510605 45.39671232782627, 124.51187454357274 45.39671380598826, 124.51191446284867 45.39682325187402, 124.51191446759853 45.39682326705525, 124.51193430693075 45.39689904874183, 124.51193502413813 45.39690089017119, 124.51196076840188 45.3969502109127, 124.51196077797303 45.396950232560414, 124.51199454583218 45.39704280853488, 124.5119955464707 45.39704477115398, 124.51220253906236 45.397356760106256, 124.51240473508324 45.397649045245416, 124.51261774103897 45.39794805201165, 124.51261909389467 45.397949615392136, 124.51261910929273 45.39794963027663, 124.51262082556084 45.39795102979023, 124.51266926115898 45.39798453979746, 124.51266931273625 45.39798458634674, 124.51267524899644 45.39799170553104, 124.51267800721304 45.39799415330545, 124.51284936472436 45.398109143349934, 124.51295183254578 45.39818003204983, 124.51295509879628 45.398181770808414, 124.51300718711818 45.39820273937059, 124.51300722488914 45.3982027572029, 124.5131332033343 45.39827187705064, 124.51313536149001 45.39827287308934, 124.51313538428825 45.3982728818268, 124.5131377680032 45.398273623919565, 124.51325405979044 45.39830212374926, 124.51325411328413 45.39830214089403, 124.51326807757276 45.3983077622707, 124.51326879523062 45.39830803444918, 124.51352578171132 45.39839967304416, 124.51352581973975 45.398399689029866, 124.51366988457276 45.39847023112435, 124.513671065591 45.39847075744822, 124.51392107300255 45.39857175934779, 124.51392371769447 45.398572610550794, 124.5139237453599 45.398572617366504, 124.51392656665608 45.398573112777484, 124.5139265955535 45.398573115898905, 124.51392952733067 45.39857323904298, 124.51393028320761 45.39857322192965, 124.51393034132856 45.398573224356205, 124.51393039785724 45.398573234179146, 124.51393045091343 45.398573251071745, 124.51393049873232 45.39857327447211, 124.51395474880249 45.39858761814154, 124.51395730494679 45.398588850908766, 124.51395733230905 45.39858886149274, 124.51396018070686 45.398589719249124, 124.51396021047401 45.39858972586894, 124.51396324166983 45.398590175654604, 124.51396327269829 45.39859017805598, 124.51396637020433 45.398590202585844, 124.51396640130174 45.398590200676466, 124.51396944608298 45.39858979900785, 124.51396947605373 45.398589792861145, 124.51397235110097 45.39858898042992, 124.51397237879375 45.39858897028207, 124.51397497361991 45.39858777830965, 124.51397499797069 45.39858776455047, 124.51397721285853 45.398586238843556, 124.51397723293069 45.398586222002436, 124.51397898276316 45.398584421192986, 124.51397899778644 45.398584401916175, 124.51398021531834 45.398582395208855, 124.51398022471469 45.39858237423773, 124.5139808631572 45.3985802387488, 124.51398086656579 45.398580216889414, 124.5139809013837 45.39857803468408, 124.51398089867347 45.398578012776156, 124.51398032852924 45.39857586771673, 124.51398031980399 45.39857584660138, 124.51397916660791 45.39857382112026, 124.5139791522035 45.398573801610375, 124.51397793355054 45.398572484904115, 124.51397790514298 45.39857244661251, 124.51397788765308 45.39857240520055, 124.51397788172619 45.39857236219659, 124.51397788758115 45.398572319187736, 124.51397790500181 45.39857227776129, 124.51397793334536 45.398572239446146, 124.51397797156565 45.39857220565637, 124.51397801825206 45.39857217763902, 124.51397807168163 45.39857215642808, 124.51397812988253 45.39857214280641, 124.51397819070672 45.39857213727672, 124.514194527592 45.39856723804978, 124.51419746050995 45.398566976718506, 124.51419748959204 45.39856697214792, 124.51420030208841 45.398566330521604, 124.5142003294529 45.398566322214826, 124.51420292309035 45.398565322750486, 124.51420294777951 45.39856531099828, 124.51420523177869 45.39856398867793, 124.51420525287591 45.39856397392842, 124.51420716536735 45.398562358257784, 124.51440216398 45.398362358010175, 124.51440356059211 45.398360605016315, 124.51440357234878 45.39836058652148, 124.51440449870952 45.39835868516256, 124.51440450555367 45.398358665479066, 124.51440493145768 45.39835667775203, 124.5144049331612 45.39835665757441, 124.5144048425371 45.3983546280252, 124.51440384811205 45.39834888605076, 124.51440384588834 45.39834886513516, 124.51440383508961 45.39834859463735, 124.51440383115798 45.398348572821774, 124.51440375472784 45.39834833698238, 124.51440374906907 45.39834831416034, 124.51437690259384 45.39819329769974, 124.51437690074839 45.39819325782304, 124.51437690893363 45.39819321834406, 124.51437692689184 45.39819318050527, 124.51437695405811 45.39819314549746, 124.5143769895773 45.398193114422355, 124.51456578799706 45.39805505026877, 124.51456582367044 45.39805502782024, 124.51456586370428 45.39805500937878, 124.51475710738367 45.39798068658683, 124.51508711507329 45.39784368234022, 124.51508943380868 45.39784251002117, 124.51543842018272 45.397630518273644, 124.51577790335828 45.39741421259364, 124.5161143624624 45.39719256888398, 124.51611438444893 45.397192555662535, 124.5164767449957 45.396993906195256, 124.51680351003236 45.396818032630904, 124.51705761249818 45.3966889772077, 124.51731375578338 45.39655290014193, 124.517677545716 45.396355014390664, 124.51803333539091 45.3961741211636, 124.5182938279576 45.396030860207325, 124.51829507529125 45.396030097407994, 124.5184965489308 45.395893454377635, 124.51849657017021 45.395893441199576, 124.51885397611619 45.395690778032204, 124.51957395334009 45.395286789715314, 124.51957593606669 45.395285465536396, 124.51978293643134 45.39512146350742, 124.5197847971766 45.395119651115195, 124.51978481322632 45.395119631619096, 124.51978612214819 45.395117593730845, 124.51978613234212 45.395117572367425, 124.51978683659709 45.395115391256795, 124.51978684052328 45.39511536889012, 124.51978691167827 45.395113132614114, 124.51978690917868 45.39511311014615, 124.51978634436102 45.39511090899098, 124.51978633553652 45.39511088732788, 124.51978515754939 45.39510881015945, 124.51978514279335 45.395108790226985, 124.51978338024665 45.39510690264286, 124.519726747818 45.39505776570334, 124.51972671313183 45.39505772866298, 124.5197266894434 45.395057687545275, 124.51972667767511 45.39505764395097, 124.51972667828507 45.39505759957727, 124.51972669124942 45.39505755615172, 124.51972671606352 45.395057515364925, 124.51972675176135 45.39505747880475, 124.51972679695305 45.39505744789459, 124.51977794453676 45.395028794306775, 124.51978016843881 45.39502727522352, 124.51978018861189 45.39502725844159, 124.51978194914392 45.395025462872745, 124.5197819642822 45.39502544364065, 124.51978319379094 45.39502344058693, 124.51978320331295 45.39502341964373, 124.51978385454917 45.39502128608096, 124.51978385808903 45.39502126423165, 124.51978390602578 45.39501908215199, 124.51978390344745 45.395019060236024, 124.51978334624278 45.39501691349526, 124.51978333764544 45.395016892354825, 124.51978219671244 45.395014863451124, 124.51978218242675 45.39501484389889, 124.51978050161068 45.395013010801954, 124.51978048218477 45.395012993588466, 124.51977832607912 45.395011426743444, 124.51977830226033 45.39501141253094, 124.51977575372253 45.39501017215039, 124.51977572642564 45.395010161484784, 124.51977288339472 45.39500929523589, 124.51977285366928 45.39500928852724, 124.51976982540099 45.395008829699385, 124.51976979438915 45.39500882720544, 124.51976669725809 45.39500879343116, 124.51976666615155 45.39500879524772, 124.5197636191789 45.39500918782498, 124.51976358917325 45.39500919388222, 124.51976070945224 45.3950099977245, 124.51976068176964 45.39501000776452, 124.51975805451023 45.39501120484356, 124.5196993972192 45.39504406395916, 124.51969933145561 45.39504409240359, 124.51969925792554 45.39504410889832, 124.51969852957232 45.3950442060376, 124.51969849972899 45.39504421219517, 124.51969563708724 45.39504502406078, 124.51969560958067 45.395045034162294, 124.51969300023103 45.39504623544469, 124.51967000122096 45.39505923625004, 124.51966780169083 45.39506074961604, 124.5196677817368 45.39506076631328, 124.51966603979864 45.39506255111921, 124.51966602481208 45.395062570222315, 124.51966588067963 45.39506280547506, 124.51966585611818 45.395062837963394, 124.5196658243638 45.395062867193865, 124.51966578626731 45.39506289238343, 124.5195419847431 45.395132244224484, 124.51896604055334 45.395459212506644, 124.51865409543039 45.39563318189501, 124.51849004824888 45.39572720755003, 124.51824117896385 45.39586413561661, 124.51818374037641 45.395897232155626, 124.51818370419734 45.39589725020102, 124.51817169592388 45.39590239725092, 124.51816987017335 45.39590330980767, 124.51802925756093 45.39598455269814, 124.51802921738435 45.39598457248223, 124.51802917338222 45.395984587699466, 124.51802769281842 45.39598500367592, 124.5180276654546 45.39598501362825, 124.51802506718559 45.39598619763635, 124.51786422183106 45.39607611110182, 124.51705553167723 45.39650694598837, 124.51697468015725 45.3965478713301, 124.51697331288743 45.39654864761445, 124.51688076426223 45.39660736125157, 124.51688074626493 45.39660737185201, 124.51677306561594 45.3966661984524, 124.51638219358048 45.39688512675724, 124.51610332308894 45.39703505716996, 124.51601172220406 45.39708939635101, 124.51592994513301 45.397141888596394, 124.51568301601088 45.397308840652435, 124.51546231938975 45.39745464023214, 124.51531635634021 45.39754361999851, 124.51512454454343 45.397664501222735, 124.51477774609513 45.397869382126906, 124.51471002417365 45.39791083538948, 124.51462303372642 45.39796882901331, 124.51462213567241 45.39796947746195, 124.51452147543698 45.398048211692824, 124.51452146184432 45.3980482216882, 124.51434681016642 45.39816898215216, 124.51434494051212 45.398170536006596, 124.5143449237796 45.39817055281796, 124.51434348730922 45.39817232066717, 124.51434347520474 45.39817233934521, 124.51434252001356 45.398174261998996, 124.51434251294259 45.39817428191828, 124.51434207101177 45.39817629500296, 124.5143420692154 45.398176315445895, 124.51434215753625 45.39817837209965, 124.51434333783993 45.39818518743472, 124.51434333968534 45.39818522731143, 124.5143433315002 45.3981852667904, 124.51434331354186 45.39818530462919, 124.51434328637558 45.398185339636996, 124.5143432508564 45.39818537071209, 124.51431750974176 45.39820419453712, 124.51431658557306 45.39820493174047, 124.5142855811686 45.39823193735457, 124.51428385282429 45.39823379502465, 124.5142838381468 45.39823381487316, 124.51428266768568 45.39823587729585, 124.51428265889388 45.398235898801104, 124.51428209290738 45.39823808387773, 124.51428209035072 45.39823810618457, 124.51428215137057 45.39824032692854, 124.51428215515092 45.39824034915027, 124.51428284074785 45.39824251715695, 124.51428285068981 45.39824253835419, 124.51428414796989 45.398244587361155, 124.51437218240906 45.39835316320714, 124.51437220699451 45.398353201418125, 124.51437222107879 45.3983532421812, 124.51437222417184 45.39835328407792, 124.51437221616602 45.39835332565042, 124.51437219733995 45.398353365452095, 124.51437216834863 45.39835340209795, 124.51418550699691 45.398544849596036, 124.5141854687249 45.39854488189767, 124.51418542258254 45.3985449086118, 124.51418537018465 45.398544928803446, 124.51418531336535 45.398544941765856, 124.51418525411314 45.39854494704538, 124.51394170099174 45.398550461460395, 124.51394164287206 45.39855045903399, 124.51394158634444 45.39855044921149, 124.51394153328918 45.3985504323196, 124.51394148547087 45.39855040892019, 124.51383278611029 45.39848611620459, 124.51367377745164 45.39839911289633, 124.5136710776703 45.39839792074486, 124.51350508272688 45.39833992300865, 124.51350323477767 45.398339376758834, 124.51326739118325 45.39828157862387, 124.51326733768957 45.39828156147911, 124.51302504360966 45.398184024636315, 124.513025005837 45.39818400680309, 124.51292744649521 45.398130478551565, 124.51292742247034 45.39813046396272, 124.51287155865369 45.39809297648952, 124.51269470851531 45.39797062387507, 124.51269465689539 45.397970577274634, 124.51254312124001 45.39778873450462, 124.51254310831428 45.39778871733506, 124.51239731085161 45.39757301976035, 124.51215846659971 45.39723224210091, 124.51205981018305 45.397074791023876, 124.51205980261109 45.39707477782338, 124.5119912967506 45.39694353521055, 124.51199128717865 45.396943513560636, 124.51194566133957 45.396818422850885, 124.51194565658908 45.39681840766733, 124.51191577096493 45.39670424453806, 124.51191576844836 45.39670423335219, 124.51187986564904 45.396513749337245, 124.51185594415865 45.39633035364248, 124.51185594291634 45.39633033860579, 124.51184899452569 45.39613181475699, 124.51184899877653 45.396131772220016, 124.51188864119925 45.39596428278467, 124.51188864613536 45.395964265931596, 124.5119654326741 45.39574487564791, 124.51204532581555 45.39554514220876, 124.51212828729867 45.395350232467116, 124.51219741985732 45.39517390302856, 124.51234842122142 45.39477589778298, 124.51234878461227 45.3947746661365, 124.51242175351881 45.39443281136092, 124.5124965952186 45.39413244594826, 124.51249660134637 45.394132426472154, 124.512578416115 45.39391790883381, 124.51257889438571 45.393916022761516, 124.51258052323148 45.393903573739415, 124.51258053393305 45.39390353317555, 124.5125898589317 45.393880303817284, 124.51258988595818 45.39388025720338, 124.5126957069208 45.393743777784884, 124.5126957194851 45.39374376296257, 124.5128901091453 45.39353323820861, 124.51289013024086 45.393533217937765, 124.5129813294289 45.39345514015935, 124.512982493579 45.39345400570423, 124.51322867640404 45.39317979669368, 124.5135216709975 45.39283680292477, 124.5135223312265 45.39283594934808, 124.51375607275 45.39250032037321, 124.51375608347831 45.392500306261645, 124.51397979869935 45.392229648087685, 124.51398118951741 45.39222744758356, 124.51398120003972 45.392227424483465, 124.51398188647974 45.3922250646966, 124.51398188970316 45.392225040542854, 124.51398183962574 45.39222263196038, 124.51398183540996 45.39222260794321, 124.51398104143216 45.39222023995265, 124.51392685259108 45.392112255348756, 124.51392683605607 45.39211220370894, 124.51392683711043 45.39211215077644, 124.51393582176036 45.39206447048736, 124.51393594587917 45.392062547363366, 124.51393594474649 45.392062527969394, 124.51393559678478 45.39206061853525, 124.5139355909271 45.39206059956901, 124.5139347812897 45.39205876092064, 124.51393477090872 45.39205874299496, 124.51393351015717 45.39205701319477, 124.51385481111738 45.39196867791666, 124.51385478053022 45.39196863332861, 124.51384303934371 45.39194524015161, 124.51384148175222 45.39194298151451, 124.5135715923952 45.391642104939756, 124.51333668792586 45.39136621733209, 124.51309331223918 45.39109579723858, 124.51282049066398 45.390804987500026, 124.51263650887705 45.39059101215199, 124.51213851158839 45.390033015336115, 124.51189244164779 45.38976693697435, 124.51157951555018 45.38941601994018, 124.51157901243185 45.38941548942434, 124.51129735574375 45.38913583036582, 124.51129734307871 45.38913581677507, 124.51100883835116 45.38880039220895, 124.51074201160573 45.3884546191005, 124.51074027254546 45.38845281326396, 124.51074025257351 45.38845279636413, 124.5107380469491 45.388451264288996, 124.51073802268253 45.388451250459696, 124.5107354352543 45.38845005102254, 124.51073540762548 45.38845004079497, 124.5107335153132 45.38844949963131, 124.51073345183634 45.38844947525225, 124.5107333977738 45.38844944143296, 124.51073335589892 45.38844939990845, 124.51057997015525 45.38825356385006, 124.5104113790672 45.38805125031603, 124.51041135184329 45.38805120826797, 124.51041133739194 45.38805116318652, 124.51041133632354 45.388051116975475, 124.51041134868318 45.38805107158626, 124.51041137394887 45.38805102893564, 124.5104114110538 45.388050990824716, 124.51041210655036 45.3880504139517, 124.51041212432787 45.388050395877045, 124.51041363052188 45.38804848898235, 124.51041364295352 45.388048468811085, 124.51041459225043 45.388046391504226, 124.51041459885872 45.38804637001085, 124.51041495477779 45.388044202121165, 124.51041495530822 45.38804418013316, 124.51041470417185 45.38804200497129, 124.51041469860424 45.38804198333246, 124.51041385006361 45.388039884489274, 124.51041383864046 45.38803986408239, 124.5104124096735 45.38803790308831, 124.51007342052513 45.387666915058325), (124.51461268124461 45.398011131245255, 124.51461262246178 45.398011148939005, 124.51461255985362 45.39801115802713, 124.51461249593059 45.39801115814524, 124.51461243325569 45.39801114928861, 124.51461237434197 45.398011131812304, 124.51461232155151 45.39801110641711, 124.5146122770011 45.39801107412126, 124.51461224247709 45.39801103621966, 124.5146122193636 45.39801099423204, 124.51461220858748 45.398010949841925, 124.51461221058075 45.39801090482918, 124.51461222526358 45.39801086099865, 124.51461225204719 45.398010820107736, 124.51461228985772 45.39801078379602, 124.5146454251471 45.39798486605674, 124.51464544293039 45.39798485321613, 124.51473171891679 45.39792733588393, 124.51479836447363 45.39788655255174, 124.51514525216236 45.39768161887965, 124.51533754160717 45.39756044431607, 124.51548392266653 45.3974711998582, 124.5157050532157 45.39732511254288, 124.51595190007411 45.39715821606181, 124.51603252532435 45.39710645676496, 124.51612299469265 45.39705277198009, 124.51640193533386 45.39690280103783, 124.51679285559985 45.39668384567484, 124.51690077600851 45.39662488912846, 124.51690168497784 45.39662435374716, 124.51699401410832 45.39656577934602, 124.51699404144726 45.396565763831894, 124.51707463010607 45.39652496782139, 124.5178836240934 45.396093970983706, 124.51800354277573 45.39602693870571, 124.51800360671929 45.39602691091403, 124.5180036781115 45.396026894421524, 124.51800464796213 45.396026756697935, 124.51800467763918 45.396026750310526, 124.51800752091584 45.39602591731387, 124.51800754820249 45.39602590701835, 124.51801013319594 45.39602468825663, 124.51818923625446 45.395921206479926, 124.51818927277881 45.395921188237566, 124.51819830828465 45.395917315877846, 124.51819837101978 45.39591729518878, 124.51819856833225 45.39591724771525, 124.51819859608413 45.395917238863404, 124.51820124985923 45.395916164291016, 124.51820324901516 45.39591516345967, 124.5182055392049 45.39591376769266, 124.51820556026529 45.39591375213344, 124.51820565937928 45.39591366321072, 124.51820570833388 45.39591362802767, 124.51826096873675 45.39588178311841, 124.51850982138453 45.395744864177686, 124.51867399156329 45.3956507695892, 124.51898601550418 45.395476755669144, 124.51956197314898 45.39514977968054, 124.51970130965076 45.39507172552731, 124.5197013618492 45.39507170173565, 124.51970141960295 45.39507168552353, 124.51970148072172 45.39507167750586, 124.519701542887 45.39507167798675, 124.51970160374114 45.395071686947965, 124.51970166097581 45.395071704049606, 124.51970171242013 45.39507172864301, 124.51970175612291 45.39507175979537, 124.51974988750189 45.395113520850444, 124.51974992272696 45.39511355861544, 124.51974994652528 45.39511360057951, 124.51974995793604 45.39511364504844, 124.51974995649849 45.39511369022688, 124.5197499422707 45.395113734290845, 124.51974991582715 45.39511377546136, 124.51974987823536 45.39511381207627, 124.51955300229984 45.39526979102687, 124.51955296262862 45.395269817499056, 124.51883405722272 45.39567320326102, 124.51847599811737 45.3958762365609, 124.51847492553709 45.39587690204911, 124.51827353832464 45.39601348642858, 124.51827351337205 45.396013501680216, 124.51801441071741 45.39615600792232, 124.51765824155066 45.396337101327376, 124.51729431906928 45.39653505914148, 124.51703852990728 45.39667094713938, 124.51678430674475 45.39680006598468, 124.51645719676418 45.3969761257324, 124.51609420360761 45.39717512196107, 124.5160930932942 45.397175789640656, 124.51575619724291 45.3973977211355, 124.51541743089967 45.39761357218681, 124.51506968379438 45.397824811095255, 124.51506963740401 45.3978248345276, 124.51474109592856 45.39796122900746, 124.51461268124461 45.398011131245255), (124.51434787357688 45.39821440622959, 124.51434792344041 45.39821437654381, 124.514347980833 45.398214354625, 124.51434804335469 45.398214341389796, 124.51434810839066 45.3982143373917, 124.51434817322115 45.3982143427979, 124.5143482351351 45.398214357382315, 124.5143482915431 45.398214380535016, 124.51434834008634 45.398214411287775, 124.51434837873467 45.39821444835453, 124.5143484058718 45.39821449018514, 124.51434842036291 45.398214535030256, 124.51436231793473 45.39829478246968, 124.5143623193969 45.39829482646837, 124.51436230866858 45.398294869825264, 124.51436228616035 45.39829491088004, 124.51436225273424 45.398294948060595, 124.51436220967022 45.39829497994316, 124.51436215861749 45.39829500530682, 124.51436210153085 45.398295023180324, 124.51436204059638 45.398295032879226, 124.51436197814763 45.39829503403213, 124.51436191657585 45.39829502659488, 124.5143618582388 45.39829501085228, 124.51436180537053 45.39829498740716, 124.51436175999545 45.39829495715733, 124.51436172385118 45.39829492126115, 124.51431737940052 45.39824022973922, 124.514317353483 45.39824018874902, 124.51431733963219 45.39824014494981, 124.51431733839945 45.398240100085175, 124.51431734983377 45.398240055941116, 124.51431737348003 45.39824001427497, 124.51431740839682 45.39823997674538, 124.51434096632445 45.39821945854365, 124.514340984625 45.39821944394546, 124.51434787357688 45.39821440622959), (124.51389422248715 45.392288493567634, 124.51389418588764 45.39228852927616, 124.51389414011213 45.39228855927381, 124.5138940869165 45.39228858241001, 124.513894028341 45.39228859779734, 124.51389396663231 45.39228860484559, 124.51389390415737 45.39228860328446, 124.5138938433124 45.392288593173795, 124.5138937864312 45.392288574901436, 124.51389373569536 45.39228854916819, 124.51389369305097 45.392288516961095, 124.51389366013362 45.39228847951545, 124.51389363820604 45.39228843826753, 124.51389362810905 45.3922883947994, 124.51389363023 45.39228835077831, 124.51391740869533 45.39216217927168, 124.51391742239505 45.39216213755079, 124.51391744706984 45.392162098415746, 124.51391748182516 45.39216206328537, 124.51391752540084 45.39216203343329, 124.51391757621718 45.39216200994177, 124.51391763243174 45.39216199366247, 124.51391769200674 45.392161985185595, 124.5139177527821 45.39216198481847, 124.51391781255457 45.39216199257439, 124.5139178691571 45.39216200817219, 124.51391792053758 45.39216203104638, 124.51391796483328 45.39216206036766, 124.51391800043831 45.39216209507302, 124.51391802606179 45.39216213390422, 124.51394844026758 45.392222741715315, 124.5139484561115 45.39222278908252, 124.51394845712315 45.392222837742196, 124.5139484432552 45.392222885416054, 124.51394841515709 45.392222929872, 124.51389422248715 45.392288493567634), (124.51379826495781 45.39849570420928, 124.51379831117049 45.39849573517906, 124.51379834772196 45.39849577200286, 124.51379837315305 45.398495813210786, 124.51379838644874 45.398495857157926, 124.51379838707824 45.39849590209001, 124.5137983750165 45.39849594621347, 124.51379835074482 45.398495987767014, 124.51379831523226 45.39849602509192, 124.51379826989631 45.39849605669829, 124.51379821654663 45.398496081324474, 124.51379815731285 45.39849609798744, 124.51379809455942 45.39849610602207, 124.51379803079125 45.39849610510762, 124.5137979685539 45.39849609528061, 124.51379791033166 45.39849607693328, 124.5136875531364 45.39845149251649, 124.51368752975092 45.39845148209474, 124.5135431002831 45.39838076212251, 124.51354119849351 45.39837996330736, 124.5134784606387 45.3983575917519, 124.51347840679546 45.39835756750135, 124.51347836088735 45.39835753618123, 124.5134783247538 45.39835749904672, 124.51347829984303 45.3983574575859, 124.5134782871533 45.39835741346028, 124.51347828719297 45.39835736843812, 124.51347829996065 45.39835732432366, 124.5134783249446 45.3983572828847, 124.51347836114357 45.39835724578187, 124.513478407107 45.398357214502, 124.51347846099296 45.398357190298604, 124.51347852064197 45.398357174141616, 124.51347858366377 45.39835716667849, 124.51347864753279 45.3983571682083, 124.51347870968961 45.39835717866974, 124.51349178856314 45.39836038389049, 124.51349182551772 45.39836039482368, 124.51365544495528 45.39841756306341, 124.51365549893549 45.39841758692589, 124.51379826495781 45.39849570420928), (124.51278198394986 45.39360829240533, 124.51278203793527 45.393608267947414, 124.51278209777377 45.393608251593015, 124.51278216104619 45.39360824400335, 124.5127822251946 45.39360824548528, 124.5127822876256 45.39360825597887, 124.51278234581503 45.39360827505988, 124.51278239741048 45.39360830195688, 124.51278244032603 45.393608335582485, 124.51278247282663 45.39360837457725, 124.51278249359834 45.39360841736467, 124.51278250180138 45.393608462214914, 124.51278249710407 45.39360850731475, 124.51278247969644 45.393608550840845, 124.51278245028212 45.39360859103351, 124.51266862485785 45.393731864115516, 124.51266799035984 45.393732612641095, 124.51259041627036 45.39383266151046, 124.51259038125654 45.393832697754625, 124.51259033692753 45.39383272852391, 124.51259028496803 45.393832752649004, 124.51259022735256 45.39383276921308, 124.51259016627064 45.39383277758667, 124.51259010404351 45.39383277745157, 124.51259004303601 45.3938327688129, 124.51258998556646 45.393832751998964, 124.51258993381896 45.39383272764872, 124.51258988975997 45.39383269668755, 124.51258985506381 45.39383266029201, 124.51258983104904 45.39383261984527, 124.51258981862834 45.39383257688436, 124.51258981827364 45.3938325330419, 124.51260625532763 45.393706906558656, 124.51260626763991 45.39370686211569, 124.51260629233819 45.393706820311216, 124.51260632842127 45.39370678283985, 124.51260637442657 45.393706751220556, 124.51278198394986 45.39360829240533), (124.50881195742863 45.385966408612575, 124.5088120116052 45.38596638786746, 124.50881207043159 45.38596637485013, 124.50881213171239 45.385966370046376, 124.50881219316037 45.38596637363551, 124.50881225248239 45.38596638548356, 124.50881230746432 45.38596640514837, 124.50881235605436 45.38596643189602, 124.50881239643887 45.38596646472822, 124.50881242711078 45.38596650241967, 124.5088124469253 45.385966543563654, 124.50881245514303 45.38596658662464, 124.50881245145713 45.385966629995536, 124.50881243600524 45.38596667205769, 124.50881240936408 45.38596671124128, 124.50881237252787 45.385966746083945, 124.50865218701455 45.386091107352826, 124.50865214153687 45.38609113646012, 124.5086520889874 45.386091158888156, 124.50865203131329 45.38609117380592, 124.50865197065153 45.38609118066067, 124.50865190924983 45.38609117919841, 124.50865184938334 45.38609116947332, 124.50865179327013 45.38609115184573, 124.5086517429894 45.38609112696883, 124.50865170040434 45.38609109576434, 124.50865166709262 45.3860910593885, 124.50865164428873 45.38609101918913, 124.50865163283751 45.38609097665572, 124.50864576708739 45.38604572649367, 124.5086457681514 45.38604567857896, 124.50864578359683 45.38604563191074, 124.50864581272273 45.3860455886077, 124.50864585420655 45.386045550635764, 124.50864590616511 45.38604551971884, 124.50881195742863 45.385966408612575), (124.50863355153011 45.386198732107296, 124.50863355111511 45.386198776006566, 124.5086335386057 45.38619881901271, 124.50863351447843 45.38619885948716, 124.50863347965274 45.38619889588779, 124.50863343545537 45.38619892682769, 124.50863338357036 45.386198951128, 124.50863332597456 45.38619896786286, 124.5086332648624 45.38619897639467, 124.50863320256249 45.38619897639833, 124.50863314144833 45.38619896787372, 124.5086330838486 45.38619895114562, 124.5086330319578 45.386198926851414, 124.50863298775309 45.38619889591671, 124.50863295291879 45.38619885952017, 124.50860452161322 45.38616179965871, 124.50860449655453 45.38616175705027, 124.50860448435779 45.386161711735674, 124.50860448553573 45.38616166562072, 124.50860450003894 45.38616162064479, 124.50860452725752 45.386161578699415, 124.5086045660466 45.38616154154867, 124.50862603291966 45.38614487565911, 124.50862607839736 45.38614484655184, 124.50862613094692 45.386144824123804, 124.5086261886211 45.38614480920605, 124.5086262492829 45.38614480235133, 124.50862631068468 45.38614480381361, 124.50862637055121 45.3861448135387, 124.50862642666445 45.3861448311663, 124.50862647694522 45.38614485604322, 124.5086265195303 45.38614488724771, 124.50862655284206 45.38614492362355, 124.50862657564593 45.38614496382293, 124.50862658709715 45.38614500635635, 124.50863355153011 45.386198732107296)), ((124.51139129659778 45.383616796911454, 124.51139031211454 45.38361502838563, 124.51139030022522 45.38361501142493, 124.51138892029873 45.38361340159343, 124.511388904528 45.38361338628561, 124.51138714125855 45.38361194926512, 124.51104592190468 45.38337705897065, 124.51104586908941 45.38337701122242, 124.51094841579783 45.383259018637034, 124.51083394697487 45.38311353799221, 124.51083220438365 45.38311175678838, 124.51083218443124 45.38311174012625, 124.51082998585746 45.38311023007913, 124.51082996170867 45.383110216451186, 124.51082739018659 45.38310903459109, 124.51082736275278 45.383109024511896, 124.51082451540428 45.38310821547534, 124.51082448579616 45.38310820934114, 124.51082143941707 45.38310780062096, 124.51051144050152 45.38308780160484, 124.51050859953412 45.383087799083356, 124.51050857100772 45.383087800872765, 124.51050577533971 45.38308815696882, 124.5105057477984 45.38308816231639, 124.510503061424 45.38308887346126, 124.5102324117138 45.383180754253466, 124.50981833142872 45.3833044794426, 124.50981830912446 45.383304485424006, 124.50945297443337 45.38339158525199, 124.50945290730643 45.38339159574556, 124.5092554400757 45.38340701621391, 124.50925538647022 45.38340701720592, 124.50888299905269 45.38339181752877, 124.50888295719136 45.383391813852064, 124.50839022705473 45.383324986077604, 124.50813266338085 45.38328505380506, 124.50801995943729 45.3832651062947, 124.50759086835059 45.383186090191835, 124.50662590138587 45.38301609601082, 124.50574456290944 45.382858214518826, 124.50574453844031 45.38285820939306, 124.50545414684213 45.38278835608516, 124.50545250089354 45.3827880287316, 124.50485484809049 45.382693083888455, 124.50439941206832 45.382606191701214, 124.50413362706315 45.38254923901469, 124.50413059014137 45.382548811820485, 124.50413055908727 45.38254880965027, 124.50412746225565 45.38254880818386, 124.50412743119753 45.38254881032468, 124.50412439346455 45.38254923464234, 124.50412436359595 45.38254924101192, 124.50412150170011 45.38255007480735, 124.50412147416873 45.382550085160915, 124.50411889809122 45.382551296391696, 124.50411887395455 45.382551310331706, 124.5041166826921 45.382552852451255, 124.50411666287928 45.38255286944097, 124.50411587512087 45.3825536990551, 124.50411583331561 45.382553734569875, 124.50411578210502 45.38255376332472, 124.50411572364472 45.38255378410922, 124.50411566039546 45.38255379604847, 124.50411559501978 45.38255379863989, 124.50411553026962 45.3825537917744, 124.50393093712279 45.38252028386539, 124.50393090032097 45.382520275479415, 124.50360580561859 45.38243052657103, 124.50360282532885 45.382429933523305, 124.50360279461023 45.38242992965042, 124.50359970740804 45.38242975773242, 124.50359967620751 45.382429758157194, 124.50359660073138 45.38243001397546, 124.503596570248 45.38243001868156, 124.50359362468674 45.382430692405144, 124.50359359609205 45.38243070121166, 124.50359089364133 45.382431766949914, 124.5035908680343 45.382431779518356, 124.50358851254866 45.38243319631535, 124.5035884909129 45.38243321216291, 124.50358657291164 45.38243492557218, 124.5035865560791 45.38243494408953, 124.5035851492706 45.38243688826524, 124.5035851378872 45.38243690874213, 124.50358429633408 45.38243900897084, 124.50358429083836 45.382439030617995, 124.50358404688083 45.38244120618969, 124.50358404748361 45.38244122817774, 124.50358441049704 45.38244339548562, 124.50358441717505 45.38244341696727, 124.5035853732089 45.38244549272349, 124.50358538570624 45.38244551287533, 124.5035868980205 45.38244741730904, 124.50358691585645 45.38244743535544, 124.50358892633416 45.38244909528106, 124.50358894882298 45.38244911052835, 124.5035913802027 45.38245046215576, 124.50359140641484 45.38245047398865, 124.50359419381897 45.38245147443453, 124.50392018851242 45.38254147252683, 124.50392202940792 45.38254189155443, 124.5042027419322 45.3825928395356, 124.50456614289965 45.38266891178744, 124.50505513095594 45.38275490968649, 124.50542586767564 45.3828108765516, 124.50542589825056 45.382810882297754, 124.5057571247631 45.38288570756322, 124.5057579430085 45.38288587572813, 124.50618412905017 45.382964909349326, 124.50718804875358 45.383141895193, 124.50765609868064 45.38322790397445, 124.50816809188737 45.38331890276664, 124.50859366139204 45.38338299635244, 124.50859445665414 45.38338310147228, 124.50910347431372 45.38344110140025, 124.50910777893763 45.38344117513433, 124.50925622739666 45.38342958283729, 124.50925628099809 45.383429581845114, 124.50937009264345 45.38343422599154, 124.50937311955775 45.383434144539905, 124.50937314973501 45.38343414166906, 124.50937612840123 45.38343364867921, 124.50945986116612 45.38341368606583, 124.50945992828478 45.38341367557292, 124.50956877826896 45.38340517316453, 124.50957290733297 45.38340444632424, 124.51002688330394 45.383277453041245, 124.51002774698148 45.383277190630636, 124.5104412481319 45.38314134013555, 124.51044131844156 45.383141323718796, 124.51044139222778 45.383141319165375, 124.51082049342575 45.38314905593215, 124.51082055753692 45.38314906185825, 124.51082061863731 45.38314907676897, 124.51082067421889 45.38314910005227, 124.51082072200016 45.38314913075243, 124.51082076001977 45.383149167609304, 124.51092066528176 45.38327012952428, 124.51100903853157 45.383382445858715, 124.51100905120032 45.383382459515644, 124.51101184208426 45.38338503757784, 124.51101185742736 45.383385049796765, 124.51102045720768 45.38339096979785, 124.51102051000984 45.38339101753017, 124.5110392219483 45.3834136688577, 124.51104194231347 45.383416107730504, 124.51136621526116 45.383636336114606, 124.5113662512102 45.38363636510556, 124.51136627961591 45.38363639799241, 124.51136629964589 45.38363643381143, 124.51151670488723 45.38399202174369, 124.51151671721557 45.38399206847108, 124.5115167153342 45.38399211598071, 124.51151669932703 45.383992162150896, 124.51134098125631 45.384336202478664, 124.51134022313603 45.38433831842825, 124.5113402184993 45.384338340174764, 124.51134006074355 45.384340519691186, 124.5113400622164 45.38434054165833, 124.51134051088759 45.38434270098272, 124.51134051841365 45.38434272232515, 124.51134155626991 45.38434477847784, 124.51134156955945 45.38434479837451, 124.51134315671653 45.38434667233781, 124.51134317525948 45.384346690025666, 124.51134525072345 45.38434830978356, 124.51134527380765 45.38434832458276, 124.51134775781946 45.38434962788919, 124.51134778455696 45.3843496392304, 124.51135058165828 45.384350576000394, 124.51135061102148 45.3843505834478, 124.51135361372077 45.384351117681625, 124.51135364458182 45.38435112094918, 124.5113567374868 45.38435123211648, 124.5113567686595 45.384351231078575, 124.51135983291151 45.38435091490729, 124.51135986319795 45.38435090960379, 124.51136278103971 45.38435017824421, 124.51136280927594 45.38435016887893, 124.51136546857589 45.38434905043689, 124.5113654936771 45.38434903736963, 124.51136779224058 45.38434757482599, 124.51136781324124 45.384347558559384, 124.51136966273515 45.3843458081193, 124.51136967878924 45.38434578932454, 124.5113710201926 45.384343797885684, 124.51153929454995 45.38401433449237, 124.5115393231342 45.384014292671964, 124.51153936329297 45.38401425587748, 124.51153941331536 45.38401422567624, 124.51153947107069 45.3840142033548, 124.51153953409852 45.38401418986399, 124.51154254292167 45.384013778774175, 124.51154257282893 45.38401377249231, 124.51154543970081 45.38401294711328, 124.5115454672945 45.38401293684046, 124.51154805057688 45.384011733190064, 124.51154807479558 45.3840117193216, 124.51155027521453 45.38401018365526, 124.51155029512827 45.38401016672384, 124.51155202812207 45.384008358056704, 124.51155204296586 45.384008338712775, 124.51155324193685 45.38400632655084, 124.51155325114019 45.38400630553791, 124.51155387001224 45.38400416720813, 124.51155387322152 45.38400414533279, 124.51155388821223 45.3840019630097, 124.511553885311 45.38400194116802, 124.51155328839641 45.3839997772795, 124.5115503472439 45.38399282386817, 124.51155033491592 45.383992777144506, 124.5115503367955 45.38399272963854, 124.51155035279868 45.383992683471504, 124.51156101875128 45.38397179705257, 124.51156179507356 45.38396959329166, 124.51156179964104 45.383969570642364, 124.51156192528029 45.38396730172728, 124.51156192323636 45.38396727895304, 124.51156138598637 45.38396501683675, 124.51144238521464 45.383659018462104, 124.51144139977905 45.38365715592489, 124.51144138750549 45.383657137848125, 124.51143994773014 45.38365542850096, 124.51143993113196 45.383655412291404, 124.51143806329817 45.383653896046475, 124.51139452482616 45.38362432732415, 124.51139448887712 45.38362429833321, 124.51139446047141 45.383624265446365, 124.51139444044142 45.38362422962734, 124.51139129659778 45.383616796911454), (124.5104870278248 45.3831197507094, 124.51048696765828 45.38311974542098, 124.5104869099969 45.38311973220934, 124.51048685692166 45.38311971155132, 124.51048681034845 45.38311968419255, 124.51048677195803 45.383119651120474, 124.51048674313613 45.383119613528784, 124.51048672492304 45.38311957277427, 124.51048671797605 45.38311953032789, 124.51048672254602 45.38311948772167, 124.51048673846793 45.38311944649341, 124.51048676516709 45.38311940813115, 124.51048680167983 45.383119374019515, 124.51048684668834 45.3831193453897, 124.51048689856816 45.383119323275054, 124.51051286551441 45.38311050927718, 124.51051291924689 45.383110495074426, 124.51051297572012 45.383110487882476, 124.510513033108 45.38311048793383, 124.51072487493362 45.383124155232096, 124.51072493518514 45.3831241632888, 124.51072499213757 45.38312417931779, 124.51072504368798 45.38312420272721, 124.5107250879329 45.38312423265271, 124.51072512323876 45.3831242679893, 124.51072514830176 45.383124307432226, 124.51072516219662 45.38312434952509, 124.51072516441025 45.38312439271367, 124.51072515486086 45.383124435403246, 124.510725133901 45.38312447601758, 124.51072510230485 45.38312451305702, 124.51072506123876 45.383124545153905, 124.5107250122192 45.383124571123105, 124.51072495705611 45.38312459000574, 124.51072489778645 45.3831246011046, 124.51072483659851 45.38312460400983, 124.5104870278248 45.3831197507094)))</textarea>
            <div class="coord-settings" style="margin-bottom:8px;font-size:12px;color:#333;">
                <label>WKT坐标系：
                    <select id="coordSysSelect" style="margin-left:6px;">
                        <option value="wgs84" selected>WGS84</option>
                        <option value="gcj02">GCJ-02（国测局）</option>
                        <option value="bd09">BD-09（百度）</option>
                        <option value="cgcs2000">CGCS2000</option>
                    </select>
                </label>
                <!-- 已移除“不进行绘制坐标转换”选项，统一使用WGS84绘制 -->
            </div>

            <div class="button-group">
                <button id="drawButton">绘制轮廓</button>
                <button id="clearButton">清空轮廓</button>
            </div>
            <!-- 显示开关：仅保留显示亩数 -->
            <div class="display-toggles" style="margin-top:8px;font-size:12px;color:#333;">
                <label><input type="checkbox" id="toggleLabelsCheckbox"> 显示亩数</label>
            </div>
            <!-- 颜色选择器 -->
            <div class="color-picker-container" style="margin-top:8px;">
                <div style="margin-bottom:6px;font-size:12px;color:#333;">轮廓颜色设置：</div>
                <div style="display:flex;align-items:center;gap:8px;">
                    <div style="display:flex;align-items:center;gap:4px;">
                        <label style="font-size:12px;">边框颜色:</label>
                        <div id="outlineColorPicker" class="color-picker" style="width:24px;height:24px;border:1px solid #ccc;cursor:pointer;background-color:#FFD700;"></div>
                        <input type="color" id="outlineColorInput" value="#FFD700" style="display:none;">
                    </div>
                    <div style="display:flex;align-items:center;gap:4px;">
                        <label style="font-size:12px;">填充颜色:</label>
                        <div id="fillColorPicker" class="color-picker" style="width:24px;height:24px;border:1px solid #ccc;cursor:pointer;background-color:#FFFF00;"></div>
                        <input type="color" id="fillColorInput" value="#FFFF00" style="display:none;">
                    </div>
                    <div style="display:flex;align-items:center;gap:4px;">
                        <label style="font-size:12px;">透明度:</label>
                        <input type="range" id="fillOpacitySlider" min="0" max="100" value="35" style="width:60px;">
                        <span id="fillOpacityValue" style="font-size:12px;">35%</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane" id="tabSplit">
            <!-- MultiPolygon → 多个 Polygon 分割器 -->
            <div class="split-section">
                <div class="title">MultiPolygon → 多个 Polygon 分割器</div>
                <div class="desc">输入一个 MULTIPOLYGON WKT，分割为多行 POLYGON WKT。</div>
                <textarea id="multiInput"></textarea>
                <div class="split-actions">
                    <button id="splitMultiBtn">分割为多个 POLYGON</button>
                    <button id="copyPolysBtn">复制结果</button>
                </div>
                <textarea id="polyOutput" readonly></textarea>
            </div>
        </div>

        <div class="tab-pane" id="tabBatch">
            <!-- 批量POLYGON → MULTIPOLYGON 生成器 -->
            <div class="batch-section">
                <div class="title">批量POLYGON → MULTIPOLYGON 合并器</div>
                <div class="desc">每行一个 POLYGON WKT（或用分号分隔）。生成后可一键填充到上方并绘制。</div>
                <textarea id="batchInput"></textarea>
                <div class="batch-actions">
                    <button id="generateMultiBtn">生成 MULTIPOLYGON</button>
                    <button id="copyMultiBtn">复制结果</button>
                </div>
                <textarea id="multiOutput" readonly></textarea>
            </div>
        </div>
        <div class="tab-pane" id="tabTrack">
            <div class="tip">请粘贴轨迹文本（支持两种格式：1）每行一条：定位时间yyyyMMddHHmmss, 经度, 纬度；2）单行#分隔：经度,纬度,定位时间yyyyMMddHHmmss#经度,纬度,定位时间yyyyMMddHHmmss#…）。</div>
            <div class="coord-settings" style="margin-bottom:8px;font-size:12px;color:#333;">
                <label>轨迹坐标系：
                    <select id="trackCoordSysSelect" style="margin-left:6px;">
                        <option value="wgs84" selected>WGS84</option>
                        <option value="gcj02">GCJ-02（国测局）</option>
                        <option value="bd09">BD-09（百度）</option>
                        <option value="cgcs2000">CGCS2000</option>
                    </select>
                </label>
            </div>
            <textarea id="trackTextarea" style="width:100%;height:120px;margin-bottom:10px;padding:8px;border:1px solid #ddd;border-radius:4px;font-family:monospace;resize:vertical;box-sizing:border-box;">20251101075920,124.504387,45.342025
20251101075930,124.504243,45.341985
20251101075940,124.503652,45.341865
20251101075950,124.503114,45.341694
20251101080000,124.502817,45.341689
20251101080010,124.502542,45.342064
20251101080020,124.502319,45.342370
20251101080030,124.502012,45.342488
20251101080040,124.501846,45.342633
20251101080050,124.501788,45.342669
20251101080100,124.501646,45.342732
20251101080110,124.501523,45.342723
20251101080120,124.501176,45.342718
20251101080130,124.500875,45.343054
20251101080140,124.500348,45.343603
20251101080150,124.499824,45.344164
20251101080200,124.499290,45.344746
20251101080210,124.498757,45.345367
20251101080220,124.498242,45.346002
20251101080230,124.498049,45.346552
20251101080240,124.498454,45.347215
20251101080250,124.498625,45.347900
20251101080300,124.498718,45.348550
20251101080310,124.498712,45.349030
20251101080320,124.498683,45.349368
20251101080330,124.498661,45.349797
20251101080340,124.498705,45.350375
20251101080350,124.498759,45.350973
20251101080400,124.498891,45.351561
20251101080410,124.499311,45.352187
20251101080420,124.499783,45.352811
20251101080430,124.500162,45.353467
20251101080440,124.500426,45.354135
20251101080450,124.500667,45.354797
20251101080500,124.500919,45.355480
20251101080510,124.501238,45.356100
20251101080520,124.501516,45.356662
20251101080530,124.502005,45.357202
20251101080540,124.502457,45.357825
20251101080550,124.503042,45.358306
20251101080600,124.503482,45.358779
20251101080610,124.503445,45.359374
20251101080620,124.502929,45.359970
20251101080630,124.502588,45.360376
20251101080640,124.502270,45.360729
20251101080650,124.501726,45.361076
20251101080700,124.500976,45.361247
20251101080710,124.500589,45.361714
20251101080720,124.500417,45.361975
20251101080730,124.500417,45.361975
20251101080740,124.500417,45.361975
20251101080750,124.500449,45.362271
20251101080800,124.500499,45.362833
20251101080810,124.500068,45.363417
20251101080820,124.499644,45.364001
20251101080830,124.499411,45.364590
20251101080840,124.499554,45.365230
20251101080850,124.499694,45.365896
20251101080900,124.499833,45.366570
20251101080910,124.499944,45.367253
20251101080920,124.500061,45.367948
20251101080930,124.500115,45.368659
20251101080940,124.500155,45.369365
20251101080950,124.500193,45.370064
20251101081000,124.500244,45.370756
20251101081010,124.500307,45.371430
20251101081020,124.500262,45.372102
20251101081030,124.500196,45.372771
20251101081040,124.500134,45.373423
20251101081050,124.500144,45.374126
20251101081100,124.500240,45.374770
20251101081110,124.500294,45.375217
20251101081120,124.500365,45.375874
20251101081130,124.500447,45.376537
20251101081140,124.500535,45.377228
20251101081150,124.500630,45.377986
20251101081200,124.500784,45.378614
20251101081210,124.501194,45.379199
20251101081220,124.501645,45.379842
20251101081230,124.502068,45.380447
20251101081240,124.502493,45.381046
20251101081250,124.502891,45.381609
20251101081300,124.503302,45.382187
20251101081310,124.503600,45.382441
20251101081320,124.503926,45.382531
20251101081330,124.504207,45.382582
20251101081340,124.504570,45.382658
20251101081350,124.505059,45.382744
20251101081400,124.505430,45.382800
20251101081410,124.505762,45.382875
20251101081420,124.506188,45.382954
20251101081430,124.506715,45.383047
20251101081440,124.507192,45.383131
20251101081450,124.507660,45.383217
20251101081500,124.508172,45.383308
20251101081510,124.508597,45.383372
20251101081520,124.509106,45.383430
20251101081530,124.509567,45.383394
20251101081540,124.510021,45.383267
20251101081550,124.510438,45.383130
20251101081600,124.510830,45.383138
20251101081610,124.511053,45.383408
20251101081620,124.511427,45.383662
20251101081630,124.511546,45.383968
20251101081640,124.511356,45.384340
20251101081650,124.511029,45.384728
20251101081700,124.510651,45.384979
20251101081710,124.510239,45.385218
20251101081720,124.509849,45.385446
20251101081730,124.509456,45.385643
20251101081740,124.509032,45.385848
20251101081750,124.508629,45.386040
20251101081800,124.508664,45.386310
20251101081810,124.508945,45.386580
20251101081820,124.509232,45.386872
20251101081830,124.509559,45.387189
20251101081840,124.509807,45.387434
20251101081850,124.510050,45.387673
20251101081900,124.510291,45.387929
20251101081910,124.510566,45.388259
20251101081920,124.510837,45.388605
20251101081930,124.511089,45.388948
20251101081940,124.511356,45.389222
20251101081950,124.511606,45.389476
20251101082000,124.511907,45.389816
20251101082010,124.512154,45.390083
20251101082020,124.512417,45.390375
20251101082030,124.512677,45.390665
20251101082040,124.512942,45.390963
20251101082050,124.513195,45.391234
20251101082100,124.513431,45.391504
20251101082110,124.513675,45.391788
20251101082120,124.513920,45.392063
20251101082130,124.513871,45.392323
20251101082140,124.513741,45.392482
20251101082150,124.513608,45.392674
20251101082200,124.513414,45.392915
20251101082210,124.513200,45.393177
20251101082220,124.512980,45.393415
20251101082230,124.512807,45.393601
20251101082240,124.512807,45.393602
20251101082250,124.512807,45.393602
20251101082300,124.512781,45.393632
20251101082310,124.512682,45.393738
20251101082320,124.512682,45.393738
20251101082330,124.512682,45.393739
20251101082340,124.512682,45.393739
20251101082350,124.512575,45.393876
20251101082400,124.512463,45.394155
20251101082410,124.512390,45.394477
20251101082420,124.512315,45.394803
20251101082430,124.512192,45.395132
20251101082440,124.512060,45.395461
20251101082450,124.511930,45.395780
20251101082500,124.511831,45.396085
20251101082510,124.511842,45.396425
20251101082520,124.511890,45.396711
20251101082530,124.512010,45.397040
20251101082540,124.512217,45.397352
20251101082550,124.512419,45.397644
20251101082600,124.512632,45.397943
20251101082610,124.512963,45.398172
20251101082620,124.513276,45.398298
20251101082630,124.513534,45.398390
20251101082640,124.513679,45.398461
20251101082650,124.513929,45.398562
20251101082700,124.514194,45.398556
20251101082710,124.514389,45.398356
20251101082720,124.514358,45.398177
20251101082730,124.514533,45.398056
20251101082740,124.514634,45.397977
20251101082750,124.514635,45.397977
20251101082800,124.514635,45.397977
20251101082810,124.514635,45.397977
20251101082820,124.514658,45.397962
20251101082830,124.514721,45.397919
20251101082840,124.514748,45.397902
20251101082850,124.514788,45.397878
20251101082900,124.514790,45.397877
20251101082910,124.514790,45.397877
20251101082920,124.514790,45.397877
20251101082930,124.514790,45.397877
20251101082940,124.514790,45.397877
20251101082950,124.514790,45.397877
20251101083000,124.514790,45.397877
20251101083010,124.514790,45.397877
20251101083020,124.514790,45.397877
20251101083030,124.514790,45.397877
20251101083040,124.514790,45.397877
20251101083050,124.514790,45.397877
20251101083100,124.514838,45.397849
20251101083110,124.514908,45.397808
20251101083120,124.514982,45.397764
20251101083130,124.515057,45.397720
20251101083140,124.515135,45.397673
20251101083150,124.515204,45.397630
20251101083200,124.515263,45.397593
20251101083210,124.515327,45.397552
20251101083220,124.515399,45.397508
20251101083230,124.515473,45.397463
20251101083240,124.515536,45.397422
20251101083250,124.515610,45.397372
20251101083300,124.515694,45.397317
20251101083310,124.515779,45.397260
20251101083320,124.515864,45.397203
20251101083330,124.515941,45.397150
20251101083340,124.516022,45.397098
20251101083350,124.516113,45.397044
20251101083400,124.516205,45.396994
20251101083410,124.516298,45.396945
20251101083420,124.516392,45.396894
20251101083430,124.516485,45.396842
20251101083440,124.516587,45.396785
20251101083450,124.516682,45.396732
20251101083500,124.516783,45.396675
20251101083510,124.516891,45.396616
20251101083520,124.516984,45.396557
20251101083530,124.517065,45.396516
20251101083540,124.517158,45.396466
20251101083550,124.517251,45.396417
20251101083600,124.517342,45.396369
20251101083610,124.517430,45.396321
20251101083620,124.517525,45.396270
20251101083630,124.517617,45.396222
20251101083640,124.517708,45.396173
20251101083650,124.517797,45.396126
20251101083700,124.517874,45.396085
20251101083710,124.517955,45.396039
20251101083720,124.518035,45.395995
20251101083730,124.518000,45.396016
20251101083740,124.518000,45.396015
20251101083750,124.518000,45.396015
20251101083800,124.518001,45.396015
20251101083810,124.518001,45.396015
20251101083820,124.518025,45.396001
20251101083830,124.518104,45.395955
20251101083840,124.518180,45.395912
20251101083850,124.518194,45.395906
20251101083900,124.518192,45.395907
20251101083910,124.518192,45.395907
20251101083920,124.518192,45.395907
20251101083930,124.518192,45.395907
20251101083940,124.518192,45.395907
20251101083950,124.518192,45.395907
20251101084000,124.518192,45.395907
20251101084010,124.518192,45.395907
20251101084020,124.518192,45.395907
20251101084030,124.518192,45.395907
20251101084040,124.518192,45.395907
20251101084050,124.518192,45.395907
20251101084100,124.518251,45.395873
20251101084110,124.518305,45.395844
20251101084120,124.518345,45.395822
20251101084130,124.518421,45.395779
20251101084140,124.518500,45.395736
20251101084150,124.518582,45.395689
20251101084200,124.518664,45.395642
20251101084210,124.518749,45.395595
20251101084220,124.518782,45.395577
20251101084230,124.518807,45.395562
20251101084240,124.518890,45.395515
20251101084250,124.518976,45.395468
20251101084300,124.519052,45.395425
20251101084310,124.519131,45.395380
20251101084320,124.519212,45.395334
20251101084330,124.519297,45.395286
20251101084340,124.519383,45.395237
20251101084350,124.519466,45.395190
20251101084400,124.519552,45.395141
20251101084410,124.519644,45.395089
20251101084420,124.519736,45.395037
20251101084430,124.519745,45.395032
20251101084440,124.519764,45.395022
20251101084450,124.519767,45.395021
20251101084500,124.519769,45.395020
20251101084510,124.519768,45.395020
20251101084520,124.519768,45.395020
20251101084530,124.519768,45.395020
20251101084540,124.519768,45.395020
20251101084550,124.519768,45.395020
20251101084600,124.519768,45.395020
20251101084610,124.519768,45.395020
20251101084620,124.519768,45.395020
20251101084630,124.519768,45.395020
20251101084640,124.519768,45.395020
20251101084650,124.519768,45.395020
20251101084700,124.519768,45.395020
20251101084710,124.519768,45.395020
20251101084720,124.519768,45.395020
20251101084730,124.519768,45.395020
20251101084740,124.519768,45.395020
20251101084750,124.519768,45.395020
20251101084800,124.519768,45.395020
20251101084810,124.519768,45.395020
20251101084820,124.519768,45.395020
20251101084830,124.519768,45.395020
20251101084840,124.519768,45.395020
20251101084850,124.519768,45.395020
20251101084900,124.519768,45.395020
20251101084910,124.519768,45.395020
20251101084920,124.519768,45.395020
20251101090657,124.519693,45.395061
20251101090707,124.519693,45.395061
20251101090717,124.519680,45.395068
20251101090727,124.519703,45.395055
20251101090737,124.519771,45.395114
20251101090747,124.519564,45.395278
20251101090757,124.519204,45.395480
20251101090807,124.518844,45.395682
20251101090817,124.518486,45.395885
20251101090827,124.518284,45.396022
20251101090837,124.518024,45.396165
20251101090847,124.517668,45.396346
20251101090857,124.517304,45.396544
20251101090907,124.517048,45.396680
20251101090917,124.516794,45.396809
20251101090927,124.516467,45.396985
20251101090937,124.516104,45.397184
20251101090947,124.515767,45.397406
20251101090957,124.515428,45.397622
20251101091007,124.515079,45.397834
20251101091017,124.514749,45.397971
20251101091027,124.514556,45.398046
20251101091037,124.514329,45.398212
20251101091047,124.514298,45.398239
20251101091057,124.514388,45.398350
20251101152839,124.513965,45.398579
20251101152849,124.513823,45.398495
20251101152859,124.513664,45.398408
20251101152909,124.513498,45.398350
20251101152919,124.513269,45.398294
20251101152929,124.513143,45.398263
20251101152939,124.512917,45.398139
20251101152949,124.512689,45.397986
20251101152959,124.512529,45.397794
20251101153009,124.512383,45.397578
20251101153019,124.512252,45.397393
20251101153029,124.512144,45.397237
20251101153039,124.512045,45.397079
20251101153049,124.511950,45.396897
20251101153059,124.511900,45.396706
20251101153109,124.511864,45.396515
20251101153119,124.511840,45.396331
20251101153129,124.511833,45.396131
20251101153139,124.511873,45.395962
20251101153149,124.511950,45.395742
20251101153159,124.512030,45.395542
20251101153209,124.512113,45.395347
20251101153219,124.512182,45.395171
20251101153229,124.512333,45.394773
20251101153239,124.512406,45.394431
20251101153249,124.512481,45.394130
20251101153259,124.512563,45.393915
20251101153309,124.512591,45.393701
20251101153319,124.512830,45.393567
20251101153329,124.512969,45.393448
20251101153339,124.513215,45.393174
20251101153349,124.513508,45.392831
20251101153359,124.513742,45.392495
20251101153409,124.513966,45.392224
20251101153419,124.513828,45.391949
20251101153429,124.513558,45.391648
20251101153439,124.513323,45.391372
20251101153449,124.513080,45.391102
20251101153459,124.512807,45.390811
20251101153509,124.512623,45.390597
20251101153519,124.512380,45.390326
20251101153529,124.512125,45.390039
20251101153539,124.511879,45.389773
20251101153549,124.511566,45.389422
20251101153559,124.511284,45.389142
20251101153609,124.510995,45.388806
20251101153619,124.510728,45.388460
20251101153629,124.510399,45.388044
20251101153639,124.510060,45.387673
20251101153649,124.509868,45.387487
20251101153659,124.509858,45.387475
20251101153709,124.509858,45.387475
20251101153719,124.509847,45.387464
20251101153729,124.509730,45.387345
20251101153739,124.509569,45.387196
20251101153749,124.509423,45.387058
20251101153759,124.509278,45.386911
20251101153809,124.509013,45.386644
20251101153819,124.508786,45.386422
20251101153829,124.508585,45.386160
20251101153839,124.508898,45.385917
20251101153849,124.509260,45.385741
20251101153859,124.509721,45.385517
20251101153909,124.510155,45.385271
20251101153919,124.510571,45.385030
20251101153929,124.510983,45.384766
20251101153939,124.511303,45.384437
20251101153949,124.511538,45.384003
20251101153959,124.511376,45.383620
20251101154009,124.511023,45.383377
20251101154019,124.510820,45.383119
20251101154029,124.510510,45.383099
20251101154039,124.510239,45.383191
20251101154049,124.509824,45.383315
20251101154059,124.509371,45.383423
20251101154109,124.508881,45.383403
20251101154119,124.508387,45.383336
20251101154129,124.508129,45.383296
20251101154139,124.508016,45.383276
20251101154149,124.507587,45.383197
20251101154159,124.507125,45.383115
20251101154209,124.506622,45.383027
20251101154219,124.506188,45.382949
20251101154229,124.505740,45.382869
20251101154239,124.505449,45.382799
20251101154249,124.505177,45.382755
20251101154259,124.504851,45.382704
20251101154309,124.504395,45.382617
20251101154319,124.504129,45.382560
20251101154541,124.503101,45.381889
20251101154551,124.502672,45.381279
20251101154601,124.502319,45.380785
20251101154611,124.502218,45.380636
20251101154621,124.502030,45.380404
20251101154631,124.501852,45.380125
20251101154641,124.501499,45.379611
20251101154651,124.501152,45.379119
20251101154701,124.500821,45.378649
20251101154711,124.500661,45.378198
20251101154721,124.500608,45.377700
20251101154731,124.500527,45.377076
20251101154741,124.500455,45.376484
20251101154751,124.500381,45.375952
20251101154801,124.500321,45.375411
20251101154811,124.500244,45.374846
20251101154821,124.500171,45.374258
20251101154831,124.500111,45.373706
20251101154841,124.500179,45.373140
20251101154851,124.500235,45.372504
20251101154901,124.500293,45.371916
20251101154911,124.500311,45.371328
20251101154921,124.500248,45.370736
20251101154931,124.500198,45.370091
20251101154941,124.500159,45.369441
20251101154951,124.500128,45.368772
20251101155001,124.500088,45.368104
20251101155011,124.499980,45.367423
20251101155021,124.499860,45.366724
20251101155031,124.499721,45.366036
20251101155041,124.499580,45.365401
20251101155051,124.499448,45.364780
20251101155101,124.499556,45.364121
20251101155111,124.499959,45.363576
20251101155121,124.500328,45.363082
20251101155131,124.500556,45.362562
20251101155141,124.500405,45.362014
20251101155151,124.500770,45.361489
20251101155201,124.501328,45.361113
20251101155211,124.502113,45.360889
20251101155221,124.502584,45.360370
20251101155231,124.503069,45.359827
20251101155241,124.503501,45.359261
20251101155251,124.503462,45.358694
20251101155301,124.503007,45.358283
20251101155311,124.502671,45.358018
20251101155321,124.502345,45.357680
20251101155331,124.502105,45.357325
20251101155341,124.501863,45.357046
20251101155351,124.501862,45.357045
20251101155401,124.501817,45.356996
20251101155411,124.501575,45.356708
20251101155421,124.501570,45.356703
20251101155431,124.501570,45.356703
20251101155441,124.501570,45.356702
20251101155451,124.501550,45.356679
20251101155501,124.501409,45.356486
20251101155511,124.501303,45.356277
20251101155521,124.501171,45.355939
20251101155531,124.501006,45.355657
20251101155541,124.501007,45.355658
20251101155551,124.501003,45.355651
20251101155601,124.500864,45.355312
20251101155611,124.500676,45.354809
20251101155621,124.500440,45.354139
20251101155631,124.500187,45.353493
20251101155641,124.500022,45.353165
20251101155651,124.499854,45.352902
20251101155701,124.499695,45.352643
20251101155711,124.499442,45.352321
20251101155721,124.499125,45.351921
20251101155731,124.498817,45.351310
20251101155741,124.498764,45.350718
20251101155751,124.498696,45.350241
20251101155801,124.498684,45.349795
20251101155811,124.498686,45.349283
20251101155821,124.498725,45.348698
20251101155831,124.498686,45.348245
20251101155841,124.498586,45.347576
20251101155851,124.498219,45.346827
20251101155901,124.497990,45.346362
20251101155911,124.498513,45.345656
20251101155921,124.499028,45.345053
20251101155931,124.499698,45.344306
20251101155941,124.500377,45.343579
20251101155951,124.500785,45.343145
20251101160001,124.501054,45.342853
20251101160011,124.501324,45.342113
20251101160021,124.501038,45.341751
20251101160031,124.500502,45.341435
20251101160041,124.500038,45.340801
20251101160051,124.499916,45.340258
20251101160101,124.500333,45.339884
20251101160111,124.500860,45.339320
20251101160121,124.501142,45.338732
20251101160131,124.501351,45.338212
20251101160141,124.501654,45.337497
20251101160151,124.501936,45.336823
20251101160201,124.502037,45.336217
20251101160211,124.502389,45.335579
20251101160221,124.502888,45.335254
20251101160231,124.502688,45.334817
20251101160241,124.502451,45.334318
20251101160251,124.502105,45.333575
20251101160301,124.502065,45.332923
20251101160311,124.502027,45.332225
20251101160321,124.502017,45.331662
20251101160331,124.502147,45.331192
20251101160341,124.502350,45.330671
20251101160351,124.502548,45.330204
20251101160401,124.502687,45.329961
20251101160411,124.502996,45.329688
20251101160421,124.503343,45.329375
20251101160431,124.503706,45.329030
20251101160441,124.504146,45.328664
20251101160451,124.504532,45.328421
20251101160501,124.504871,45.328224
20251101160511,124.505191,45.328055
20251101160521,124.505472,45.327905
20251101160531,124.505748,45.327760
20251101160541,124.506077,45.327593
20251101160551,124.506652,45.327292
20251101160601,124.507170,45.327012
20251101160611,124.507925,45.326587
20251101160621,124.508660,45.326189
20251101160631,124.509447,45.325762
20251101160641,124.510298,45.325276
20251101160651,124.511140,45.324812
20251101160701,124.512008,45.324351
20251101160711,124.512719,45.323970
20251101160721,124.513418,45.323576
20251101160731,124.514072,45.323223
20251101160741,124.514682,45.322882
20251101160751,124.514790,45.322820
20251101160801,124.515021,45.322714
20251101160811,124.515789,45.322298
20251101160821,124.516551,45.321882
20251101160831,124.517294,45.321477
20251101160841,124.517999,45.321094
20251101160851,124.518287,45.320935
20251101160901,124.518287,45.320935
20251101160911,124.518287,45.320935
20251101160921,124.518678,45.320731
20251101160931,124.519416,45.320333
20251101160941,124.520144,45.319939
20251101160951,124.520794,45.319480
20251101161001,124.521330,45.318906
20251101161011,124.521799,45.318276
20251101161021,124.522212,45.317714
20251101161031,124.522594,45.317208
20251101161041,124.523008,45.316675
20251101161051,124.523422,45.316124
20251101161101,124.523833,45.315581
20251101161111,124.524280,45.314981
20251101161121,124.524670,45.314463
20251101161131,124.524968,45.314049
20251101161141,124.525126,45.313804
20251101161151,124.525341,45.313568
20251101161201,124.525777,45.313004
20251101161211,124.526156,45.312517
20251101161221,124.526615,45.311897
20251101161231,124.527023,45.311330
20251101161241,124.527291,45.310981
20251101161251,124.527708,45.310393
20251101161301,124.527973,45.310045
20251101161311,124.528106,45.309842
20251101161321,124.528476,45.309392
20251101161331,124.528845,45.309103
20251101161341,124.529249,45.308702
20251101161351,124.529736,45.308191
20251101161401,124.530205,45.307605
20251101161411,124.530501,45.306969
20251101161421,124.530651,45.306474
20251101161431,124.530844,45.305825
20251101161441,124.531027,45.305220
20251101161451,124.531195,45.304712
20251101161501,124.531343,45.304148
20251101161511,124.531562,45.303460
20251101161521,124.531756,45.302789
20251101161531,124.531969,45.302102
20251101161541,124.532124,45.301510
20251101161551,124.532185,45.301052
20251101161601,124.532192,45.301004
20251101161611,124.532290,45.300579
20251101161621,124.532426,45.299844
20251101161631,124.532557,45.299089
20251101161641,124.532689,45.298361
20251101161651,124.532816,45.297670
20251101161701,124.532930,45.297040
20251101161711,124.533054,45.296339
20251101161721,124.533190,45.295594
20251101161731,124.533340,45.294746
20251101161741,124.533476,45.293985
20251101161751,124.533609,45.293215
20251101161801,124.533758,45.292416
20251101161811,124.533900,45.291615
20251101161821,124.534008,45.291010
20251101161831,124.534054,45.290637
20251101161841,124.534121,45.290316
20251101161851,124.534230,45.289668
20251101161901,124.534361,45.289055
20251101161911,124.534523,45.288380
20251101161921,124.534631,45.287923
20251101161931,124.534676,45.287728
20251101161941,124.534760,45.287343
20251101161951,124.534821,45.287082
20251101162001,124.534832,45.286936
20251101162011,124.534769,45.286753
20251101162021,124.534391,45.286764
20251101162031,124.533663,45.286791
20251101162041,124.532673,45.287167
20251101162051,124.531712,45.287341
20251101162101,124.530573,45.287515
20251101162111,124.529538,45.287652
20251101162121,124.528572,45.287814
20251101162131,124.528262,45.287884
20251101162141,124.528327,45.287894
20251101162151,124.528321,45.287888
20251101162201,124.528333,45.287896
20251101162211,124.528329,45.287893
20251101162221,124.528326,45.287891
20251101162231,124.528245,45.287872
20251101162241,124.528422,45.287832
20251101162251,124.528366,45.287925
20251101162301,124.528386,45.287998
20251101162311,124.528389,45.288006
20251101162321,124.528400,45.288039
20251101162331,124.528403,45.288050
20251101162447,124.528398,45.288095
20251101162457,124.528400,45.288099
20251101162507,124.528400,45.288102
20251101165439,124.528388,45.288057
20251101165449,124.528386,45.288050
20251101192524,124.528386,45.288052
20251101192630,124.528392,45.288070
20251101192640,124.528393,45.288073
20251101192650,124.528394,45.288077
20251101192700,124.528395,45.288081
20251101192710,124.528395,45.288081
20251101192720,124.528395,45.288081
20251101192730,124.528395,45.288081
20251101192740,124.528395,45.288081
20251101192750,124.528395,45.288081
20251101192800,124.528396,45.288084
20251101192810,124.528397,45.288087
20251101192820,124.528397,45.288090
20251101192830,124.528398,45.288092
20251101192840,124.528398,45.288094
20251101192850,124.528398,45.288095
20251101192900,124.528398,45.288094
20251101192910,124.528399,45.288096
20251101192920,124.528399,45.288098
20251101192930,124.528399,45.288099
20251101192940,124.528400,45.288100
20251101192950,124.528400,45.288100
20251101193000,124.528400,45.288102
20251101193010,124.528400,45.288102
20251101193349,124.528400,45.288102
20251101193359,124.528400,45.288102
20251101193409,124.528400,45.288102
20251101193419,124.528400,45.288102
20251101193429,124.528400,45.288102
20251101193439,124.528400,45.288102
20251101193449,124.528400,45.288102
20251101193543,124.528400,45.288103
20251101195428,124.528400,45.288101
20251101195438,124.528400,45.288100
20251101195448,124.528400,45.288100
20251101195458,124.528400,45.288100
20251101195508,124.528400,45.288100
20251101195518,124.528400,45.288100
20251101195528,124.528400,45.288100
20251101195538,124.528400,45.288101
20251101195635,124.528400,45.288101
20251101195645,124.528400,45.288101
20251101195938,124.528390,45.288052
20251101195948,124.528389,45.288048
20251101195958,124.528389,45.288048
20251101200008,124.528389,45.288048
20251101200018,124.528380,45.288005
20251101200028,124.528376,45.287973
20251101200038,124.528371,45.287944
20251101200048,124.528368,45.287911
20251101200058,124.528339,45.287865
20251101200108,124.528721,45.287765
20251101200118,124.528884,45.287741
20251101200128,124.529518,45.287659
20251101200138,124.530373,45.287531
20251101200148,124.531181,45.287405
20251101200158,124.532024,45.287277
20251101200208,124.532828,45.287109
20251101200218,124.533553,45.286822
20251101200228,124.534486,45.286751
20251101200238,124.534792,45.286769
20251101200248,124.534824,45.286971
20251101200258,124.534799,45.287121
20251101200308,124.534722,45.287471
20251101200318,124.534605,45.288015
20251101200328,124.534467,45.288610
20251101200338,124.534330,45.289178
20251101200348,124.534228,45.289632
20251101200358,124.534124,45.290201
20251101200408,124.534031,45.290819
20251101200418,124.533903,45.291567
20251101200428,124.533780,45.292260
20251101200438,124.533651,45.292970
20251101200448,124.533524,45.293669
20251101200458,124.533401,45.294328
20251101200508,124.533293,45.294986
20251101200518,124.533172,45.295684
20251101200528,124.533046,45.296355
20251101200538,124.532922,45.297034
20251101200548,124.532809,45.297679
20251101200558,124.532677,45.298421
20251101200608,124.532540,45.299158
20251101200618,124.532415,45.299858
20251101200628,124.532288,45.300557
20251101200638,124.532165,45.301248
20251101200648,124.532040,45.301851
20251101200658,124.531980,45.302153
20251101200708,124.531917,45.302272
20251101200718,124.531791,45.302664
20251101200728,124.531600,45.303306
20251101200738,124.531394,45.303970
20251101200748,124.531224,45.304568
20251101200758,124.531045,45.305150
20251101200808,124.530839,45.305833
20251101200818,124.530651,45.306458
20251101200828,124.530487,45.307032
20251101200838,124.530192,45.307619
20251101200848,124.529809,45.308105
20251101200858,124.529348,45.308597
20251101200908,124.528904,45.309041
20251101200918,124.528390,45.309462
20251101200928,124.527997,45.309974
20251101200938,124.527604,45.310549
20251101200948,124.527211,45.311089
20251101200958,124.526782,45.311651
20251101201008,124.526381,45.312218
20251101201018,124.525907,45.312828
20251101201028,124.525455,45.313421
20251101201038,124.525058,45.313935
20251101201048,124.524644,45.314483
20251101201058,124.524234,45.315029
20251101201108,124.523832,45.315573
20251101201118,124.523388,45.316161
20251101201128,124.522958,45.316736
20251101201138,124.522549,45.317279
20251101201148,124.522148,45.317803
20251101201158,124.521751,45.318341
20251101201208,124.521434,45.318769
20251101201218,124.520932,45.319350
20251101201228,124.520299,45.319847
20251101201238,124.519487,45.320279
20251101201248,124.518697,45.320711
20251101201258,124.517933,45.321125
20251101201308,124.517155,45.321547
20251101201318,124.516437,45.321940
20251101201328,124.515689,45.322346
20251101201338,124.514987,45.322723
20251101201348,124.514217,45.323131
20251101201358,124.513463,45.323546
20251101201408,124.512710,45.323968
20251101201418,124.511908,45.324396
20251101201428,124.511103,45.324830
20251101201438,124.510320,45.325260
20251101201448,124.509592,45.325680
20251101201458,124.508887,45.326060
20251101201508,124.508233,45.326419
20251101201518,124.507599,45.326767
20251101201528,124.506983,45.327115
20251101201538,124.506223,45.327520
20251101201548,124.505502,45.327886
20251101201558,124.504870,45.328225
20251101201608,124.504201,45.328621
20251101201618,124.503583,45.329140
20251101201628,124.503026,45.329662
20251101201638,124.502551,45.330204
20251101201648,124.502313,45.330769
20251101201658,124.502133,45.331232
20251101201708,124.502008,45.331797
20251101201718,124.502045,45.332365
20251101201728,124.502053,45.333038
20251101201738,124.501965,45.333591
20251101201748,124.501581,45.334147
20251101201758,124.501349,45.334693
20251101201808,124.501165,45.335296
20251101201818,124.500921,45.335871
20251101201828,124.500702,45.336426
20251101201838,124.500434,45.336973
20251101201848,124.500134,45.337455
20251101201858,124.499939,45.337796
20251101201908,124.499635,45.338289
20251101201918,124.499314,45.338834
20251101201928,124.499142,45.339400
20251101201938,124.498965,45.339712
20251101201948,124.499256,45.339929
20251101201958,124.499848,45.340206
20251101202008,124.500194,45.340372
20251101202018,124.500866,45.340706
20251101202028,124.501572,45.341054
20251101202038,124.502243,45.341346
20251101202048,124.502848,45.341615
20251101202058,124.503607,45.341856
20251101202108,124.504329,45.341998
20251101202118,124.504526,45.342071
20251101202128,124.504475,45.342068
20251101202138,124.504406,45.342128
20251101202148,124.504407,45.342127</textarea>
            <div class="button-group">
                <button id="drawTrackButton" disabled style="flex: 1;">绘制轨迹</button>
                <button id="showTrackPointsButton" disabled style="flex: 1;" class="btn-warning">打点</button>
                <button id="clearTrackButton" disabled style="flex: 1;">清空轨迹</button>
            </div>
            <!-- 轨迹颜色选择器 -->
            <div class="color-picker-container" style="margin-top:8px;">
                <div style="margin-bottom:6px;font-size:12px;color:#333;">轨迹颜色设置：</div>
                <div style="display:flex;align-items:center;gap:8px;">
                    <div style="display:flex;align-items:center;gap:4px;">
                        <label style="font-size:12px;">轨迹线颜色:</label>
                        <div id="trackLineColorPicker" class="color-picker" style="width:24px;height:24px;border:1px solid #ccc;cursor:pointer;background-color:#FF0000;"></div>
                        <input type="color" id="trackLineColorInput" value="#FF0000" style="display:none;">
                    </div>
                    <div style="display:flex;align-items:center;gap:4px;">
                        <label style="font-size:12px;">轨迹点颜色:</label>
                        <div id="trackPointColorPicker" class="color-picker" style="width:24px;height:24px;border:1px solid #ccc;cursor:pointer;background-color:#68EAF3;"></div>
                        <input type="color" id="trackPointColorInput" value="#68EAF3" style="display:none;">
                    </div>
                </div>
            </div>
            <!-- 回放控制 -->
            <div class="split-section" style="margin-top:8px;">
                <div class="title">轨迹回放</div>
                <div class="playback-actions" style="display:flex;gap:8px;margin-bottom:8px;">
                    <button id="playbackStartBtn" disabled>开始</button>
                    <button id="playbackPauseBtn" disabled>继续</button>
                    <button id="playbackStopBtn" disabled>结束</button>
                </div>
                <div class="playback-speed" style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
                    <label>速度：
                        <select id="playbackSpeedSelect" disabled>
                            <option value="1" selected>1×</option>
                            <option value="2">2×</option>
                            <option value="4">4×</option>
                            <option value="8">8×</option>
                            <option value="16">16×</option>
                            <option value="32">32×</option>
                            <option value="64">64×</option>
                            <option value="128">128×</option>
                            <option value="256">256×</option>
                            <option value="512">512×</option>
                            <option value="1024">1024×</option>
                        </select>
                    </label>
                    <span id="playbackTimeLabel" style="font-size:12px;color:#666;">时间：—</span>
                </div>
                <div class="playback-time" style="display:flex;flex-direction:column;gap:4px;margin-bottom:8px;">
                    <label class="playback-time-label" style="display:flex;align-items:center;gap:8px;flex:1 1 auto;min-width:0;">
                        <span class="playback-time-text" style="white-space:nowrap;">起始时间：</span>
                        <input type="range" id="playbackTimeSlider" disabled min="0" max="0" step="1000" value="0" style="flex:1 1 auto;min-width:0;max-width:100%;vertical-align:middle;">
                    </label>
                    <span id="playbackTimeCursor" style="font-size:12px;color:#666;align-self:flex-end;">—</span>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let map;
    let currentPolygons = []; // 存储多边形和其标签
    let currentTracks = []; // 存储轨迹折线及相关覆盖物
    let mapLoaded = false;
    let mapLabelHandlers = []; // 存储地图事件处理器
    let labelsEnabled = false; // 标签显示开关（默认关闭）
    let isDrawing = false; // 绘制进行中防止重复点击
    let currentMapType = 'satellite'; // 当前地图类型：'satellite'（卫星图）或'street'（街道图）

    window.onload = function () {
        if (typeof T === 'undefined') {
            alert("天地图API加载失败，请检查网络或密钥！");
            return;
        }
        initMap();
        bindDrawEvent();
        bindMinimizeEvent();
        bindTabs();
        bindBatchGenerator();
        bindMultiSplitter();
        bindLabelsToggle(); // 绑定标签显示开关
        bindTrackEvents();  // 绑定轨迹绘制与清空
        bindPlaybackControls(); // 绑定轨迹回放
        bindMeasureEvents(); // 绑定测量功能
        bindMapTypeEvent(); // 绑定地图类型切换功能
        initColorPickers(); // 初始化颜色选择器
    };

    function initMap() {
        showLoading();
        disableButtons(true);

        try {
            map = new T.Map("mapContainer", {
                zoom: 12,
                center: new T.LngLat(116.40769, 39.90403)
            });

            // 已移除测试标签
            map.enableScrollWheelZoom();

            // 不再添加地图类型控件到地图，改为使用左侧工具条按钮切换
            // const mapTypeCtrl = new T.Control.MapType({
            //     mapTypes: [TMAP_NORMAL_MAP, TMAP_SATELLITE_MAP, TMAP_TERRAIN_MAP],
            //     position: T_ANCHOR_TOP_LEFT
            // });
            // map.addControl(mapTypeCtrl);

            // 加载影像底图（卫星）
            const tk = "648f621977051d0199ff0f965d3fd322";

            // 方案1：使用默认地图类型（作为备选）
            map.setMapType(TMAP_SATELLITE_MAP);
            currentMapType = 'satellite';
            updateMapTypeButton('卫星图');

            // 方案2：手动添加影像图层（底图 + 标注）
            const vecLayer = new T.TileLayer(`https://t0.tianditu.gov.cn/img_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=img&STYLE=default&TILEMATRIXSET=w&FORMAT=tiles&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk=${tk}`);
            const cvaLayer = new T.TileLayer(`https://t0.tianditu.gov.cn/cia_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=cia&STYLE=default&TILEMATRIXSET=w&FORMAT=tiles&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk=${tk}`);

            // 添加图层并监听加载状态
            vecLayer.addEventListener("load", function () {
                console.log("影像底图加载完成");
            });

            vecLayer.addEventListener("error", function (e) {
                console.error("影像底图加载错误:", e);
                alert("影像底图加载错误，将使用默认地图类型");
            });

            map.addLayer(vecLayer);
            map.addLayer(cvaLayer);

            // 监听地图加载事件
            map.addEventListener("loaded", function () {
                console.log("地图加载完成");
                markMapLoaded();
            });
            map.addEventListener("load", function () {
                console.log("地图load事件触发");
                markMapLoaded();
            });
            map.addEventListener("tilesloaded", function () {
                console.log("地图瓦片加载完成");
                markMapLoaded();
            });
            // 监听地图加载失败事件
            map.addEventListener("error", function (e) {
                console.error("地图加载错误:", e);
                alert("地图加载错误: " + e.message);
                hideLoading();
            });

            // 监听地图移动事件，用于更新标签位置
            const moveHandler = function () {
                updateAllLabelsPosition();
            };
            map.addEventListener("move", moveHandler);
            map.addEventListener("zoom", moveHandler);

            // 存储事件处理器，用于清理
            mapLabelHandlers.push({ event: "move", handler: moveHandler });
            mapLabelHandlers.push({ event: "zoom", handler: moveHandler });

            // 超时容错
            setTimeout(() => {
                if (!mapLoaded) markMapLoaded();
            }, 8000);

        } catch (error) {
            alert("地图初始化失败：" + error.message);
            console.error(error);
            hideLoading();
        }
    }

    function markMapLoaded() {
        if (!mapLoaded) {
            mapLoaded = true;
            hideLoading();
            // 不再禁用按钮，保持按钮始终可用
            // disableButtons(false);
            disableTrackButtons(false);
            // 仅开启速度选择，回放按钮按状态控制
            const speedSel = document.getElementById('playbackSpeedSelect');
            if (speedSel) speedSel.disabled = false;
            updatePlaybackButtonsState('idle');
        }
    }

    function showLoading() {
        const loading = document.getElementById("mapLoading");
        loading.style.display = "flex";
        loading.style.opacity = "1";
    }

    function hideLoading() {
        const loading = document.getElementById("mapLoading");
        loading.style.opacity = "0";
        setTimeout(() => loading.style.display = "none", 300);
    }

    function disableButtons(disabled) {
        // 不再禁用按钮，保持按钮始终可用
        // document.getElementById("drawButton").disabled = disabled;
        // document.getElementById("clearButton").disabled = disabled;
    }

    function disableTrackButtons(disabled) {
        const drawTrackBtn = document.getElementById("drawTrackButton");
        const showTrackPointsBtn = document.getElementById("showTrackPointsButton");
        const clearTrackBtn = document.getElementById("clearTrackButton");
        if (drawTrackBtn) drawTrackBtn.disabled = disabled;
        if (showTrackPointsBtn) showTrackPointsBtn.disabled = disabled;
        if (clearTrackBtn) clearTrackBtn.disabled = disabled;
    }
    // 回放控件的禁用/启用
    function disablePlaybackButtons(disabled) {
        ["playbackStartBtn","playbackPauseBtn","playbackStopBtn","playbackSpeedSelect","playbackTimeSlider"].forEach(id=>{
            const el = document.getElementById(id);
            if (el) el.disabled = disabled;
        });
    }

    // 回放按钮状态管理：空闲/播放/暂停
    function updatePlaybackButtonsState(state){
        try {
            const startBtn = document.getElementById('playbackStartBtn');
            const pauseBtn = document.getElementById('playbackPauseBtn');
            const stopBtn = document.getElementById('playbackStopBtn');
            if (!startBtn || !pauseBtn || !stopBtn) return;
            if (state === 'idle') {
                startBtn.disabled = false;
                pauseBtn.disabled = true;
                stopBtn.disabled = true;
                pauseBtn.textContent = '继续';
            } else if (state === 'playing') {
                startBtn.disabled = true;
                pauseBtn.disabled = false;
                stopBtn.disabled = false;
                pauseBtn.textContent = '暂停';
            } else if (state === 'paused') {
                startBtn.disabled = true;
                pauseBtn.disabled = false;
                stopBtn.disabled = false;
                pauseBtn.textContent = '继续';
            }
        } catch(e) { console.warn('更新按钮状态失败:', e); }
    }

    function bindDrawEvent() {
        document.getElementById("drawButton").addEventListener("click", function () {
            if (isDrawing) { console.log('绘制进行中，忽略重复点击'); return; }
            isDrawing = true;
            showLoading();
            try {
                const wktStr = document.getElementById("wktTextarea").value.trim();
                if (!wktStr) { alert("请输入WKT字符串！"); return; }
                clearOverlays();
                const geojson = parseWkt(wktStr);
    
                const polygonData = [];
                if (geojson.type === "Polygon") {
                    polygonData.push({ index: 1, coordinates: geojson.coordinates });
                } else if (geojson.type === "MultiPolygon") {
                    geojson.coordinates.forEach((polygon, index) => {
                        polygonData.push({ index: index + 1, coordinates: polygon });
                    });
                }
    
                // 重置并绘制
                polygonInfoList = [];
                polygonData.forEach(pd => processPolygon(pd.index, pd.coordinates));
    
                // 视图居中到所有已绘制轮廓
                try { fitViewportToPolygons(); } catch (e) { console.warn('视图居中失败', e); }
    
                // 在视图稳定后再创建/更新标签
                setTimeout(() => {
                    if (labelsEnabled) {
                        try {
                            createAllLabels();
                            updateAllLabelsPosition();
                        } catch (e) {
                            console.warn('创建或更新标签失败:', e);
                        }
                    }
                }, 150);
            } catch (e) {
                alert('绘制失败：' + (e && e.message ? e.message : e));
                console.error('绘制异常:', e);
            } finally {
                hideLoading();
                isDrawing = false;
                // 不再禁用按钮，保持按钮始终可用
                // disableButtons(false);
            }
        });

        document.getElementById("clearButton").addEventListener("click", function () {
            if (isDrawing) { console.log('绘制进行中，暂不清空'); return; }
            clearOverlays();
            console.log("已清空所有轮廓");
        });
    }

    // 存储多边形数据，用于后续标签创建
    let polygonInfoList = [];

    // 处理单个多边形的绘制和面积计算
    function processPolygon(actualPolygonIndex, polygonCoords) {
        console.log('开始处理多边形', actualPolygonIndex);

        // 坐标系选择（绘制始终使用WGS84坐标）
        const coordSys = (document.getElementById('coordSysSelect') && document.getElementById('coordSysSelect').value) || 'wgs84';

        // 统一转换为WGS84用于绘制与面积计算
        function toWgs(point){
            const lng = point[0], lat = point[1];
            if (coordSys === 'wgs84' || coordSys === 'cgcs2000') {
                return [lng, lat];
            } else if (coordSys === 'gcj02') {
                const w = gcj02ToWgs84(lng, lat);
                return [w.lng, w.lat];
            } else if (coordSys === 'bd09') {
                const gcj = bd09ToGcj02(lng, lat);
                const w = gcj02ToWgs84(gcj.lng, gcj.lat);
                return [w.lng, w.lat];
            }
            return [lng, lat];
        }
        const coordsWGS84 = polygonCoords.map(ring => ring.map(toWgs));
        let outerRingWGS = coordsWGS84[0] || [];

        // 生成用于绘制的坐标（直接使用WGS84坐标）
        const rings = coordsWGS84.map(ring => ring.map(([lng, lat]) => new T.LngLat(lng, lat)));


         // 创建半透明填充的多边形（无边框）
          const polygon = new T.Polygon(rings, {
              color: currentOutlineColor,
              weight: 1,
              opacity: 1,
              fillColor: currentFillColor,
              fillOpacity: currentFillOpacity
          });
 
          // 使用WGS84坐标计算面积（更准确的面积计算）
         let areaSqm;
         let areaMu;



         try {
             // 检查Turf.js是否可用
             if (typeof turf !== 'undefined' && turf.area) {
                 // 使用Turf.js计算多边形面积
                // 构造GeoJSON格式的多边形
                const geoJsonPolygon = {
                    type: "Polygon",
                    coordinates: coordsWGS84
                };


                 // 使用Turf.js计算面积（平方米）
                 areaSqm = turf.area(geoJsonPolygon);
                 areaMu = (areaSqm / 666.6667).toFixed(4); // 转换为亩
                 console.log(`多边形${actualPolygonIndex}面积计算结果(Turf.js): ${areaSqm}平方米 = ${areaMu}亩`);
             } else {
                 // 如果Turf.js不可用，回退到之前的计算方法
                 console.warn('Turf.js不可用，使用备用计算方法');
                 // 计算带孔洞的多边形面积
                 areaSqm = 0;
                 // 计算外环面积
                 outerRingWGS = coordsWGS84[0] || [];
                 areaSqm += calculatePolygonArea(outerRingWGS);

                 // 减去内环（孔洞）面积
                 for (let i = 1; i < coordsWGS84.length; i++) {
                     const innerRingArea = calculatePolygonArea(coordsWGS84[i]);
                     areaSqm -= innerRingArea;
                 }

                  areaMu = (areaSqm / 666.6667).toFixed(4); // 使用更精确的转换系数
                  console.log(`多边形${actualPolygonIndex}面积计算结果(备用): ${areaSqm}平方米 = ${areaMu}亩`);
              }
          } catch (error) {
              console.error(`面积计算失败:`, error);
              areaSqm = 0;
              areaMu = '0.0000';
          }

          // 计算多边形的中心点和底部中心点（WGS84）
          const centerPoint = calculatePolygonCenter(outerRingWGS);
          const bottomCenterPoint = calculatePolygonBottomCenter(outerRingWGS);

          // 添加多边形到地图
          if (map) {
              map.addOverLay(polygon);
              console.log(`多边形${actualPolygonIndex}已添加到地图`);
          } else {
              console.error('地图对象不存在');
          }

          // 存储多边形信息，用于后续标签创建
          polygonInfoList.push({
              index: actualPolygonIndex,
              polygon: polygon,
              area: areaMu,
              bottomCenter: { lng: bottomCenterPoint.lng, lat: bottomCenterPoint.lat },
              ringPoints: rings
          });
      }

    // 视图居中：根据已绘制的GCJ-02点
    function fitViewportToPolygons() {
        const points = [];
        try {
            if (!map || !map.setViewport) return;
            polygonInfoList.forEach(info => {
                if (!info || !info.ringPoints) return;
                info.ringPoints.forEach(ring => {
                    ring.forEach(ll => points.push(ll));
                });
            });
            if (!points.length) return;
            map.setViewport(points);
        } catch (e) {
            try {
                const lngs = points.map(p => p.lng);
                const lats = points.map(p => p.lat);
                const center = new T.LngLat(
                    (Math.min(...lngs) + Math.max(...lngs)) / 2,
                    (Math.min(...lats) + Math.max(...lats)) / 2
                );
                if (map && map.panTo) map.panTo(center);
            } catch (e2) {
                console.warn('视图居中失败:', e2);
            }
        }
    }

    // 统一创建所有多边形的标签
    function createAllLabels() {
        const mapContainer = document.getElementById('mapContainer');
        if (!mapContainer || !map) return;

        polygonInfoList.forEach(info => {
            if (!info) return;
            // 防止重复创建
            if (info.labelRef) return;
            // 创建标签元素
            const labelDiv = document.createElement('div');
            labelDiv.className = 'area-label';
            labelDiv.innerHTML = `多边形${info.index}：${info.area}亩`;

            // 添加到地图容器并根据屏幕边界定位到轮廓下方
            mapContainer.appendChild(labelDiv);
            positionLabelForPolygon(labelDiv, info);

            // 记录引用，避免重复创建
            info.labelRef = labelDiv;

            // 存储到 currentPolygons 以复用现有定位/清理逻辑
            const labelObj = {
                domElement: labelDiv,
                isDomLabel: true,
                polygonInfo: info
            };
            currentPolygons.push({ polygon: info.polygon, label: labelObj });
        });

        // 不清空 polygonInfoList，便于开关随时创建/隐藏标签
    }

    // 根据多边形屏幕边界定位标签，保证始终在轮廓下方
    function positionLabelForPolygon(labelDiv, info) {
        if (!map || !info || !info.ringPoints) return;
        const points = [];
        info.ringPoints.forEach(ring => {
            ring.forEach(ll => {
                const p = map.lngLatToContainerPoint(ll);
                points.push(p);
            });
        });
        if (!points.length) return;
        const minX = Math.min(...points.map(p => p.x));
        const maxX = Math.max(...points.map(p => p.x));
        const maxY = Math.max(...points.map(p => p.y));
        const container = document.getElementById('mapContainer');
        const labelWidth = labelDiv.offsetWidth;
        const labelHeight = labelDiv.offsetHeight;
        const targetLeft = Math.round((minX + maxX) / 2 - labelWidth / 2);
        const targetTop = Math.round(maxY + 6);
        const clampedLeft = Math.max(0, Math.min(targetLeft, container.clientWidth - labelWidth));
        const clampedTop = Math.max(0, Math.min(targetTop, container.clientHeight - labelHeight));
        labelDiv.style.left = clampedLeft + 'px';
        labelDiv.style.top = clampedTop + 'px';
    }

    // 更新所有标签位置（地图move/zoom时调用）
    function updateAllLabelsPosition() {
        try {
            if (!map) return;
            const container = document.getElementById('mapContainer');
            if (!container) return;
            currentPolygons.forEach(item => {
                if (!item || !item.label) return;
                const labelObj = item.label;
                if (labelObj.isDomLabel && labelObj.domElement && labelObj.polygonInfo) {
                    // 确保标签在容器中
                    if (!labelObj.domElement.parentNode) {
                        container.appendChild(labelObj.domElement);
                    }
                    positionLabelForPolygon(labelObj.domElement, labelObj.polygonInfo);
                }
            });
        } catch (e) {
            console.warn('更新标签位置时出错:', e);
        }
    }
    // 确保在全局可用（处理第三方库事件回调作用域差异）
    window.updateAllLabelsPosition = updateAllLabelsPosition;

    // 绑定“显示亩数标签”开关（默认隐藏）
    function bindLabelsToggle() {
        const cb = document.getElementById('toggleLabelsCheckbox');
        const container = document.getElementById('mapContainer');
        if (!cb || !container) return;
        // 默认隐藏标签
        container.classList.add('labels-hidden');
        cb.addEventListener('change', () => {
            labelsEnabled = cb.checked;
            if (labelsEnabled) {
                container.classList.remove('labels-hidden');
                const hasAnyLabel = currentPolygons.some(item => item && item.label && item.label.domElement);
                if (!hasAnyLabel) {
                    try { createAllLabels(); } catch (e) { console.warn('创建标签失败:', e); }
                }
                updateAllLabelsPosition();
            } else {
                container.classList.add('labels-hidden');
            }
        });
    }

    /**
     * 计算多边形中心点（比底部中心更适合显示标签）
     */
    function calculatePolygonCenter(outerRing) {
        let sumLng = 0, sumLat = 0;
        const len = outerRing.length;

        for (let i = 0; i < len; i++) {
            sumLng += outerRing[i][0];
            sumLat += outerRing[i][1];
        }

        return {
            lng: sumLng / len,
            lat: sumLat / len
        };
    }

    /**
     * 计算多边形面积（球面多边形面积计算）
     * 使用更准确的球面坐标面积计算方法，确保面积与视觉大小一致
     */
    function calculatePolygonArea(coordinates) {
        // 地球半径（米）- 使用更精确的值
        const R = 6371000.8;
        const n = coordinates.length;

        // 将所有坐标转换为弧度
        const coordsRad = coordinates.map(point => [
            point[0] * Math.PI / 180,
            point[1] * Math.PI / 180
        ]);

        let areaRad = 0;

        // 使用更准确的球面多边形面积公式（Girard定理）
        for (let i = 0; i < n; i++) {
            const j = (i + 1) % n;
            const lon1 = coordsRad[i][0];
            const lat1 = coordsRad[i][1];
            const lon2 = coordsRad[j][0];
            const lat2 = coordsRad[j][1];

            // 计算球面多边形面积增量
            const dlon = lon2 - lon1;
            const sinLat1 = Math.sin(lat1);
            const sinLat2 = Math.sin(lat2);
            const cosLat1 = Math.cos(lat1);
            const cosLat2 = Math.cos(lat2);

            // 使用更精确的公式
            areaRad += dlon * (sinLat1 * cosLat2 * Math.cos(dlon / 2) + sinLat2 * cosLat1);
        }

        // 计算总面积（平方米）
        const areaSqm = Math.abs(areaRad) * R * R * 0.5;

        return areaSqm;
    }

    /**
     * 清空所有多边形和标签（同时处理 polygonInfoList 与 currentPolygons）
     */
    function clearOverlays() {
        try {
            // 先移除 polygonInfoList 中记录的多边形与其DOM标签
            polygonInfoList.forEach(info => {
                if (info && info.polygon && map && map.removeOverLay) {
                    try { map.removeOverLay(info.polygon); } catch (e) { console.warn('移除多边形失败:', e); }
                }
                if (info && info.labelRef && info.labelRef.parentNode) {
                    try { info.labelRef.parentNode.removeChild(info.labelRef); } catch (e) { console.warn('移除DOM标签失败:', e); }
                    info.labelRef = null;
                }
            });

            // 再处理 currentPolygons（兼容旧路径与标签对象）
            currentPolygons.forEach(item => {
                if (item.polygon && map && map.removeOverLay) {
                    try { map.removeOverLay(item.polygon); } catch (e) { console.warn('移除多边形失败:', e); }
                }
                if (item.label) {
                    if (item.label.domElement && item.label.domElement.parentNode) {
                        try { item.label.domElement.parentNode.removeChild(item.label.domElement); } catch (e) { console.warn('移除DOM标签失败:', e); }
                    } else if (map && map.removeOverLay && !item.label.isDomLabel) {
                        try { map.removeOverLay(item.label); } catch (e) { console.warn('移除地图覆盖物标签失败:', e); }
                    }
                }
            });

            // 清空记录数组
            currentPolygons = [];
            polygonInfoList = [];

            console.log('已清空所有多边形和标签（保留事件监听器）');
        } catch (error) {
            console.error('清空覆盖物时出错:', error);
        }
    }

    // 其他辅助函数（保持不变）
    function bindMinimizeEvent() {
        const container = document.querySelector(".wkt-input-container");
        const btn = document.getElementById("minimizeBtn");
        const minIcon = btn?.querySelector(".min-icon");
        const restoreIcon = btn?.querySelector(".restore-icon");

        btn?.addEventListener("click", () => {
            const minimized = container.classList.toggle("minimized");
            if (minIcon && restoreIcon) {
                if (minimized) {
                    minIcon.style.display = "none";
                    restoreIcon.style.display = "";
                } else {
                    minIcon.style.display = "";
                    restoreIcon.style.display = "none";
                }
            }
        });
    }

    // 在脚本内部补充：页签切换（3个页签）
     function bindTabs() {
         const tabs = [
             { btn: document.getElementById('tabDrawBtn'), pane: document.getElementById('tabDraw'), key: 'draw' },
             { btn: document.getElementById('tabTrackBtn'), pane: document.getElementById('tabTrack'), key: 'track' },
             { btn: document.getElementById('tabSplitBtn'), pane: document.getElementById('tabSplit'), key: 'split' },
             { btn: document.getElementById('tabBatchBtn'), pane: document.getElementById('tabBatch'), key: 'batch' },
         ];
         if (tabs.some(t => !t.btn || !t.pane)) return;
         function activate(key) {
             tabs.forEach(t => {
                 const active = t.key === key;
                 t.btn.classList.toggle('active', active);
                 t.pane.classList.toggle('active', active);
             });
         }
         tabs.forEach(t => t.btn.addEventListener('click', () => activate(t.key)));
         activate('draw');
     }
    function updateParserStatus() {
        const el = document.getElementById('parserStatus');
        if (!el) return;
        const ok = (typeof Terraformer !== 'undefined' && Terraformer.WKT && typeof Terraformer.WKT.parse === 'function');
        if (ok) {
            el.textContent = 'Terraformer WKT Parser';
            el.style.color = '#2f8f2f';
        } else {
            el.textContent = '本地回退解析（仅支持POLYGON/MULTIPOLYGON）';
            el.style.color = '#c77d1e';
        }
    }
     function parseWkt(wkt) {
         wkt = wkt.trim();
         // 优先使用成熟库（Terraformer WKT Parser）
         if (typeof Terraformer !== 'undefined' && Terraformer.WKT && Terraformer.WKT.parse) {
             try {
                 return Terraformer.WKT.parse(wkt);
             } catch (e) {
                 console.warn('Terraformer解析失败，尝试本地回退解析:', e);
             }
         } else {
             // 不再提示“未加载”，由状态栏展示回退信息
         }
         // 回退解析：仅支持 POLYGON / MULTIPOLYGON
         const typeMatch = wkt.match(/^\s*(POLYGON|MULTIPOLYGON)\s*\(/i);
         if (!typeMatch) throw new Error('仅支持POLYGON/MULTIPOLYGON');
         const type = typeMatch[1].toUpperCase();
         const inner = wkt.substring(wkt.indexOf('('));
         if (type === 'POLYGON') {
             const coords = parsePolygonCoords(inner.replace(/^\(/, '').replace(/\)$/, ''));
             return { type: 'Polygon', coordinates: coords };
         } else {
             const trimmed = inner.replace(/^\(\(/, '').replace(/\)\)$/, '');
             const coords = parseMultiPolygonCoords(trimmed);
             return { type: 'MultiPolygon', coordinates: coords };
         }
     }

     function bindMultiSplitter() {
         const input = document.getElementById('multiInput');
         const output = document.getElementById('polyOutput');
         const splitBtn = document.getElementById('splitMultiBtn');
         const copyBtn = document.getElementById('copyPolysBtn');
         if (!input || !output || !splitBtn || !copyBtn) return;

         // 本地WKT序列化辅助
         function ringToText(ring) {
             if (!ring || !ring.length) return '()';
             const first = ring[0];
             const last = ring[ring.length - 1];
             const closed = (first[0] === last[0] && first[1] === last[1]) ? ring : ring.concat([[first[0], first[1]]]);
             return '(' + closed.map(pt => pt[0] + ' ' + pt[1]).join(', ') + ')';
         }
         function toWktPolygonCoords(coords) {
             return 'POLYGON(' + coords.map(ringToText).join(', ') + ')';
         }
         function toWktMulti(coords) {
             return 'MULTIPOLYGON(' + coords.map(poly => '(' + poly.map(ringToText).join(', ') + ')').join(', ') + ')';
         }

         function polygonsFromMulti(text) {
             const geo = parseWkt(text.trim());
             if (geo.type !== 'MultiPolygon') throw new Error('请输入有效的 MULTIPOLYGON WKT');
             const polys = geo.coordinates.map(rings => toWktPolygonCoords(rings));
             return polys;
         }
         splitBtn.addEventListener('click', () => {
             try {
                 const list = polygonsFromMulti(input.value.trim());
                 output.value = list.join('\n');
             } catch (e) {
                 alert('分割失败：' + e.message);
             }
         });
         copyBtn.addEventListener('click', async () => {
             const val = output.value.trim();
             if (!val) { alert('没有可复制的结果'); return; }
             try { await navigator.clipboard.writeText(val); alert('已复制到剪贴板'); } catch (e) { console.warn('复制失败', e); }
         });
     }

     function bindBatchGenerator() {
         const batchInput = document.getElementById('batchInput');
         const output = document.getElementById('multiOutput');
         const genBtn = document.getElementById('generateMultiBtn');
         const copyBtn = document.getElementById('copyMultiBtn');

         // 本地WKT序列化辅助（与分割器保持一致）
         function ringToText(ring) {
             if (!ring || !ring.length) return '()';
             const first = ring[0];
             const last = ring[ring.length - 1];
             const closed = (first[0] === last[0] && first[1] === last[1]) ? ring : ring.concat([[first[0], first[1]]]);
             return '(' + closed.map(pt => pt[0] + ' ' + pt[1]).join(', ') + ')';
         }
         function toWktMulti(coords) {
             return 'MULTIPOLYGON(' + coords.map(poly => '(' + poly.map(ringToText).join(', ') + ')').join(', ') + ')';
         }

         genBtn.addEventListener('click', () => {
             try {
                 const lines = batchInput.value.trim().split(/\n|;/).map(s => s.trim()).filter(Boolean);
                 if (lines.length === 0) throw new Error('请按每行或分号输入至少一个POLYGON');
                 const polygons = lines.map((line, idx) => {
                     const g = parseWkt(line);
                     if (g.type !== 'Polygon') throw new Error(`第${idx + 1}行不是有效的POLYGON WKT`);
                     return g;
                 });
                 const multiGeo = { type: 'MultiPolygon', coordinates: polygons.map(p => p.coordinates) };
                 output.value = toWktMulti(multiGeo.coordinates);
             } catch (e) {
                 alert('生成失败：' + e.message);
             }
         });

         copyBtn.addEventListener('click', async () => {
             const val = output.value.trim();
             if (!val) { alert('没有可复制的结果'); return; }
             try { await navigator.clipboard.writeText(val); alert('已复制到剪贴板'); } catch (e) { console.warn('复制失败', e); }
         });

     }

     function setExampleWkt() {
         const exampleWkt = "MULTIPOLYGON(" +
             "(" +
             "(116.35 39.93, 116.39 39.93, 116.39 39.90, 116.35 39.90, 116.35 39.93)," + // 外环
             "(116.36 39.92, 116.38 39.92, 116.38 39.91, 116.36 39.91, 116.36 39.92)" +  // 内环
             ")," +
             "(" +
             "(116.40 39.95, 116.43 39.97, 116.46 39.96, 116.49 39.98, 116.52 39.95, 116.55 39.93, 116.58 39.94, 116.61 39.92, 116.64 39.95, 116.40 39.95)" +
             ")" +
             ")";
         document.getElementById("wktTextarea").value = exampleWkt;
     }

     function parsePolygonCoords(coordStr) {
         const ringStrs = coordStr.split(/\)\s*,\s*\(/).map(s => s.replace(/[()]/g, '').trim());
         const rings = [];
         ringStrs.forEach(ringStr => {
             const pts = ringStr.split(/,\s*/).map(pointStr => {
                 const [lng, lat] = pointStr.split(/\s+/).map(Number);
                 if (isNaN(lng) || isNaN(lat)) throw new Error("坐标格式错误：" + pointStr);
                 return [lng, lat];
             });
             // 自动拆分：如果一个ring中包含多次回到起点（闭合），则拆分为多个环
             // 兼容用户将外环与内环错误地写在同一对括号中的情况
             let start = 0;
             while (start < pts.length) {
                 const startPt = pts[start];
                 let closeIdx = -1;
                 for (let i = start + 1; i < pts.length; i++) {
                     if (pts[i][0] === startPt[0] && pts[i][1] === startPt[1]) {
                         closeIdx = i;
                         break;
                     }
                 }
                 if (closeIdx === -1) {
                     // 未找到闭合：将剩余点视为一个环，并强制闭合
                     const ring = pts.slice(start);
                     if (ring.length && (ring[0][0] !== ring[ring.length - 1][0] || ring[0][1] !== ring[ring.length - 1][1])) {
                         ring.push([ring[0][0], ring[0][1]]);
                     }
                     rings.push(ring);
                     break;
                 } else {
                     const ring = pts.slice(start, closeIdx + 1);
                     rings.push(ring);
                     start = closeIdx + 1;
                 }
             }
         });
         return rings;
     }

     function parseMultiPolygonCoords(coordStr) {
         const polygonStrs = coordStr.split(/\)\s*\)\s*,\s*\(\s*\(/).map(s => s.replace(/[()]/g, '').trim());
         return polygonStrs.map(polygonStr => parsePolygonCoords(polygonStr));
     }

     function wgs84ToGcj02(lng, lat) {
         const x_PI = 3.14159265358979324 * 3000.0 / 180.0;
         const PI = 3.1415926535897932384626;
         const a = 6378245.0;
         const ee = 0.00669342162296594323;

         if (outOfChina(lng, lat)) return { lng, lat };

         let dlat = transformLat(lng - 105.0, lat - 35.0);
         let dlng = transformLng(lng - 105.0, lat - 35.0);
         const radlat = lat / 180.0 * PI;
         let magic = Math.sin(radlat);
         magic = 1 - ee * magic * magic;
         const sqrtmagic = Math.sqrt(magic);
         dlat = (dlat * 180.0) / ((a * (1 - ee)) / (magic * sqrtmagic) * PI);
         dlng = (dlng * 180.0) / (a / sqrtmagic * Math.cos(radlat) * PI);

         return { lng: lng + dlng, lat: lat + dlat };

         function outOfChina(lng, lat) {
             return (lng < 72.004 || lng > 137.8347) || (lat < 0.8293 || lat > 55.8271);
         }

         function transformLat(x, y) {
             let ret = -100.0 + 2.0 * x + 3.0 * y + 0.2 * y * y + 0.1 * x * y + 0.2 * Math.sqrt(Math.abs(x));
             ret += (20.0 * Math.sin(6.0 * x * PI) + 20.0 * Math.sin(2.0 * x * PI)) * 2.0 / 3.0;
             ret += (20.0 * Math.sin(y * PI) + 40.0 * Math.sin(y / 3.0 * PI)) * 2.0 / 3.0;
             ret += (160.0 * Math.sin(y / 12.0 * PI) + 320 * Math.sin(y * PI / 30.0)) * 2.0 / 3.0;
             return ret;
         }

         function transformLng(x, y) {
             let ret = 300.0 + x + 2.0 * y + 0.1 * x * x + 0.1 * x * y + 0.1 * Math.sqrt(Math.abs(x));
             ret += (20.0 * Math.sin(6.0 * x * PI) + 20.0 * Math.sin(2.0 * x * PI)) * 2.0 / 3.0;
             ret += (20.0 * Math.sin(x * PI) + 40.0 * Math.sin(x / 3.0 * PI)) * 2.0 / 3.0;
             ret += (150.0 * Math.sin(x / 12.0 * PI) + 300.0 * Math.sin(x / 30.0 * PI)) * 2.0 / 3.0;
             return ret;
         }
     }

     function gcj02ToWgs84(lng, lat) {
         const g = wgs84ToGcj02(lng, lat);
         return { lng: lng * 2 - g.lng, lat: lat * 2 - g.lat };
     }

     function bd09ToGcj02(bdLng, bdLat) {
         const x_PI = 3.14159265358979324 * 3000.0 / 180.0;
         const x = bdLng - 0.0065;
         const y = bdLat - 0.006;
         const z = Math.sqrt(x * x + y * y) - 0.00002 * Math.sin(y * x_PI);
         const theta = Math.atan2(y, x) - 0.000003 * Math.cos(x * x_PI);
         const ggLng = z * Math.cos(theta);
         const ggLat = z * Math.sin(theta);
         return { lng: ggLng, lat: ggLat };
     }

     function calculatePolygonBottomCenter(outerRing) {
         let minLat = Infinity;
         let bottomPoints = [];
         outerRing.forEach(point => {
             const lat = point[1];
             if (lat < minLat) {
                 minLat = lat;
                 bottomPoints = [point];
             } else if (lat === minLat) {
                 bottomPoints.push(point);
             }
         });

         const sumLng = bottomPoints.reduce((sum, point) => sum + point[0], 0);
         const centerLng = sumLng / bottomPoints.length;

         return { lng: centerLng, lat: minLat };
     }

     function fitBounds(geojson) {
         try {
             const allPoints = [];
             function collectPoints(coords) {
                 if (typeof coords[0] === 'number') {
                     allPoints.push(coords);
                 } else {
                     coords.forEach(coord => collectPoints(coord));
                 }
             }
             collectPoints(geojson.coordinates);

             if (allPoints.length === 0) return;

             const lats = allPoints.map(p => p[1]);
             const lngs = allPoints.map(p => p[0]);
             const minLng = Math.min(...lngs);
             const maxLng = Math.max(...lngs);
             const minLat = Math.min(...lats);
             const maxLat = Math.max(...lats);

             const sw = wgs84ToGcj02(minLng, minLat);
             const ne = wgs84ToGcj02(maxLng, maxLat);

             // 修复setViewport方法的使用，确保参数格式正确
             if (map && map.setViewport) {
                 map.setViewport([
                     new T.LngLat(sw.lng, sw.lat),
                     new T.LngLat(ne.lng, ne.lat)
                 ], { padding: [50, 50] });
             } else {
                 console.warn('地图对象或setViewport方法不可用');
             }
         } catch (error) {
             console.error('调整视图范围时出错:', error);
         }
     }
// 轨迹绘制与解析
    function bindTrackEvents() {
        const drawBtn = document.getElementById('drawTrackButton');
        const showPointsBtn = document.getElementById('showTrackPointsButton');
        const clearBtn = document.getElementById('clearTrackButton');
        const ta = document.getElementById('trackTextarea');
        if (!drawBtn || !showPointsBtn || !clearBtn || !ta) return;

        drawBtn.addEventListener('click', function(){
            try {
                const text = ta.value.trim();
                if (!text) { alert('请粘贴轨迹文本（时间戳,经度,纬度）'); return; }
                const points = parseTrackText(text);
                if (points.length < 2) { alert('有效轨迹点不足，至少需要两点'); return; }
                drawTrackFromPoints(points);
                fitViewportToTrack(points);
            } catch (e) {
                alert('绘制轨迹失败：' + (e && e.message ? e.message : e));
                console.error('绘制轨迹异常:', e);
            }
        });

        showPointsBtn.addEventListener('click', function(){
            try {
                const text = ta.value.trim();
                if (!text) { alert('请粘贴轨迹文本（时间戳,经度,纬度）'); return; }
                const points = parseTrackText(text);
                if (points.length === 0) { alert('未找到有效轨迹点'); return; }
                showTrackPoints(points);
                fitViewportToTrack(points);
            } catch (e) {
                alert('显示轨迹点失败：' + (e && e.message ? e.message : e));
                console.error('显示轨迹点异常:', e);
            }
        });

        clearBtn.addEventListener('click', function(){
            clearTrackOverlays();
            console.log('已清空轨迹');
        });
    }

    function showTrackPoints(points) {
        // 先移除旧轨迹（不影响轮廓）
        clearTrackOverlays(false);
        
        if (!map || !points || points.length === 0) {
            console.log('无轨迹点可显示');
            return;
        }
        
        console.log(`准备显示${points.length}个轨迹点`);
        
        // 使用批量处理和更小的图标来提高性能
        // 创建一个更小的自定义颜色点SVG图标
        const smallColoredDotIcon = new T.Icon({
            iconUrl: `data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="1" height="1"><circle cx="0.5" cy="0.5" r="0.3" fill="%23${currentTrackPointColor.substring(1)}"/></svg>`,
            iconSize: new T.Point(1, 1),
            iconAnchor: new T.Point(0.5, 0.5)
        });
        
        // 优化批量添加点的速度
        const batchSize = 2000; // 增加每批处理的点数
        const concurrentBatches = 4; // 并发批次数量
        
        // 预创建点击事件处理函数，避免重复创建
        function createClickHandler(point, index) {
            return function() {
                const infoWindow = new T.InfoWindow({
                    content: `点${index + 1}<br/>经度: ${point.lng.toFixed(6)}<br/>纬度: ${point.lat.toFixed(6)}`,
                    offset: new T.Point(0, -20)
                });
                infoWindow.open(map, point);
            };
        }
        
        // 使用setTimeout实现更高效的批量添加，避免阻塞UI
        let currentIndex = 0;
        
        function addBatch() {
            if (currentIndex >= points.length) {
                console.log(`已显示${points.length}个轨迹点`);
                return;
            }
            
            // 添加当前批次的点
            const endIndex = Math.min(currentIndex + batchSize, points.length);
            const markersToAdd = [];
            
            // 先创建所有标记
            for (let i = currentIndex; i < endIndex; i++) {
                const point = points[i];
                const index = i;
                
                const marker = new T.Marker(point, {
                    icon: smallColoredDotIcon
                });
                
                // 添加点击事件
                marker.addEventListener('click', createClickHandler(point, index));
                
                markersToAdd.push(marker);
            }
            
            // 批量添加到地图和数组
            markersToAdd.forEach(marker => {
                map.addOverLay(marker);
                currentTracks.push(marker);
            });
            
            currentIndex = endIndex;
            
            // 使用setTimeout而不是requestAnimationFrame，减少对渲染周期的依赖
            // 设置为0，将任务放入微任务队列，但允许UI有短暂的呼吸空间
            setTimeout(addBatch, 0);
        }
        
        // 启动批量添加
        addBatch();
    }
    
    // 恢复原始的clearTrackOverlays函数
    function clearTrackOverlays(resetArray = true){        
        try {
            currentTracks.forEach(pl => {
                if (pl && map && map.removeOverLay) {
                    try { map.removeOverLay(pl); } catch (e) { console.warn('移除轨迹失败:', e); }
                }
            });
            if (resetArray) currentTracks = [];
        } catch (e) {
            console.warn('清空轨迹时出错:', e);
        }
    }

    function parseTrackText(text){
        // 选择输入坐标系（优先使用轨迹页签专属选择器，若未设置则回退到绘制页签选择器）
        const coordSysEl = document.getElementById('trackCoordSysSelect') || document.getElementById('coordSysSelect');
        const coordSys = (coordSysEl && coordSysEl.value) || 'wgs84';
        const isHash = text.indexOf('#') !== -1;
        const items = isHash ? text.split('#') : text.split(/\r?\n/);
        const pts = [];
        for (let i=0;i<items.length;i++){
            const raw = items[i];
            if (!raw) continue;
            const line = raw.trim();
            if (!line) continue;
            const parts = line.split(',');
            if (parts.length < 3) continue;
            let lng = parseFloat((parts[isHash ? 0 : 1] || '').trim());
            let lat = parseFloat((parts[isHash ? 1 : 2] || '').trim());
            // 初步过滤：数值合法性与正常范围
            if (!isFinite(lng) || !isFinite(lat)) continue;
            if (lng === 0 || lat === 0) continue; // 丢弃0.0异常点
            if (lng < -180 || lng > 180 || lat < -90 || lat > 90) continue; // 超出经纬度范围丢弃

            // 将输入坐标转换为WGS84
            let w;
            if (coordSys === 'wgs84' || coordSys === 'cgcs2000') {
                w = { lng, lat };
            } else if (coordSys === 'gcj02') {
                w = gcj02ToWgs84(lng, lat);
            } else if (coordSys === 'bd09') {
                const g = bd09ToGcj02(lng, lat);
                w = gcj02ToWgs84(g.lng, g.lat);
            } else {
                w = { lng, lat };
            }
            // 转换结果兜底检查
            if (!isFinite(w.lng) || !isFinite(w.lat)) continue;
            if (w.lng < -180 || w.lng > 180 || w.lat < -90 || w.lat > 90) continue;

            // 使用WGS84坐标绘制到地图
            pts.push(new T.LngLat(w.lng, w.lat));
        }
        return pts;
    }

    function drawTrackFromPoints(points){
        // 先移除旧轨迹（不影响轮廓）
        clearTrackOverlays(false);
        const polyline = new T.Polyline(points, {
            color: currentTrackLineColor,
            weight: 1,
            opacity: 0.9
        });
        if (map) {
            map.addOverLay(polyline);
        }
        currentTracks.push(polyline);
    }

    function clearTrackOverlays(resetArray = true){
        try {
            currentTracks.forEach(pl => {
                if (pl && map && map.removeOverLay) {
                    try { map.removeOverLay(pl); } catch (e) { console.warn('移除轨迹失败:', e); }
                }
            });
            if (resetArray) currentTracks = [];
        } catch (e) {
            console.warn('清空轨迹时出错:', e);
        }
    }


    function fitViewportToTrack(points){
        try {
            if (!map || !map.setViewport || !points || !points.length) return;
            map.setViewport(points);
        } catch (e) {
            console.warn('轨迹视图居中失败:', e);
        }
    }

    // ========= 轨迹回放功能 =========
    let playbackState = { points: [], idx: 0, speed: 1, timer: null, running: false, marker: null, line: null, path: [] };

    function bindPlaybackControls(){
        const startBtn = document.getElementById('playbackStartBtn');
        const pauseBtn = document.getElementById('playbackPauseBtn');
        const stopBtn = document.getElementById('playbackStopBtn');
        const speedSel = document.getElementById('playbackSpeedSelect');
        const timeSlider = document.getElementById('playbackTimeSlider');
        const timeCursor = document.getElementById('playbackTimeCursor');
        const ta = document.getElementById('trackTextarea');
        if (!startBtn || !pauseBtn || !stopBtn || !speedSel) return;

        // 初始按钮状态
        updatePlaybackButtonsState('idle');

        startBtn.addEventListener('click', function(){
            try {
                const text = (ta && ta.value || '').trim();
                if (!text) { alert('请粘贴轨迹文本（时间戳,经度,纬度）'); return; }
                const pts = parseTrackTextWithTime(text);
                if (pts.length < 2) { alert('有效轨迹点不足，至少需要两点'); return; }
                startPlayback(pts);
                // 状态在startPlayback中已设置为playing
            } catch (e) {
                alert('开始回放失败：' + (e && e.message ? e.message : e));
                console.error('开始回放异常:', e);
            }
        });

        pauseBtn.addEventListener('click', function(){
            if (!playbackState.running) {
                // 继续
                playbackState.running = true;
                scheduleNext();
                updatePlaybackButtonsState('playing');
            } else {
                // 暂停
                if (playbackState.timer) { clearTimeout(playbackState.timer); playbackState.timer = null; }
                playbackState.running = false;
                updatePlaybackButtonsState('paused');
            }
        });

        stopBtn.addEventListener('click', function(){ 
            stopPlayback(); 
            updatePlaybackButtonsState('idle');
        });

        speedSel.addEventListener('change', function(){
            const v = parseFloat(speedSel.value);
            playbackState.speed = (isFinite(v) && v > 0) ? v : 1;
        });

        if (timeSlider) {
            timeSlider.addEventListener('input', function(){
                const ms = parseInt(timeSlider.value, 10);
                const txt = formatTimeForLabel(ms);
                if (timeCursor) timeCursor.textContent = txt;
            });
            timeSlider.addEventListener('change', function(){
                jumpToSliderTime();
            });
        }
    }

    function parseTrackTextWithTime(text){
        const coordSysEl = document.getElementById('trackCoordSysSelect') || document.getElementById('coordSysSelect');
        const coordSys = (coordSysEl && coordSysEl.value) || 'wgs84';
        const isHash = text.indexOf('#') !== -1;
        const items = isHash ? text.split('#') : text.split(/\r?\n/);
        const out = [];
        for (let i=0;i<items.length;i++){
            const raw = items[i];
            if (!raw) continue;
            const line = raw.trim();
            if (!line) continue;
            const parts = line.split(',');
            if (parts.length < 3) continue;
            const tsRaw = (parts[isHash ? 2 : 0] || '').trim();
            const ts = (tsRaw || '').replace(/\D/g,'');
            let lng = parseFloat((parts[isHash ? 0 : 1] || '').trim());
            let lat = parseFloat((parts[isHash ? 1 : 2] || '').trim());
            if (!isFinite(lng) || !isFinite(lat)) continue;
            if (lng === 0 || lat === 0) continue;
            if (lng < -180 || lng > 180 || lat < -90 || lat > 90) continue;
            const t = parseTimestamp(ts);
            if (!t) continue;
            let w;
            if (coordSys === 'wgs84' || coordSys === 'cgcs2000') {
                w = { lng, lat };
            } else if (coordSys === 'gcj02') {
                w = gcj02ToWgs84(lng, lat);
            } else if (coordSys === 'bd09') {
                const g = bd09ToGcj02(lng, lat);
                w = gcj02ToWgs84(g.lng, g.lat);
            } else { w = { lng, lat }; }
            if (!isFinite(w.lng) || !isFinite(w.lat)) continue;
            if (w.lng < -180 || w.lng > 180 || w.lat < -90 || w.lat > 90) continue;
            out.push({ ll: new T.LngLat(w.lng, w.lat), time: t, ts });
        }
        out.sort((a,b)=>a.time - b.time);
        return out;
    }

    function parseTimestamp(ts){
        const tstr = (ts || '').replace(/\D/g,'');
        const m = tstr && tstr.match(/^\d{14}$/);
        if (!m) return null;
        const y = parseInt(tstr.slice(0,4),10);
        const M = parseInt(tstr.slice(4,6),10) - 1;
        const d = parseInt(tstr.slice(6,8),10);
        const h = parseInt(tstr.slice(8,10),10);
        const m2 = parseInt(tstr.slice(10,12),10);
        const s = parseInt(tstr.slice(12,14),10);
        const dt = new Date(y,M,d,h,m2,s);
        return isNaN(dt.getTime()) ? null : dt;
    }

    function startPlayback(points){
        console.log('[Playback] startPlayback: 点数=', points && points.length);
        stopPlayback();
        playbackState.points = points;
        playbackState.idx = 0;
        playbackState.speed = playbackState.speed || 1;
        playbackState.running = true;
        // 配置时间滑动条，并尊重现有滑块位置作为起始
        configureTimeSlider(points);
        // 启用滑块
        const slider = document.getElementById('playbackTimeSlider');
        if (slider) slider.disabled = false;
        let initIdx = 0;
        if (slider && slider.min && slider.max) {
            const ms = parseInt(slider.value, 10);
            if (isFinite(ms)) initIdx = findIndexByTime(points, ms);
        }
        playbackState.idx = initIdx;
        const first = points[initIdx];
        console.log('[Playback] 首点:', first && first.ts, first && first.ll, 'initIdx=', initIdx);
        playbackState.path = points.slice(0, initIdx+1).map(p=>p.ll);
        playbackState.line = new T.Polyline(playbackState.path, { color: currentTrackLineColor, weight: 1, opacity: 0.9 });
        if (map) {
            map.addOverLay(playbackState.line);
        }
        currentTracks.push(playbackState.line);
        // 创建并定位DOM标记以保证可见移动
        ensurePlaybackDom(first.ll);
        updatePlaybackDom(first.ll);
        updatePlaybackTimeLabel(first.ts);
        try { fitViewportToTrack(points.map(p=>p.ll)); } catch(e){}
        // 更新按钮状态
        updatePlaybackButtonsState('playing');
        scheduleNext();
    }

    function scheduleNext(){
        if (!playbackState.running) return;
        if (!playbackState.points || playbackState.idx >= playbackState.points.length - 1) {
            playbackState.running = false;
            console.log('[Playback] 回放结束：idx=', playbackState.idx, '点数=', playbackState.points ? playbackState.points.length : 0);
            updatePlaybackButtonsState('idle'); // 播放结束后按钮回到初始状态：开始可点，继续/结束灰化
            return;
        }
        const next = playbackState.points[playbackState.idx+1];
        const speed = playbackState.speed || 1;
        const delay = Math.max(4, Math.round(1000 / speed)); // 1x=1000ms/点，2x=500ms/点...
        console.log('[Playback] scheduleNext: idx=', playbackState.idx, '->', playbackState.idx+1, 'delay=', delay, 'speed=', speed);
        playbackState.timer = setTimeout(()=>{
            playbackState.idx++;
            const nextLL = next.ll;
            console.log('[Playback] 下一点:', next && next.ts, nextLL);
            try {
                // 维护路径数组
                playbackState.path = playbackState.path || [];
                playbackState.path.push(nextLL);
                console.log('[Playback] 路径长度=', playbackState.path.length);
                // 使用DOM标记进行移动（容器/图层坐标）
                if (!playbackDom.el) console.log('[Playback] DOM标记不存在，将尝试创建');
                updatePlaybackDom(nextLL);
                // 折线更新：优先setLngLats，兜底重建
                if (playbackState.line && typeof playbackState.line.setLngLats === 'function') {
                    try { playbackState.line.setLngLats(playbackState.path); }
                    catch(e){
                        console.warn('[Playback] setLngLats失败，重建折线', e);
                        if (map) { try { map.removeOverLay(playbackState.line); } catch(e){} }
                        playbackState.line = new T.Polyline(playbackState.path, { color: currentTrackLineColor, weight: 1, opacity: 0.9 });
                        if (map) map.addOverLay(playbackState.line);
                    }
                } else {
                    console.log('[Playback] 折线不支持setLngLats，重建');
                    if (playbackState.line && map) { try { map.removeOverLay(playbackState.line); } catch(e){} }
                    playbackState.line = new T.Polyline(playbackState.path, { color: currentTrackLineColor, weight: 1, opacity: 0.9 });
                    if (map) map.addOverLay(playbackState.line);
                }
            } catch(e) { console.warn('更新回放覆盖物失败:', e); }
            updatePlaybackTimeLabel(next.ts);
            scheduleNext();
        }, delay);
    }

    function stopPlayback(){
        if (playbackState.timer) { clearTimeout(playbackState.timer); playbackState.timer = null; }
        playbackState.running = false;
        playbackState.idx = 0;
        try {
            // 移除DOM标记
            removePlaybackDom();
            if (playbackState.marker && map) map.removeOverLay(playbackState.marker);
            if (playbackState.line && map) map.removeOverLay(playbackState.line);
        } catch(e){}
        playbackState.marker = null;
        playbackState.line = null;
        updatePlaybackTimeLabel('—');
        // 按钮回到初始状态
        updatePlaybackButtonsState('idle');
    }

    function updatePlaybackTimeLabel(text){
        const el = document.getElementById('playbackTimeLabel');
        if (el) el.textContent = '时间：' + (text || '—');
    }

    // 时间滑动条：配置与跳转
    function configureTimeSlider(points){
        try {
            const slider = document.getElementById('playbackTimeSlider');
            const cursor = document.getElementById('playbackTimeCursor');
            if (!slider || !points || !points.length) return;
            const minMs = points[0].time.getTime();
            const maxMs = points[points.length - 1].time.getTime();
            const prev = parseInt(slider.value, 10);
            slider.min = String(minMs);
            slider.max = String(maxMs);
            slider.step = '1000'; // 以秒为步进
            let val = (isFinite(prev) && prev >= minMs && prev <= maxMs) ? prev : minMs;
            slider.value = String(val);
            if (cursor) cursor.textContent = formatTimeForLabel(val);
        } catch(e) { console.warn('配置时间滑动条失败:', e); }
    }
    function formatTimeForLabel(ms){
        if (!isFinite(ms)) return '—';
        const d = new Date(ms);
        const pad = n => String(n).padStart(2,'0');
        const y = d.getFullYear();
        const M = pad(d.getMonth()+1);
        const da = pad(d.getDate());
        const h = pad(d.getHours());
        const m = pad(d.getMinutes());
        const s = pad(d.getSeconds());
        return `${y}-${M}-${da} ${h}:${m}:${s}`;
    }
    function findIndexByTime(points, ms){
        try {
            if (!points || !points.length) return 0;
            const n = points.length;
            const minMs = points[0].time.getTime();
            const maxMs = points[n-1].time.getTime();
            if (!isFinite(ms)) return 0;
            if (ms <= minMs) return 0;
            if (ms >= maxMs) return n-1;
            let lo = 0, hi = n - 1, ans = 0;
            while (lo <= hi) {
                const mid = (lo + hi) >> 1;
                const t = points[mid].time.getTime();
                if (t < ms) { lo = mid + 1; ans = lo; }
                else { hi = mid - 1; ans = mid; }
            }
            return Math.max(0, Math.min(n-1, ans));
        } catch(e){ console.warn('findIndexByTime失败:', e); return 0; }
    }
    function jumpToSliderTime(){
        try {
            const slider = document.getElementById('playbackTimeSlider');
            if (!slider || !playbackState.points || !playbackState.points.length) return;
            const ms = parseInt(slider.value, 10);
            if (!isFinite(ms)) return;
            const idx = findIndexByTime(playbackState.points, ms);
            playbackState.idx = idx;
            const pts = playbackState.points;
            const ll = pts[idx].ll;
            playbackState.path = pts.slice(0, idx+1).map(p=>p.ll);
            // 更新折线
            try {
                if (playbackState.line && typeof playbackState.line.setLngLats === 'function') {
                    playbackState.line.setLngLats(playbackState.path);
                } else {
                    if (playbackState.line && map) { try { map.removeOverLay(playbackState.line); } catch(e){} }
                    playbackState.line = new T.Polyline(playbackState.path, { color: currentTrackLineColor, weight: 1, opacity: 0.9 });
                    if (map) map.addOverLay(playbackState.line);
                }
            } catch(e){ console.warn('滑块更新折线失败:', e); }
            // 更新标记与时间
            ensurePlaybackDom(ll);
            updatePlaybackDom(ll);
            updatePlaybackTimeLabel(pts[idx].ts);
            // 若正在播放，立即按新位置继续
            if (playbackState.running) {
                if (playbackState.timer) { clearTimeout(playbackState.timer); playbackState.timer = null; }
                scheduleNext();
            }
        } catch(e) { console.warn('滑块跳转失败:', e); }
    }

    // DOM标记：使用容器坐标实现可见移动
    let playbackDom = { el: null, lastLL: null, bound: false };

    function ensurePlaybackDom(ll){
        try {
            playbackDom.lastLL = ll;
            const pane = (map && map.getPanes && map.getPanes().overlayPane) || document.getElementById('mapContainer');
            if (!pane) { console.warn('未找到overlayPane或mapContainer'); return; }
            if (!playbackDom.el) {
                const el = document.createElement('div');
                el.id = 'playbackDomMarker';
                el.style.position = 'absolute';
                el.style.width = '0';
                el.style.height = '0';
                el.style.borderLeft = '3px solid transparent';
                el.style.borderRight = '3px solid transparent';
                el.style.borderBottom = '4px solid #2C64A7';
                el.style.borderTop = '0';
                el.style.transform = 'translate(-50%, -50%)';
                el.style.zIndex = '9999';
                // 添加伪元素来增强箭头效果
                el.style.clipPath = 'polygon(50% 0, 100% 100%, 0 100%)';
                pane.appendChild(el);
                playbackDom.el = el;
                console.log('[Playback] 创建DOM标记，父节点=', pane === document.getElementById('mapContainer') ? '#mapContainer' : 'overlayPane');
                bindPlaybackDomEvents();
            }
            updatePlaybackDom(ll);
        } catch(e) { console.warn('创建DOM标记失败:', e); }
    }

    function updatePlaybackDom(ll){
        try {
            playbackDom.lastLL = ll;
            if (!map || !playbackDom.el || !ll) { console.log('[Playback] update取消：map/el/ll缺失'); return; }
            let p;
            if (typeof map.lngLatToLayerPoint === 'function') {
                p = map.lngLatToLayerPoint(ll);
                console.log('[Playback] 使用layerPoint定位:', ll && ll.lng, ll && ll.lat, '=>', p && p.x, p && p.y);
            } else if (typeof map.lngLatToContainerPoint === 'function') {
                p = map.lngLatToContainerPoint(ll);
                console.log('[Playback] 使用containerPoint定位:', ll && ll.lng, ll && ll.lat, '=>', p && p.x, p && p.y);
            } else {
                console.warn('地图对象不支持lngLat到像素坐标转换');
                return;
            }
            playbackDom.el.style.left = p.x + 'px';
            playbackDom.el.style.top = p.y + 'px';
        } catch(e) { console.warn('更新DOM标记位置失败:', e); }
    }

    function bindPlaybackDomEvents(){
        if (playbackDom.bound) return;
        const updater = function(){
            try {
                if (!map || !playbackDom.el || !playbackDom.lastLL) return;
                let p;
                if (typeof map.lngLatToLayerPoint === 'function') {
                    p = map.lngLatToLayerPoint(playbackDom.lastLL);
                } else if (typeof map.lngLatToContainerPoint === 'function') {
                    p = map.lngLatToContainerPoint(playbackDom.lastLL);
                }
                if (!p) return;
                playbackDom.el.style.left = p.x + 'px';
                playbackDom.el.style.top = p.y + 'px';
            } catch(e){}
        };
        try {
            map.addEventListener('move', updater);
            map.addEventListener('zoom', updater);
            playbackDom.bound = true;
        } catch(e){}
    }

    function removePlaybackDom(){
        try {
            const el = playbackDom.el;
            playbackDom.lastLL = null;
            if (el && el.parentNode) el.parentNode.removeChild(el);
        } catch(e){}
        playbackDom.el = null;
        playbackDom.bound = false;
    }

    // 测量功能相关变量
    let measureState = {
        isActive: false,
        mode: '', // 'distance' or 'area'
        points: [],
        tempLine: null,
        lines: [],
        markers: [],
        labels: [],
        polygon: null,
        areaLabel: null
    };

    // 绑定测量按钮事件
    function bindMeasureEvents() {
        const distanceBtn = document.getElementById('measureDistanceBtn');
        const areaBtn = document.getElementById('measureAreaBtn');
        
        if (distanceBtn) {
            distanceBtn.addEventListener('click', function() {
                startMeasureDistance();
            });
        }
        
        if (areaBtn) {
            areaBtn.addEventListener('click', function() {
                startMeasureArea();
            });
        }
    }

    // 绑定地图类型切换按钮事件
    function bindMapTypeEvent() {
        const mapTypeBtn = document.getElementById('mapTypeBtn');
        
        if (mapTypeBtn) {
            mapTypeBtn.addEventListener('click', function() {
                toggleMapType();
            });
        }
    }

    // 切换地图类型
    function toggleMapType() {
        if (!map) {
            alert('地图未初始化');
            return;
        }
        
        // 切换地图类型
        if (currentMapType === 'satellite') {
            // 切换到街道地图
            map.setMapType(TMAP_NORMAL_MAP);
            currentMapType = 'street';
            updateMapTypeButton('街道图');
        } else {
            // 切换到卫星地图
            map.setMapType(TMAP_SATELLITE_MAP);
            currentMapType = 'satellite';
            updateMapTypeButton('卫星图');
        }
    }

    // 更新地图类型按钮显示
    function updateMapTypeButton(typeName) {
        const mapTypeBtn = document.getElementById('mapTypeBtn');
        if (mapTypeBtn) {
            mapTypeBtn.innerHTML = `<span>${typeName}</span>`;
            mapTypeBtn.title = `当前：${typeName}，点击切换`;
        }
    }

    // 开始测距
    function startMeasureDistance() {
        if (!map) {
            alert('地图未初始化');
            return;
        }
        
        // 先移除所有可能存在的事件监听器
        try {
            map.removeEventListener('click', handleMapClick);
            map.removeEventListener('click', handleAreaMapClick);
            map.removeEventListener('mousemove', handleMouseMove);
            map.removeEventListener('mousemove', handleAreaMouseMove);
            map.removeEventListener('dblclick', finishMeasure);
            map.removeEventListener('dblclick', finishAreaMeasure);
        } catch(e) {
            console.log('移除事件监听器时出错:', e);
        }
        
        // 重置测量状态
        clearMeasureResult();
        
        // 设置测量状态为激活
        measureState.isActive = true;
        measureState.mode = 'distance'; // 设置为距离测量模式
        
        // 禁用其他按钮
        disableButtons(true);
        
        // 添加地图点击事件监听器
        map.addEventListener('click', handleMapClick);
        
        // 添加鼠标移动事件监听器
        map.addEventListener('mousemove', handleMouseMove);
        
        // 添加双击事件监听器结束测量
        map.addEventListener('dblclick', finishMeasure);
        
        console.log('测距功能已启动');
    }

    // 开始测面
    function startMeasureArea() {
        if (!map) {
            alert('地图未初始化');
            return;
        }
        
        // 先移除所有可能存在的事件监听器
        try {
            map.removeEventListener('click', handleMapClick);
            map.removeEventListener('click', handleAreaMapClick);
            map.removeEventListener('mousemove', handleMouseMove);
            map.removeEventListener('mousemove', handleAreaMouseMove);
            map.removeEventListener('dblclick', finishMeasure);
            map.removeEventListener('dblclick', finishAreaMeasure);
        } catch(e) {
            console.log('移除事件监听器时出错:', e);
        }
        
        // 重置测量状态
        clearMeasureResult();
        
        // 设置测量状态为激活
        measureState.isActive = true;
        measureState.mode = 'area'; // 设置为面积测量模式
        
        // 禁用其他按钮
        disableButtons(true);
        
        // 添加地图点击事件监听器
        map.addEventListener('click', handleAreaMapClick);
        
        // 添加鼠标移动事件监听器
        map.addEventListener('mousemove', handleAreaMouseMove);
        
        // 添加双击事件监听器结束测量
        map.addEventListener('dblclick', finishAreaMeasure);
        
        console.log('测面功能已启动');
    }

    // 处理地图点击事件
    function handleMapClick(event) {
        if (!measureState.isActive || measureState.mode !== 'distance') return;
        
        const point = event.lnglat;
        measureState.points.push(point);
        
        // 创建小圆点图标
        const smallDotIcon = new T.Icon({
            iconUrl: 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="8" height="8"><circle cx="4" cy="4" r="3" fill="%23FF0000" stroke="%23FFFFFF" stroke-width="1"/></svg>',
            iconSize: new T.Point(8, 8),
            iconAnchor: new T.Point(4, 4)
        });
        
        // 创建点标记
        const marker = new T.Marker(point, {icon: smallDotIcon});
        map.addOverLay(marker);
        measureState.markers.push(marker);
        
        // 如果不是第一个点，创建线段
        if (measureState.points.length > 1) {
            const prevPoint = measureState.points[measureState.points.length - 2];
            const line = new T.Polyline([prevPoint, point], {
                color: '#FF0000',
                weight: 3,
                opacity: 0.8
            });
            map.addOverLay(line);
            measureState.lines.push(line);
            
            // 计算距离并显示标签
            const distance = calculateDistance(prevPoint, point);
            showDistanceLabel(point, distance);
        }
        
        // 移除临时线
        if (measureState.tempLine) {
            map.removeOverLay(measureState.tempLine);
            measureState.tempLine = null;
        }
    }

    // 处理测面地图点击事件
    function handleAreaMapClick(event) {
        if (!measureState.isActive || measureState.mode !== 'area') return;
        
        const point = event.lnglat;
        measureState.points.push(point);
        
        // 创建小圆点图标（与测距功能一致）
        const smallDotIcon = new T.Icon({
            iconUrl: 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="8" height="8"><circle cx="4" cy="4" r="3" fill="%23FF0000" stroke="%23FFFFFF" stroke-width="1"/></svg>',
            iconSize: new T.Point(8, 8),
            iconAnchor: new T.Point(4, 4)
        });
        
        // 创建点标记
        const marker = new T.Marker(point, {icon: smallDotIcon});
        map.addOverLay(marker);
        measureState.markers.push(marker);
        
        // 移除之前的多边形
        if (measureState.polygon) {
            map.removeOverLay(measureState.polygon);
        }
        
        // 如果点数大于2，创建多边形
        if (measureState.points.length >= 3) {
            const polygon = new T.Polygon(measureState.points, {
                color: currentOutlineColor,
                weight: 3,
                opacity: 0.8,
                fillColor: currentFillColor,
                fillOpacity: currentFillOpacity
            });
            map.addOverLay(polygon);
            measureState.polygon = polygon;
            
            // 计算面积并显示标签
            const area = calculatePolygonArea(measureState.points);
            showAreaLabel(getPolygonCenter(measureState.points), area);
        }
        
        // 移除临时线
        if (measureState.tempLine) {
            map.removeOverLay(measureState.tempLine);
            measureState.tempLine = null;
        }
    }

    // 处理鼠标移动事件
    function handleMouseMove(event) {
        if (!measureState.isActive || measureState.mode !== 'distance' || measureState.points.length === 0) return;
        
        const lastPoint = measureState.points[measureState.points.length - 1];
        const currentPoint = event.lnglat;
        
        // 移除之前的临时线
        if (measureState.tempLine) {
            map.removeOverLay(measureState.tempLine);
        }
        
        // 创建新的临时线
        measureState.tempLine = new T.Polyline([lastPoint, currentPoint], {
            color: '#0000FF',
            weight: 2,
            opacity: 0.6,
            dashArray: [5, 5]
        });
        map.addOverLay(measureState.tempLine);
    }

    // 处理测面鼠标移动事件
    function handleAreaMouseMove(event) {
        if (!measureState.isActive || measureState.mode !== 'area' || measureState.points.length === 0) return;
        
        const firstPoint = measureState.points[0];
        const lastPoint = measureState.points[measureState.points.length - 1];
        const currentPoint = event.lnglat;
        
        // 移除之前的临时线
        if (measureState.tempLine) {
            map.removeOverLay(measureState.tempLine);
        }
        
        // 创建新的临时线（从最后一个点到当前点，再到第一个点形成闭合效果）
        const tempPoints = [lastPoint, currentPoint];
        if (measureState.points.length >= 2) {
            tempPoints.push(firstPoint);
        }
        
        measureState.tempLine = new T.Polyline(tempPoints, {
            color: '#0000FF',
            weight: 2,
            opacity: 0.6,
            dashArray: [5, 5]
        });
        map.addOverLay(measureState.tempLine);
    }

    // 结束测量
    function finishMeasure() {
        if (!measureState.isActive || measureState.mode !== 'distance') return;
        
        // 移除事件监听器
        map.removeEventListener('click', handleMapClick);
        map.removeEventListener('mousemove', handleMouseMove);
        map.removeEventListener('dblclick', finishMeasure);
        
        // 移除临时线
        if (measureState.tempLine) {
            map.removeOverLay(measureState.tempLine);
            measureState.tempLine = null;
        }
        
        // 显示总距离
        if (measureState.points.length > 1) {
            const totalDistance = calculateTotalDistance();
            showTotalDistanceLabel(totalDistance);
        }
        
        // 重置测量状态
        measureState.isActive = false;
        measureState.mode = '';
        
        // 恢复其他按钮
        disableButtons(false);
        
        console.log('测距功能已完成');
    }

    // 结束测面测量
    function finishAreaMeasure() {
        if (!measureState.isActive || measureState.mode !== 'area') return;
        
        // 移除事件监听器
        map.removeEventListener('click', handleAreaMapClick);
        map.removeEventListener('mousemove', handleAreaMouseMove);
        map.removeEventListener('dblclick', finishAreaMeasure);
        
        // 移除临时线
        if (measureState.tempLine) {
            map.removeOverLay(measureState.tempLine);
            measureState.tempLine = null;
        }
        
        // 如果点数大于等于3，创建最终多边形
        if (measureState.points.length >= 3) {
            // 移除之前的多边形
            if (measureState.polygon) {
                map.removeOverLay(measureState.polygon);
            }
            
            const polygon = new T.Polygon(measureState.points, {
                color: currentOutlineColor,
                weight: 3,
                opacity: 0.8,
                fillColor: currentFillColor,
                fillOpacity: currentFillOpacity
            });
            map.addOverLay(polygon);
            measureState.polygon = polygon;
            
            // 计算并显示总面积
            const area = calculatePolygonArea(measureState.points);
            showTotalAreaLabel(getPolygonCenter(measureState.points), area);
        } else {
            // 点数不足3个，移除所有标记
            clearMeasureResult();
        }
        
        // 重置测量状态
        measureState.isActive = false;
        measureState.mode = '';
        
        // 恢复其他按钮
        disableButtons(false);
        
        console.log('测面功能已完成');
    }

    // 计算两点间距离（米）
    function calculateDistance(point1, point2) {
        // 使用天地图提供的距离计算方法
        if (T.CRS && T.CRS.EPSG4326 && T.CRS.EPSG4326.distance) {
            return T.CRS.EPSG4326.distance(point1, point2);
        }
        
        // 如果没有提供，则使用球面距离公式
        const R = 6371000; // 地球半径（米）
        const dLat = (point2.lat - point1.lat) * Math.PI / 180;
        const dLon = (point2.lng - point1.lng) * Math.PI / 180;
        const a = 
            Math.sin(dLat/2) * Math.sin(dLat/2) +
            Math.cos(point1.lat * Math.PI / 180) * Math.cos(point2.lat * Math.PI / 180) * 
            Math.sin(dLon/2) * Math.sin(dLon/2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        return R * c;
    }

    // 计算多边形面积（平方米）
    function calculatePolygonArea(points) {
        // 使用天地图提供的面积计算方法（如果可用）
        if (T.GeometryUtils && T.GeometryUtils.computeArea) {
            return T.GeometryUtils.computeArea(points);
        }
        
        // 如果没有提供，则使用球面多边形面积计算公式
        // 这里使用简单的平面近似计算，对于小面积比较准确
        if (points.length < 3) return 0;
        
        let area = 0;
        const n = points.length;
        
        for (let i = 0; i < n; i++) {
            const j = (i + 1) % n;
            area += points[i].lng * points[j].lat;
            area -= points[j].lng * points[i].lat;
        }
        
        area = Math.abs(area) / 2.0;
        
        // 转换为平方米（这是一个简化的近似值）
        // 更精确的计算需要考虑地球曲率
        const earthRadius = 6371000; // 地球半径（米）
        const degreeToMeter = (2 * Math.PI * earthRadius) / 360; // 每度对应的米数
        
        // 这个转换只是一个粗略的近似
        return area * degreeToMeter * degreeToMeter;
    }

    // 获取多边形中心点
    function getPolygonCenter(points) {
        if (points.length === 0) return null;
        
        let x = 0, y = 0;
        for (let i = 0; i < points.length; i++) {
            x += points[i].lng;
            y += points[i].lat;
        }
        
        return new T.LngLat(x / points.length, y / points.length);
    }

    // 计算总距离
    function calculateTotalDistance() {
        let total = 0;
        for (let i = 1; i < measureState.points.length; i++) {
            const distance = calculateDistance(measureState.points[i-1], measureState.points[i]);
            total += distance;
        }
        return total;
    }

    // 显示两点间距离标签
    function showDistanceLabel(point, distance) {
        const label = document.createElement('div');
        label.className = 'distance-label';
        label.innerHTML = distance.toFixed(2) + ' 米';
        label.style.position = 'absolute';
        label.style.backgroundColor = 'rgba(255, 255, 255, 0.9)';
        label.style.padding = '2px 6px';
        label.style.borderRadius = '3px';
        label.style.fontSize = '12px';
        label.style.boxShadow = '0 1px 2px rgba(0,0,0,0.3)';
        label.style.zIndex = '1000';
        label.style.transform = 'translate(-50%, -50%)';
        
        // 添加删除按钮
        const closeBtn = document.createElement('span');
        closeBtn.innerHTML = '×';
        closeBtn.style.marginLeft = '5px';
        closeBtn.style.cursor = 'pointer';
        closeBtn.style.fontWeight = 'bold';
        closeBtn.onclick = function() {
            if (label.parentNode) {
                label.parentNode.removeChild(label);
            }
        };
        label.appendChild(closeBtn);
        
        document.getElementById('mapContainer').appendChild(label);
        
        // 定位标签（向上偏移20像素）
        const pixel = map.lngLatToContainerPoint(point);
        label.style.left = pixel.x + 'px';
        label.style.top = (pixel.y - 20) + 'px';
        
        measureState.labels.push(label);
    }

    // 显示面积标签
    function showAreaLabel(point, area) {
        // 如果已存在面积标签，先移除它
        if (measureState.areaLabel) {
            if (measureState.areaLabel.parentNode) {
                measureState.areaLabel.parentNode.removeChild(measureState.areaLabel);
            }
        }
        
        const label = document.createElement('div');
        label.className = 'area-label';
        label.innerHTML = area.toFixed(2) + ' 平方米';
        label.style.position = 'absolute';
        label.style.backgroundColor = 'rgba(255, 255, 255, 0.9)';
        label.style.padding = '2px 6px';
        label.style.borderRadius = '3px';
        label.style.fontSize = '12px';
        label.style.boxShadow = '0 1px 2px rgba(0,0,0,0.3)';
        label.style.zIndex = '1000';
        label.style.transform = 'translate(-50%, -50%)';
        
        // 添加删除按钮
        const closeBtn = document.createElement('span');
        closeBtn.innerHTML = '×';
        closeBtn.style.marginLeft = '5px';
        closeBtn.style.cursor = 'pointer';
        closeBtn.style.fontWeight = 'bold';
        closeBtn.onclick = function() {
            if (label.parentNode) {
                label.parentNode.removeChild(label);
            }
        };
        label.appendChild(closeBtn);
        
        document.getElementById('mapContainer').appendChild(label);
        
        // 定位标签
        const pixel = map.lngLatToContainerPoint(point);
        label.style.left = pixel.x + 'px';
        label.style.top = (pixel.y - 20) + 'px';
        
        measureState.areaLabel = label;
        measureState.labels.push(label);
    }

    // 显示总面积标签
    function showTotalAreaLabel(point, area) {
        // 如果已存在面积标签，先移除它
        if (measureState.areaLabel) {
            if (measureState.areaLabel.parentNode) {
                measureState.areaLabel.parentNode.removeChild(measureState.areaLabel);
            }
        }
        
        // 计算亩数（1亩 ≈ 666.6667平方米）
        const areaInMu = area / 666.6667;
        
        const label = document.createElement('div');
        label.className = 'total-area-label';
        label.innerHTML = '总面积: ' + area.toFixed(2) + ' 平方米<br>' + areaInMu.toFixed(2) + ' 亩';
        label.style.position = 'absolute';
        label.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
        label.style.color = 'white';
        label.style.padding = '4px 8px';
        label.style.borderRadius = '4px';
        label.style.fontSize = '14px';
        label.style.fontWeight = 'bold';
        label.style.boxShadow = '0 2px 4px rgba(0,0,0,0.3)';
        label.style.zIndex = '1000';
        label.style.transform = 'translate(-50%, -50%)';
        label.style.lineHeight = '1.4';
        
        // 添加删除按钮
        const closeBtn = document.createElement('span');
        closeBtn.innerHTML = ' ×';
        closeBtn.style.cursor = 'pointer';
        closeBtn.style.fontWeight = 'bold';
        closeBtn.onclick = function() {
            if (label.parentNode) {
                label.parentNode.removeChild(label);
            }
        };
        label.appendChild(closeBtn);
        
        document.getElementById('mapContainer').appendChild(label);
        
        // 定位标签
        const pixel = map.lngLatToContainerPoint(point);
        label.style.left = pixel.x + 'px';
        label.style.top = (pixel.y - 40) + 'px';
        
        measureState.areaLabel = label;
        measureState.labels.push(label);
    }

    // 显示总距离标签
    function showTotalDistanceLabel(totalDistance) {
        const lastPoint = measureState.points[measureState.points.length - 1];
        const label = document.createElement('div');
        label.className = 'total-distance-label';
        label.innerHTML = '总距离: ' + totalDistance.toFixed(2) + ' 米';
        label.style.position = 'absolute';
        label.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
        label.style.color = 'white';
        label.style.padding = '4px 8px';
        label.style.borderRadius = '4px';
        label.style.fontSize = '14px';
        label.style.fontWeight = 'bold';
        label.style.boxShadow = '0 2px 4px rgba(0,0,0,0.3)';
        label.style.zIndex = '1000';
        label.style.transform = 'translate(-50%, -50%)';
        
        // 添加删除按钮
        const closeBtn = document.createElement('span');
        closeBtn.innerHTML = ' ×';
        closeBtn.style.cursor = 'pointer';
        closeBtn.style.fontWeight = 'bold';
        closeBtn.onclick = function() {
            if (label.parentNode) {
                label.parentNode.removeChild(label);
            }
        };
        label.appendChild(closeBtn);
        
        document.getElementById('mapContainer').appendChild(label);
        
        // 定位标签（向上偏移40像素，比段距离标签更高）
        const pixel = map.lngLatToContainerPoint(lastPoint);
        label.style.left = pixel.x + 'px';
        label.style.top = (pixel.y - 60) + 'px';  // 从-40改为-60，增加间距
        
        measureState.labels.push(label);
    }

    // 清除测量结果
    function clearMeasureResult() {
        // 移除所有线条
        measureState.lines.forEach(line => {
            if (map && map.removeOverLay) {
                try { map.removeOverLay(line); } catch(e) {}
            }
        });
        
        // 移除所有标记
        measureState.markers.forEach(marker => {
            if (map && map.removeOverLay) {
                try { map.removeOverLay(marker); } catch(e) {}
            }
        });
        
        // 移除所有标签
        measureState.labels.forEach(label => {
            if (label.parentNode) {
                try { label.parentNode.removeChild(label); } catch(e) {}
            }
        });
        
        // 移除临时线
        if (measureState.tempLine) {
            if (map && map.removeOverLay) {
                try { map.removeOverLay(measureState.tempLine); } catch(e) {}
            }
            measureState.tempLine = null;
        }
        
        // 移除多边形
        if (measureState.polygon) {
            if (map && map.removeOverLay) {
                try { map.removeOverLay(measureState.polygon); } catch(e) {}
            }
            measureState.polygon = null;
        }
        
        // 移除面积标签
        if (measureState.areaLabel) {
            if (measureState.areaLabel.parentNode) {
                try { measureState.areaLabel.parentNode.removeChild(measureState.areaLabel); } catch(e) {}
            }
            measureState.areaLabel = null;
        }
        
        // 重置状态
        measureState.points = [];
        measureState.lines = [];
        measureState.markers = [];
        measureState.labels = [];
        measureState.isActive = false;
        measureState.mode = '';
    }

    // 添加CSS样式用于距离标签
    const style = document.createElement('style');
    style.innerHTML = `
        .distance-label, .total-distance-label {
            font-family: Arial, sans-serif;
            pointer-events: auto;
        }
    `;
    document.head.appendChild(style);

    // 颜色选择器相关变量和函数
    let currentOutlineColor = "#FFD700"; // 默认边框颜色
    let currentFillColor = "#FFFF00";   // 默认填充颜色
    let currentFillOpacity = 0.35;       // 默认透明度
    
    // 轨迹颜色相关变量
    let currentTrackLineColor = "#FF0000"; // 默认轨迹线颜色
    let currentTrackPointColor = "#68EAF3"; // 默认轨迹点颜色

    // 初始化颜色选择器
    function initColorPickers() {
        // 边框颜色选择器
        const outlineColorPicker = document.getElementById('outlineColorPicker');
        const outlineColorInput = document.getElementById('outlineColorInput');
        
        outlineColorPicker.addEventListener('click', function() {
            outlineColorInput.click();
        });
        
        outlineColorInput.addEventListener('change', function() {
            currentOutlineColor = this.value;
            outlineColorPicker.style.backgroundColor = currentOutlineColor;
        });
        
        // 填充颜色选择器
        const fillColorPicker = document.getElementById('fillColorPicker');
        const fillColorInput = document.getElementById('fillColorInput');
        
        fillColorPicker.addEventListener('click', function() {
            fillColorInput.click();
        });
        
        fillColorInput.addEventListener('change', function() {
            currentFillColor = this.value;
            fillColorPicker.style.backgroundColor = currentFillColor;
        });
        
        // 透明度滑块
        const fillOpacitySlider = document.getElementById('fillOpacitySlider');
        const fillOpacityValue = document.getElementById('fillOpacityValue');
        
        fillOpacitySlider.addEventListener('input', function() {
            currentFillOpacity = this.value / 100;
            fillOpacityValue.textContent = this.value + '%';
        });
        
        // 轨迹线颜色选择器
        const trackLineColorPicker = document.getElementById('trackLineColorPicker');
        const trackLineColorInput = document.getElementById('trackLineColorInput');
        
        if (trackLineColorPicker && trackLineColorInput) {
            trackLineColorPicker.addEventListener('click', function() {
                trackLineColorInput.click();
            });
            
            trackLineColorInput.addEventListener('change', function() {
                currentTrackLineColor = this.value;
                trackLineColorPicker.style.backgroundColor = currentTrackLineColor;
            });
        }
        
        // 轨迹点颜色选择器
        const trackPointColorPicker = document.getElementById('trackPointColorPicker');
        const trackPointColorInput = document.getElementById('trackPointColorInput');
        
        if (trackPointColorPicker && trackPointColorInput) {
            // 设置初始背景色
            trackPointColorPicker.style.backgroundColor = currentTrackPointColor;
            
            trackPointColorPicker.addEventListener('click', function() {
                trackPointColorInput.click();
            });
            
            trackPointColorInput.addEventListener('change', function() {
                currentTrackPointColor = this.value;
                trackPointColorPicker.style.backgroundColor = currentTrackPointColor;
            });
        }
    }

</script>
</body>

</html>
