<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>展示轮廓</title>
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #mapContainer {
            width: 100vw;
            height: 100vh;
            position: relative;
        }

        #mapLoading {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 999;
            transition: opacity 0.3s;
        }

        .loading-text {
            font-size: 16px;
            color: #333;
            padding: 10px 20px;
            background: white;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .wkt-input-container {
            position: absolute;
            top: 20px;
            right: 10px;
            z-index: 1000;
            background: white;
            padding: 12px;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            width: min(320px, 90vw);
            box-sizing: border-box;
            transition: all 0.3s;
        }

        .minimize-btn {
            position: absolute;
            top: -5px;
            right: -4px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #f0f0f0;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: #666;
            z-index: 1001;
            transition: background 0.2s;
        }

        .minimize-btn:hover {
            background: #e0e0e0;
        }

        .content-wrapper {
            transition: all 0.3s;
        }

        .wkt-input-container.minimized {
            width: 40px;
            height: 40px;
            padding: 0;
        }

        .wkt-input-container.minimized .content-wrapper {
            display: none;
        }

        .wkt-input-container.minimized .min-icon {
            display: none;
        }

        .wkt-input-container.minimized .restore-icon {
            display: inline;
        }

        #wktTextarea {
            width: 100%;
            height: 120px;
            margin-bottom: 10px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
            resize: vertical;
            box-sizing: border-box;
        }

        .button-group {
            display: flex;
            gap: 10px;
        }

        /* 页签样式 */
        .tabs-header {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
        }
        .tab-btn {
            flex: 1;
            padding: 6px 0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            background: #f5f5f5;
            color: #333;
            transition: background 0.2s;
        }
        .tab-btn.active { background: #337AFF; color: #fff; }
        .tab-pane { display: none; }
        .tab-pane.active { display: block; }

        /* Multi → Polygons 分割器样式 */
        .split-section {
            margin-top: 10px;
            padding: 10px;
            background: #fafafa;
            border: 1px solid #eee;
            border-radius: 6px;
        }
        .split-section .title {
            font-size: 13px;
            font-weight: 600;
            color: #333;
            margin-bottom: 6px;
        }
        .split-section .desc {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
        }
        #multiInput, #polyOutput {
            width: 100%;
            height: 90px;
            margin-bottom: 8px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
            resize: vertical;
            box-sizing: border-box;
        }
        .split-actions {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
        }
        .split-actions button {
            flex: 1;
            padding: 6px 0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: background 0.2s;
        }
        #splitMultiBtn { background: #337AFF; color: #fff; }
        #splitMultiBtn:hover { background: #2860E0; }
        #copyPolysBtn { background: #f5f5f5; color: #333; }
        #copyPolysBtn:hover { background: #e0e0e0; }
        #drawButton,
        #clearButton,
        #drawTrackButton,
        #clearTrackButton {
            width: 50%;
            padding: 8px 0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }

        #drawButton,
        #drawTrackButton {
            background: #337AFF;
            color: white;
        }

        #drawButton:hover,
        #drawTrackButton:hover {
            background: #2860E0;
        }

        #clearButton,
        #clearTrackButton {
            background: #f5f5f5;
            color: #333;
        }

        #clearButton:hover,
        #clearTrackButton:hover {
            background: #e0e0e0;
        }

        #drawButton:disabled,
        #clearButton:disabled,
        #drawTrackButton:disabled,
        #clearTrackButton:disabled {
            background: #e0e0e0;
            color: #999;
            cursor: not-allowed;
        }

        .tip {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .area-label {
             position: absolute;
             background: rgba(255, 0, 0, 0.85);
             border: 1px solid #000;
             border-radius: 3px;
             padding: 4px 6px;
             font-size: 12px;
             color: #fff;
             font-weight: 600;
             box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25);
             white-space: nowrap;
             z-index: 9999;
             pointer-events: none;
         }
         /* 默认隐藏标签容器下的标签 */
          .labels-hidden .area-label { display: none; }

          /* Batch → Generator 样式 */
          .batch-section { margin-top: 10px; padding: 10px; background: #fafafa; border: 1px solid #eee; border-radius: 6px; }
          .batch-section .title { font-size: 13px; font-weight: 600; color: #333; margin-bottom: 6px; }
          .batch-section .desc { font-size: 12px; color: #666; margin-bottom: 8px; }
          #batchInput, #multiOutput { width: 100%; height: 90px; margin-bottom: 8px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace; resize: vertical; box-sizing: border-box; }
          .batch-actions { display: flex; gap: 8px; margin-bottom: 8px; }
          .batch-actions button { flex: 1; padding: 6px 0; border: none; border-radius: 4px; cursor: pointer; font-size: 13px; transition: background 0.2s; }
          #generateMultiBtn { background: #337AFF; color: #fff; }
          #generateMultiBtn:hover { background: #2860E0; }
          #copyMultiBtn { background: #f5f5f5; color: #333; }
          #copyMultiBtn:hover { background: #e0e0e0; }
      </style>
    <script src="https://api.tianditu.gov.cn/api?v=4.0&tk=648f621977051d0199ff0f965d3fd322"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/Turf.js/6.5.0/turf.min.js"></script>
    <script src="https://lib.baomitu.com/terraformer/1.0.12/terraformer.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://unpkg.com/terraformer-wkt-parser@1.2.1/terraformer-wkt-parser.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- 已移除动态备用加载器 ensureTerraformer：改为仅使用静态脚本标签加载 Terraformer 核心库与 WKT 解析器 -->
    <script>
        // 检查Turf.js是否加载成功
        window.addEventListener('load', function () {
            if (typeof turf === 'undefined') {
                console.warn('Turf.js加载失败，已启用备用面积算法');
            } else {
                console.log('Turf.js加载成功');
            }
        });
    </script>
</head>

<body>
<div id="mapContainer">
    <div id="mapLoading">
        <div class="loading-text">地图正在加载中...</div>
    </div>
</div>

<div class="wkt-input-container">
    <div class="minimize-btn" id="minimizeBtn">
        <span class="min-icon">−</span>
        <span class="restore-icon" style="display:none;">+</span>
    </div>

    <div class="content-wrapper">
        <div class="tabs-header">
            <button class="tab-btn active" id="tabDrawBtn">轮廓</button>
            <button class="tab-btn" id="tabTrackBtn">轨迹</button>
            <button class="tab-btn" id="tabSplitBtn">分割器</button>
            <button class="tab-btn" id="tabBatchBtn">合并器</button>
        </div>
        <div class="tab-pane active" id="tabDraw">
            <div class="tip">请输入WKT字符串（支持POLYGON/MULTIPOLYGON）：</div>
            <textarea id="wktTextarea">MULTIPOLYGON (((124.50062541099553 45.37304005227924, 124.50062302679383 45.37303977805054, 124.50060102679821 45.373038778050685, 124.50059799718098 45.3730388436929, 124.50059503984912 45.37303931198621, 124.50059226153792 45.373040166029135, 124.50058976252163 45.37304137499769, 124.50058763299432 45.37304289525805, 124.5005859498144 45.37304467194133, 124.5005847737308 45.373046640923825, 124.50058414719078 45.373048731141424, 124.50058409280712 45.373050867154426, 124.50058461254282 45.37305297187025, 124.50058568763973 45.37305496932591, 124.50058727929566 45.37305678742962, 124.50066474823531 45.37312891384813, 124.5005973147672 45.37320821924017, 124.50059594582771 45.37321027537473, 124.50059519100823 45.3732124834517, 124.50059508110098 45.37321475339474, 124.50059562058948 45.3732169926038, 124.50059678746582 45.37321910973254, 124.50059853412878 45.37322101841477, 124.5006325341266 45.373251018418486, 124.50063471631005 45.37325259766808, 124.5006372936902 45.373253846514054, 124.5006401672197 45.373254716963906, 124.50064322647033 45.37325517556674, 124.50064635387689 45.37325520469868, 124.50064942925465 45.373254803240236, 124.50065233441848 45.37325398661919, 124.5006549577247 45.3732527862179, 124.50065719836105 45.373251248167094, 124.50065897022101 45.37324943157324, 124.50066020521305 45.37324740624706, 124.50066085587731 45.37324525002071, 124.50066089720909 45.37324304575675, 124.50066032762005 45.37324087816385, 124.50065916899935 45.37323883054133, 124.50065746587204 45.3732369815782, 124.50063038054758 45.37321308277045, 124.50068551178343 45.37314824543062, 124.50076127928119 45.37321878744903, 124.5007634024294 45.37322040617989, 124.50076593283664 45.3732217018659, 124.50076877326057 45.37322262471456, 124.50077181454523 45.37322313926128, 124.50077493981594 45.37322322573231, 124.50077802896993 45.37322288080463, 124.50078096329285 45.373222117733626, 124.50078363002027 45.37322096584368, 124.50078592667123 45.37321946940132, 124.5007877649867 45.37321768591401, 124.50078907432143 45.37321568392018, 124.50078980435838 45.37321354035535, 124.50078992704256 45.37321133759554, 124.50078943765962 45.37320916029155, 124.5007883550161 45.37320709211598, 124.50078672071758 45.37320521254761, 124.50070319574772 45.37312744808766, 124.50076668521058 45.373052780739634, 124.5007680217145 45.37305078908173, 124.50076878160297 45.37304865197817, 124.50076893570746 45.37304645146271, 124.5007684781127 45.3730442720031, 124.50076742638365 45.37304219725886, 124.50076582089156 45.37304030687002, 124.50076372326394 45.373038673399925, 124.50076121401922 45.373037359550096, 124.50075838947572 45.373036415753205, 124.50075535805509 45.3730358782373, 124.50075223611938 45.37303576763519, 124.50062541099553 45.37304005227924), (124.50068243220146 45.373108116508284, 124.50063322686934 45.37306230457405, 124.50072399339226 45.373059238138154, 124.50068243220146 45.373108116508284)), ((124.50115963505988 45.37526551269483, 124.50113733561025 45.3752796356607, 124.50113519140223 45.37528129471278, 124.5011335573135 45.37528322081183, 124.50113249842404 45.375285337248414, 124.50113205690545 45.37528755973266, 124.50113225034198 45.375289799751144, 124.50118130845055 45.3755030365559, 124.50129130833874 45.375924036572314, 124.50133836028374 45.37608822637642, 124.50133916335407 45.37609013689423, 124.50134043226197 45.3760919175228, 124.50137515937867 45.376131467896755, 124.5013862069496 45.37618560097242, 124.50138699458205 45.376187822633476, 124.50138840446647 45.37618988577569, 124.50139037813733 45.37619170484366, 124.50139283374958 45.37619320440339, 124.50139566947246 45.376194322270344, 124.50139876771289 45.37619501208826, 124.50140199999157 45.37619524525143, 124.50149600001023 45.37619524525117, 124.50149903423296 45.3761950400441, 124.50150195771702 45.37619443191471, 124.50150466376554 45.3761934430576, 124.50150477914927 45.37619337867554, 124.50179915360593 45.37624491360581, 124.50180188321858 45.376245217670984, 124.50197926529897 45.376253989315494, 124.5020381373158 45.376284548873315, 124.50203907235445 45.3762956654592, 124.50203935122903 45.376297194739514, 124.50206332290627 45.37638209451262, 124.50213129712535 45.3766479939501, 124.50213214401053 45.37665010252501, 124.50213355507381 45.37665205530051, 124.50213455654561 45.376652953147826, 124.50218832801528 45.376842113651975, 124.5022099736773 45.37692574470968, 124.50220106313826 45.377054451970096, 124.50220004547356 45.37710985591237, 124.50220031214997 45.37711205234005, 124.5022011817018 45.37711416989745, 124.50220262071268 45.377116127208026, 124.50220457388224 45.37711784905338, 124.5022069661513 45.37711926926396, 124.50220970558638 45.37712033326185, 124.50221268691237 45.37712100015816, 124.50221579555854 45.37712124432444, 124.50221891206128 45.37712105637753, 124.50222191665517 45.37712044354011, 124.50222469387518 45.377119429363205, 124.50222713699436 45.377118052821054, 124.5022291521249 45.37711636681345, 124.50223066182662 45.377114436132764, 124.50223160808234 45.37711233497396, 124.50223195452823 45.377110144083396, 124.50223295083856 45.377055346167566, 124.50224186268554 45.3769266189683, 124.50233032069461 45.37725708466856, 124.50233117540512 45.37725915883183, 124.50233257700229 45.37726107957372, 124.50233447378075 45.3772627760371, 124.50233679576729 45.37726418563859, 124.50233945730274 45.377265256377264, 124.50234236020165 45.377265948753, 124.50234539737468 45.37726623722373, 124.50234845677886 45.377266111147634, 124.5023514255512 45.37726557517568, 124.50235419417228 45.3772646490802, 124.50235666050614 45.377263367025286, 124.50235873356853 45.37726177630663, 124.50236033688313 45.37725993560663, 124.50236141130306 45.37725791282967, 124.50236191719226 45.37725578259696, 124.50236183588841 45.377253623493864, 124.5023585846633 45.377235045102225, 124.50237684746153 45.377241868567914, 124.50237721176467 45.37724362579459, 124.50237795217873 45.377245739473196, 124.50237925663048 45.37724771298509, 124.50238107622519 45.377249472357086, 124.50238334275912 45.3772509516426, 124.50238597127571 45.37725209539356, 124.50238886325016 45.3772528607387, 124.50242586325682 45.37725986073994, 124.5024289185147 45.377260219386116, 124.50243201452567 45.37726015525886, 124.50243503462434 45.37725967077466, 124.50243786500631 45.377258784190026, 124.50244039901592 45.3772575289136, 124.50244254116559 45.37725595224727, 124.50244421073396 45.377254113603556, 124.50244534480781 45.37725208226702, 124.50244590065252 45.37724993478328, 124.50244585732263 45.37724775207466, 124.50244521645088 45.37724561639088, 124.50244400218709 45.37724360820957, 124.50244226028754 45.37724180320379, 124.50244005639112 45.37724026939045, 124.50243747354618 45.37723906456729, 124.50240608542586 45.37722733715109, 124.50239178821393 45.37715837420385, 124.50237066255069 45.37707685385382, 124.50220268025387 45.3764679186359, 124.5021426969749 45.376235983537406, 124.50214183881958 45.37623386691162, 124.50214041202638 45.37623190866983, 124.50213847127125 45.37623018385376, 124.50213609092602 45.37622875856004, 124.50213336220776 45.37622768740731, 124.50213038968361 45.37622701144316, 124.50212728726356 45.37622675657119, 124.50212417383527 45.37622693255835, 124.5021211687083 45.37622753266065, 124.50211838704224 45.376228533881566, 124.502115935433 45.37622989785338, 124.50211390782863 45.37623157230735, 124.50211238192901 45.376233493076796, 124.50211141620824 45.37623558655594, 124.50211104767361 45.376237772520646, 124.50211129044789 45.37623996720258, 124.5021271890076 45.37630303162511, 124.50212546212067 45.37630194552533, 124.50209983057113 45.37628864062482, 124.50208367343097 45.376228894539764, 124.50208300960101 45.376227185509975, 124.50206100959126 45.37618418551298, 124.50205971475694 45.37618225326011, 124.50205792467321 45.37618052852602, 124.50205570398147 45.37617907359206, 124.50205313287222 45.3761779409969, 124.50205030419019 45.376177171639334, 124.50204732008086 45.37617679330137, 124.50204428830257 45.37617681964506, 124.50204131833488 45.37617724971913, 124.50203851742539 45.37617806799331, 124.50203598671673 45.376179244919136, 124.50203381759475 45.37618073799704, 124.50203208838778 45.37618249331092, 124.50203086153881 45.376184447475204, 124.50203018135022 45.37618652992365, 124.50203007238429 45.37618866545759, 124.50203568061994 45.3762553414254, 124.5019944621309 45.37623394553596, 124.50199189066666 45.376232857478314, 124.5019890757159 45.37623212781381, 124.50198611674696 45.376231782325675, 124.5018055003399 45.37622285074573, 124.50150265209388 45.37616983232664, 124.50148451496322 45.37614820728887, 124.50144141488707 45.37606298672759, 124.50141769600522 45.37597997072016, 124.50137068449067 45.375779936313144, 124.50128172970102 45.375444107344975, 124.50125281223174 45.37531248316867, 124.50124139324258 45.37524396939959, 124.50124866439673 45.375239364327896, 124.50125081654126 45.37523769773173, 124.50125245398984 45.375235762163264, 124.50125351098481 45.37523363535245, 124.5012539450786 45.37523140270929, 124.50125373883861 45.37522915389385, 124.50125290054737 45.37522697921563, 124.50125146386952 45.37522496600692, 124.50124948650027 45.375223195115524, 124.50124704784815 45.37522173765816, 124.50124424584645 45.37522065216439, 124.50124119301972 45.37521998222623, 124.5012380119656 45.375219754747505, 124.50123736505964 45.37521980031732, 124.50123491929382 45.37520512572109, 124.50123094340054 45.37513256604072, 124.50123087984976 45.375131907789346, 124.50122187983179 45.3750669077908, 124.50122129524283 45.37506479908775, 124.50122015228666 45.37506280723701, 124.50121849268807 45.375061004952975, 124.5012163770323 45.37505945802971, 124.5012138825533 45.375058222939074, 124.50121110031444 45.37505734476923, 124.5012081318839 45.37505685557853, 124.50120508562699 45.37505677322539, 124.50120207275012 45.375057100716155, 124.50119920324119 45.375057826095485, 124.50119658185427 45.37505892288274, 124.50119430428553 45.37506035103866, 124.50119245367979 45.3750620584271, 124.50119109759514 45.37506398271827, 124.50119028553688 45.37506605366409, 124.50119004714983 45.37506819566275, 124.50119204712706 45.375149195663326, 124.50119240781726 45.375151385412, 124.50119336770639 45.375153483490635, 124.50119488990661 45.3751554092712, 124.50119691592053 45.37515708874705, 124.50119936788961 45.375158457376806, 124.50120044913237 45.37515884781173, 124.50120305658045 45.37520643395588, 124.50120315364678 45.37520731191249, 124.50120667952979 45.37522845462864, 124.50116543861644 45.375244097728036, 124.5011626992844 45.37524541224891, 124.50116040433802 45.37524709725612, 124.50115865278428 45.37524908005635, 124.50115752018732 45.37525127510911, 124.50115705540894 45.37525358771709, 124.50115727850032 45.37525591811149, 124.50115963505988 45.37526551269483), (124.5011940858691 45.375273930754936, 124.50121233586533 45.37526237242274, 124.50122123256362 45.37531572072018, 124.50125031559904 45.37544806366946, 124.5013392856032 45.37578395077694, 124.50138625892046 45.37598383746853, 124.50141035842792 45.37606821987091, 124.50141097066505 45.37606977561148, 124.50145497064517 45.37615677561749, 124.50145626463365 45.376158722228425, 124.50145920312448 45.37616222581669, 124.50143614991237 45.37615818993693, 124.50140579775226 45.37612362223763, 124.50138779301123 45.37603539902804, 124.50138762703907 45.37603472987743, 124.50135668853848 45.37592894026557, 124.50133066778626 45.375818874177774, 124.5012716866626 45.37560294350194, 124.5012447161818 45.37549705950693, 124.50122076458054 45.375398259264536, 124.50120279567045 45.37530941310887, 124.5011940858691 45.375273930754936), (124.50131770430379 45.3759008756097, 124.50125460776727 45.37565938885659, 124.50129929433514 45.37582298714256, 124.50131770430379 45.3759008756097), (124.50121622671038 45.375512493552584, 124.50121272242852 45.37549908162099, 124.50121065426202 45.375490091473466, 124.50121329566831 45.375500987009204, 124.50121622671038 45.375512493552584), (124.50118130522975 45.37536251334309, 124.50116514384223 45.37529226069173, 124.50116606192236 45.37529167924169, 124.50117123790393 45.37531275289054, 124.50118130522975 45.37536251334309), (124.50210967525152 45.37632504434708, 124.50214294786034 45.37636237459488, 124.50217133761046 45.37647214611713, 124.50233932024227 45.377081083765184, 124.50236025289992 45.377161824101876, 124.50237112700376 45.37721427576153, 124.50234913705478 45.377206059727264, 124.50225567920123 45.37685691534308, 124.50217267482623 45.37657189344923, 124.50212671358791 45.37638804869854, 124.50210967525152 45.37632504434708)), ((124.51371671436009 45.38104106715219, 124.51371690709315 45.38103771840317, 124.51380729043747 45.381005002914165, 124.51380802189296 45.38100472089601, 124.51393002190632 45.380954720887345, 124.51393255596854 45.38095343298315, 124.51393468535115 45.380951821787384, 124.51393632842093 45.38094994906774, 124.51393742218835 45.38094788661788, 124.51393792472217 45.380945713505035, 124.51393781675698 45.38094351303884, 124.51393710243188 45.380941369577634, 124.5139358091318 45.380939365294296, 124.51393398643738 45.380937577026124, 124.5139317042244 45.38093607332913, 124.5139290499852 45.38093491184986, 124.51392612547393 45.380934137115425, 124.51392304280635 45.380933778826424, 124.51392280999504 45.38093378418638, 124.51392513670868 45.38093268468776, 124.51392733559368 45.3809311332274, 124.51392906542964 45.380929310532906, 124.513930260441 45.380927285910516, 124.51393087518885 45.380925136344516, 124.51393088629793 45.38092294357013, 124.51393029334595 45.380920790965476, 124.51392911887946 45.38091876038124, 124.51392740755635 45.38091692902842, 124.51392522444816 45.38091536654242, 124.51392265256538 45.38091413233523, 124.51391978970129 45.38091327333636, 124.51391711375598 45.38091287688362, 124.51397179878256 45.380900724645045, 124.51397377881024 45.38090018003419, 124.51410077882764 45.38085818002647, 124.51410339797361 45.38085708793891, 124.51410567528508 45.38085566529398, 124.5141075279292 45.38085396383783, 124.51410888851933 45.380852045457864, 124.51410970756648 45.380849979931696, 124.51410995527931 45.3808478423891, 124.51410995328384 45.38084782960041, 124.51424657516584 45.380795897270815, 124.51432228639909 45.38076469258082, 124.5143242326275 45.38076507480414, 124.5143273292209 45.38076524281593, 124.51433041334253 45.38076498491808, 124.51433336815704 45.38076431088047, 124.51433608172783 45.380763246237606, 124.51437708173111 45.38074324623433, 124.51437821019408 45.3807426418088, 124.51444116184913 45.38070570326818, 124.51445591525898 45.38069976419285, 124.51445844441048 45.38069850165847, 124.51446057952079 45.380696918378035, 124.51446224003759 45.38069507408473, 124.51446336331385 45.38069303835906, 124.51446347089777 45.38069261282695, 124.51449921019919 45.38067164179801, 124.51450140218684 45.38067007559581, 124.5145031195586 45.38066823861953, 124.51450429659266 45.380666201167955, 124.51450488824558 45.380664041211745, 124.5145048718757 45.380661841409726, 124.51450424810938 45.38065968594545, 124.51450304081756 45.38065765730581, 124.51450129620181 45.380655833124216, 124.51449908102622 45.38065428320976, 124.51449648006293 45.380653066875674, 124.51449359284732 45.380652230669476, 124.51449306232568 45.38065215721729, 124.5144939366875 45.38065146262928, 124.51449578329289 45.38064966594703, 124.51449617396217 45.38064906445045, 124.51455980778883 45.380610884132935, 124.51467123333143 45.380555171346614, 124.51467359178608 45.38055372792692, 124.51467550602464 45.38055198836054, 124.51467690269038 45.380550019310455, 124.51467772826082 45.3805478962339, 124.51467795109889 45.38054570049057, 124.51467756266507 45.38054351622494, 124.51467657784491 45.38054142714158, 124.5146756059618 45.38054022204084, 124.51471809103538 45.380517535829064, 124.51471964930569 45.380518903658185, 124.51472218106295 45.3805203717026, 124.51472508513017 45.38052144410116, 124.51472823890597 45.3805220755803, 124.5147315092472 45.38052223948084, 124.51473475808949 45.38052192888337, 124.5147378482762 45.3805211569004, 124.51474064934871 45.3805199561228, 124.51485464935581 45.38045895611319, 124.51485699304001 45.380457417587586, 124.51485885350498 45.380455580195274, 124.51486015578955 45.380453517967794, 124.51486084742268 45.380451313995664, 124.51486090053751 45.380449057080526, 124.51486031299378 45.38044683815714, 124.51485910846488 45.38044474662952, 124.51485733548316 45.380442866768725, 124.51485506548501 45.38044127431732, 124.51485238993234 45.38044003343779, 124.51485190388233 45.380439896234584, 124.5148522146702 45.380439389383795, 124.51485287260904 45.380437153147014, 124.51485287586718 45.38043486934762, 124.51485222431026 45.38043263218303, 124.51485094481248 45.38043053392721, 124.51484909014802 45.38042866112469, 124.51484356502243 45.38042414056863, 124.51484461113102 45.38041794438169, 124.51485718072912 45.38041265489294, 124.51485974052555 45.380411316374, 124.51486187174108 45.38040964600555, 124.5148634893336 45.38040771044057, 124.51486452875608 45.38040558691423, 124.51486494853246 45.38040336016185, 124.5148647319123 45.3804011190379, 124.51485457486726 45.38035892829338, 124.51485484494636 45.38035732858959, 124.51485491148138 45.38035515396535, 124.51485438270292 45.38035301099474, 124.51485327839481 45.38035097985502, 124.51485243217019 45.380350027863, 124.51485191578584 45.380347882882084, 124.5148548588198 45.38032924361617, 124.5148549072826 45.380327115690335, 124.5148543859937 45.380325019437855, 124.51485331362413 45.38032302994027, 124.51485172858311 45.3803212184555, 124.51485147792926 45.38032102581247, 124.51488241544772 45.380280903705376, 124.51491934004724 45.38026211749735, 124.5149216419305 45.380260690353616, 124.5149235140293 45.38025897930562, 124.51492488723162 45.38025704752, 124.51492571084297 45.380254966312386, 124.51492595445838 45.380252812514556, 124.5149256090842 45.38025066563812, 124.51492468747088 45.38024860493915, 124.5149232236413 45.380246706492265, 124.51492127163584 45.38024504038231, 124.51491890351647 45.3802436681169, 124.51491620670679 45.38024264035583, 124.51491328076479 45.380241995040855, 124.5149102337071 45.38024175599502, 124.51490717802169 45.380241932043155, 124.51490422651506 45.380242516686096, 124.51490148814759 45.38024348834064, 124.51489601359808 45.380245921477965, 124.51489542251862 45.38024548505748, 124.51489290006442 45.38024422972106, 124.51489008173985 45.38024334029782, 124.51488707309574 45.380242850098135, 124.51488398681084 45.3802427774808, 124.51488093847149 45.38024312516545, 124.51487804224318 45.38024388013071, 124.51479604225408 45.3802718801256, 124.514793427734 45.38027300290968, 124.51479116562935 45.380274456933435, 124.51478933922267 45.38027618866511, 124.5147880157553 45.3802781343487, 124.51478724395271 45.38028022235135, 124.51478705222968 45.38028237580048, 124.51478744764496 45.38028451541402, 124.51478841564084 45.380286562419265, 124.51478992057933 45.380288441453, 124.51479190705426 45.380290083336085, 124.51479400269056 45.38029125965192, 124.51479348815813 45.380291488332546, 124.51479104174136 45.38029282592917, 124.51479061357246 45.380293172328656, 124.5147902480651 45.38029279237083, 124.51478797263599 45.380291221543054, 124.5147852998198 45.38029000051711, 124.51478233612234 45.380289177948114, 124.51477919964019 45.380288786613576, 124.51477623087708 45.38028883835135, 124.51477612389164 45.380288774436224, 124.51477350243549 45.380287730840855, 124.51477064947768 45.38028705285116, 124.51476766659025 45.3802867646051, 124.5147646599707 45.380286876364906, 124.51475773306495 45.380287600073345, 124.5147579566862 45.380285999997746, 124.51475795668591 45.380284999997755, 124.51475795264051 45.380284970650784, 124.51475795647141 45.380284941701575, 124.51475783322576 45.38028410437005, 124.51475765832599 45.38028283557856, 124.51475764017799 45.38028279280227, 124.5147576337337 45.38028274901952, 124.5147572600728 45.380281896861305, 124.51475677440501 45.38028075210043, 124.51475673489837 45.38028069916669, 124.51475671020039 45.380280642841385, 124.51475609374383 45.38027984010398, 124.5147553379782 45.38027882747736, 124.51475527126112 45.38027876908333, 124.51475522136252 45.38027870410639, 124.51475438755408 45.380277995620055, 124.51475340276271 45.38027713368287, 124.51475330487925 45.38027707567217, 124.51475322443527 45.380277007318995, 124.51475220976927 45.38027642665448, 124.51475104112778 45.3802757340583, 124.51475091040882 45.38027568306744, 124.51475079615952 45.380275617685804, 124.51474964465025 45.380275189320216, 124.51474834138979 45.38027468094421, 124.51474817871252 45.38027464398604, 124.5147480298525 45.3802745886096, 124.51474679033524 45.380274328564845, 124.51474540450829 45.38027401372301, 124.51474521341474 45.380273997734506, 124.51474503182178 45.380273959637165, 124.51474375551796 45.38027387575442, 124.51474234031149 45.38027375734617, 124.51474212697019 45.38027376872109, 124.51474191727995 45.38027375493957, 124.51474065550693 45.38027384717641, 124.51473926338824 45.380273921401226, 124.51473903640117 45.38027396553461, 124.51473880591698 45.38027398238321, 124.51473760794381 45.380274243271224, 124.51473628880385 45.38027449975313, 124.51473605886063 45.38027458062203, 124.51473581730085 45.38027463322758, 124.51473472839342 45.38027504853492, 124.51473352779607 45.380275470773775, 124.51465711938228 45.38030920955182, 124.51455774108418 45.38034498573687, 124.51446558629547 45.38038103860966, 124.51439992703314 45.38040391986647, 124.51439907838042 45.3804042383834, 124.51410126418456 45.38052426659057, 124.51409848024316 45.380525081777236, 124.51401083195495 45.3805580851877, 124.51401081423361 45.38055808077634, 124.5140077181775 45.38055776618254, 124.51400459452215 45.38055788329791, 124.51400156330797 45.38055842762181, 124.51399874102283 45.38055937823614, 124.51399623612538 45.38056069860938, 124.5139941448774 45.380562338000345, 124.51399065464301 45.38056568281246, 124.5139364802628 45.38058608176639, 124.5139332462331 45.38058769210244, 124.51390589207693 45.38060527691516, 124.5139058298436 45.380605308896264, 124.51390554065897 45.38060072327301, 124.51396265487668 45.380557680657716, 124.51396455716683 45.38055593069332, 124.51396593846263 45.38055395281568, 124.51396674568153 45.38055182303356, 124.51396678363886 45.38055140991418, 124.51406301419377 45.38051710161598, 124.51416782273853 45.38048216543264, 124.51416854818115 45.38048190748962, 124.51427954819455 45.38043990748214, 124.51428217325999 45.380438663383565, 124.51428439847722 45.38043707878075, 124.51428613638666 45.380435215954684, 124.51428731868178 45.380433148121604, 124.514287898894 45.38043095655526, 124.5142878542188 45.38042872739263, 124.51428718641208 45.38042654824835, 124.51428592172142 45.38042450477112, 124.51428556193571 45.380424141882436, 124.51449154343145 45.3803519092788, 124.51493854348554 45.380182909248816, 124.51503580146628 45.38014281178799, 124.51508053880652 45.380125911013984, 124.5150826288134 45.38012496705636, 124.51508448578069 45.380123806075254, 124.5151081933352 45.380106481322, 124.51512214567259 45.380102377692914, 124.51512492883771 45.38010131984588, 124.51512736135054 45.3800998959909, 124.5151293476816 45.38009816204553, 124.51513080982402 45.38009618610499, 124.51513169035684 45.380094045768274, 124.51513195469987 45.380091825090396, 124.51513159247195 45.38008961128152, 124.51513061789856 45.38008749128211, 124.51512906925299 45.3800855483485, 124.51512700735358 45.38008385878329, 124.51512451317494 45.38008248893886, 124.5151216846682 45.38008149261155, 124.51511863291398 45.38008090892897, 124.51511571684473 45.380080772037005, 124.51517610350466 45.38005568716129, 124.51517756859866 45.38005499900532, 124.51526621410838 45.38000818620397, 124.51536327758738 45.37996262579205, 124.51556167955687 45.379885857185464, 124.51565977071427 45.379845239125046, 124.51566633472893 45.37984359812128, 124.5156686864145 45.37984285452799, 124.51577968642755 45.379799854520414, 124.5157822580671 45.37979861350184, 124.51578443832548 45.37979704384797, 124.51578462527851 45.37979684234932, 124.51580781042892 45.37978769590576, 124.51580821589236 45.379787627457375, 124.51581104975666 45.37978670937476, 124.51582804975847 45.379779709373565, 124.5158296944493 45.379778870685385, 124.51589882599235 45.37974980400259, 124.51596584428749 45.37972479253998, 124.51621501130715 45.379625661622065, 124.51629726619434 45.37959601160101, 124.51629834517057 45.37959558468802, 124.5163723451781 45.37956358468256, 124.51637389217159 45.37956282347902, 124.51646083106918 45.37951441431614, 124.51647264400276 45.37950987087977, 124.51647531366835 45.37950858042875, 124.51647755880984 45.37950693679613, 124.51647928701449 45.37950500763603, 124.5164804271471 45.37950287235513, 124.51648093227838 45.37950061884439, 124.51648078161662 45.379498339861236, 124.51647998136323 45.37949612921152, 124.51647856445783 45.37949407788842, 124.51647658922208 45.379492270327034, 124.51647625468307 45.37949206714254, 124.51647565028179 45.37949117665467, 124.51647377595042 45.37948941179041, 124.51647144907609 45.37948793853672, 124.51646875907934 45.37948681350989, 124.51646580933502 45.379486079944066, 124.51646271320024 45.37948576602974, 124.5164595896577 45.37948588383047, 124.51639458967006 45.37949288382896, 124.5163909519684 45.379493593875566, 124.51634735430228 45.37950617878191, 124.51635382839714 45.37946369245061, 124.51635904290971 45.379458477921595, 124.51636052835242 45.37945664998215, 124.51636150399784 45.37945465887571, 124.5163619356109 45.37945257446981, 124.51636180804644 45.37945046990587, 124.51636112578069 45.379448419032656, 124.51635991275438 45.37944649381487, 124.51635821153224 45.37944476180807, 124.51635685636843 45.379443821328934, 124.51635786522117 45.37943720071025, 124.51635771440398 45.3794340487971, 124.5163247143687 45.379302048802046, 124.51632391879984 45.379300011098636, 124.51632259627439 45.379298114289824, 124.51632079350615 45.37929642537404, 124.5163185741718 45.379295004006565, 124.51631601666203 45.37929390039245, 124.51631321131232 45.37929315351314, 124.51631025721215 45.37929278974967, 124.51630725870521 45.37929282195073, 124.51630432170361 45.37929324897893, 124.51630154994724 45.37929405575097, 124.51617254996312 45.37934205574242, 124.51617168123029 45.379342403933556, 124.51602985348653 45.37940346865476, 124.51602665169173 45.37940474116174, 124.51589871672745 45.37945099456769, 124.51589608692585 45.37945218818704, 124.51589510171084 45.37945285946324, 124.51589497311859 45.37945290391481, 124.51589231329555 45.379454064025126, 124.51589002572692 45.37945556753985, 124.51588819832278 45.379457356679815, 124.51588690130926 45.379459362689374, 124.51588618452992 45.37946150847872, 124.51588607553022 45.379463711586396, 124.51588657849894 45.3794658873482, 124.51588767410749 45.37946795215083, 124.51588932025223 45.379469826645064, 124.51589145367275 45.37947143879509, 124.51589399238296 45.37947272664691, 124.51589683882158 45.37947364070901, 124.51589988360155 45.379474145854545, 124.51590300971351 45.379474222671014, 124.51590609702292 45.3794738682064, 124.51590902688585 45.37947309608259, 124.51599002689653 45.37944509607752, 124.51599083804632 45.379444795006705, 124.51604177892777 45.37942454930863, 124.5160432832935 45.37942400542125, 124.51604431875971 45.37942359607423, 124.51604601522577 45.37942286565314, 124.51613915647114 45.37938584794494, 124.51632261548095 45.379455863715535, 124.51623152551478 45.379546953714325, 124.51619415732105 45.37956220602094, 124.51608344313662 45.37960509529705, 124.51588657395189 45.37967804681817, 124.5156971934877 45.37975519138678, 124.51557737559511 45.37980112157612, 124.51557472396397 45.37980239713938, 124.51557248832677 45.37980402096333, 124.51557075918655 45.379805927312376, 124.51556960654251 45.37980803901379, 124.51556907705582 45.37981027058173, 124.51556919216137 45.37981253167797, 124.51556919571385 45.37981254202472, 124.5155182066007 45.379838603107444, 124.51544377687009 45.379869941939496, 124.5153538084573 45.379896635862565, 124.51535294535654 45.37989691351515, 124.51525794536897 45.379929913509145, 124.51525669137415 45.3799303995309, 124.5151428276284 45.3799793409623, 124.51503121534229 45.380025181719795, 124.51501414662461 45.38003162040056, 124.5150134819364 45.38003027841874, 124.51501190980926 45.380028390848516, 124.51500984862437 45.3800267536505, 124.51500737646488 45.38002542884611, 124.51500458698271 45.380024466622444, 124.515001585851 45.38002390343106, 124.51499848676036 45.38002376060714, 124.51499540711278 45.380024043561235, 124.51499246357315 45.3800247415743, 124.51491346358429 45.38004974156967, 124.5149120231443 45.38005026076977, 124.51473502316394 45.38012226075727, 124.5147335435229 45.38012294231359, 124.51470654352472 45.38013694231135, 124.51470421780856 45.38013841649506, 124.51470234487519 45.380140182108526, 124.51470099670057 45.38014217130029, 124.51470022509417 45.38014430762682, 124.51470005970866 45.38014650899029, 124.51470050689953 45.38014869079357, 124.51470154948176 45.38015076919114, 124.51470314738947 45.38015266431135, 124.5147036725432 45.380153075786446, 124.51467339339017 45.38016511294401, 124.51442570636253 45.38025599809817, 124.51417690642074 45.38034492658691, 124.51406303164512 45.380383883745004, 124.51406041009173 45.38038501223306, 124.5140581439632 45.38038647382914, 124.51405670839728 45.3803878416671, 124.51402229268611 45.380399754789124, 124.51388200001529 45.380399754786495, 124.51387887637804 45.380399972351576, 124.51387587360949 45.38040061663208, 124.51387310790187 45.38040166269753, 124.51387068627447 45.38040307007042, 124.51386870243222 45.380404784292345, 124.51384599752953 45.38042890827657, 124.51377303256085 45.380442107923656, 124.51377013709255 45.38044284800391, 124.51376749732331 45.380443966328684, 124.51376521160617 45.380445421231286, 124.5137633651027 45.38044715850476, 124.51376202661012 45.380449113421534, 124.51376124599844 45.38045121314502, 124.51376105235161 45.38045337944342, 124.5137614528848 45.380455531604476, 124.51380145285333 45.38057753161028, 124.51380250311809 45.38057969896282, 124.51380415470203 45.38058167140616, 124.51380633909875 45.380583367124885, 124.51380896570136 45.380584715781936, 124.51381192556035 45.38058566143604, 124.51381509590318 45.38058616486226, 124.51381834522658 45.38058620517884, 124.51382153875096 45.38058578071349, 124.51387198807018 45.380575232234584, 124.51387306260465 45.38059227138043, 124.51387034512656 45.38059431933199, 124.513868100095 45.38059647735869, 124.51385815329994 45.38060891084936, 124.51375914746464 45.38065120459899, 124.51363258123493 45.38069804406691, 124.5136299029315 45.38069929242985, 124.51362763352377 45.38070089341882, 124.51362586491493 45.380702782199386, 124.51362466872739 45.380704882282586, 124.51362409340261 45.3807071086224, 124.51362416223931 45.38070937105991, 124.51362441059622 45.38071014280608, 124.51362313370765 45.380711914210366, 124.5136222882876 45.38071403661937, 124.51362204665992 45.38071623448, 124.51362241811005 45.38071842332969, 124.51362338836377 45.380720519052176, 124.51362492013449 45.38072244110999, 124.51362695455738 45.38072411563953, 124.51362941345064 45.38072547828951, 124.51363220232037 45.38072647669407, 124.51363521399188 45.38072707248504, 124.51363833272815 45.38072724276648, 124.51364143867791 45.38072698099461, 124.51364441248118 45.38072629722913, 124.5136829032061 45.38071439289428, 124.5136879279546 45.38071380667303, 124.51366408472967 45.380758003822784, 124.5136632918367 45.38076002251635, 124.51366304393864 45.380762109818754, 124.51366334963653 45.38076419331098, 124.51366419832415 45.380766200706255, 124.51366556055639 45.380768062357916, 124.51366738907039 45.38076971367595, 124.51366962042613 45.38077109736777, 124.51367217720646 45.38077216542622, 124.51369224776845 45.3807788556154, 124.5136795726297 45.38078994635535, 124.51367783060226 45.380791828596614, 124.51367665442902 45.38079391735761, 124.51367609108037 45.38079612922378, 124.51367616305365 45.38079837586436, 124.51367686747481 45.38080056755986, 124.5136781762128 45.380802616785, 124.51367995960948 45.38080436580221, 124.51367955775302 45.38080516724366, 124.51367910025984 45.38080704957237, 124.51367910133429 45.380808959312546, 124.51369201546558 45.38091525279372, 124.51369188004956 45.38091760563962, 124.51365164621294 45.38097331399715, 124.51354605485218 45.38102368785029, 124.51354364888665 45.381025096561544, 124.51354167911485 45.38102680898144, 124.51354022123016 45.38102875930615, 124.51350555188304 45.38108876395184, 124.51346281225544 45.3811039602372, 124.5134602246685 45.381105111927695, 124.51345799666869 45.381106590567455, 124.51345621021345 45.38110834176446, 124.51345493101778 45.38111030110065, 124.51345420613735 45.38111239650148, 124.51345406223689 45.38111455088729, 124.51345450460997 45.381116685008635, 124.51345551698377 45.38111872036142, 124.51345706211814 45.38112058207487, 124.513459083175 45.381122201665484, 124.51346150580937 45.381123519556304, 124.51346424090427 45.38112448726845, 124.51349724090949 45.38113348727003, 124.51350022055317 45.381134073306036, 124.51350330465996 45.38113424316123, 124.51350637731649 45.38113399045175, 124.51350932303941 45.38113332467547, 124.51351203111624 45.38113227085505, 124.5135143997662 45.38113086859744, 124.51351633996563 45.3811291706053, 124.51351777879376 45.38112724069623, 124.51352648585018 45.38111217080525, 124.51352911158277 45.3811122178929, 124.51353210278327 45.3811118671526, 124.5135492086132 45.38110865981884, 124.51355074186581 45.38110996922195, 124.5135531517826 45.38111135803158, 124.51355589847857 45.38111239065761, 124.51355887740966 45.381113027796395, 124.51362287742177 45.381122027797986, 124.51362563114235 45.3811222422059, 124.51362839598202 45.38112211772104, 124.51363108859557 45.381121658096, 124.51364494390624 45.38111837282221, 124.51364605063127 45.38111945262287, 124.5136483627049 45.38112096262239, 124.51365105087824 45.381122122851785, 124.51365401024401 45.381122888032614, 124.51365712531182 45.38112322830337, 124.51366027451478 45.38112313038483, 124.51366333495378 45.381122598098315, 124.5137113349615 45.38111059809597, 124.51371299559179 45.381110106943304, 124.5137649884672 45.38109223441691, 124.51376552215028 45.381092526785, 124.51376839653707 45.381093529055455, 124.51377149726068 45.38109410603346, 124.51377469907557 45.381094234413574, 124.51377787265334 45.38109390901022, 124.51378088980576 45.38109314296715, 124.51386388981689 45.38106514296205, 124.51386648336978 45.381064043792826, 124.51386873578909 45.38106261930243, 124.51387056605131 45.381060920732324, 124.51387190831882 45.38105900918304, 124.51387271430788 45.38105695341643, 124.51387295502569 45.38105482738197, 124.51387262181328 45.38105270755691, 124.51387172665696 45.38105067019503, 124.51387030175711 45.38104878858382, 124.51386839836992 45.381047130408106, 124.51386608496354 45.38104575531534, 124.51386344475533 45.38104471277001, 124.51386057271814 45.3810440402743, 124.51386050763249 45.381044034238606, 124.51386623345498 45.3810411713261, 124.5138685811562 45.38103973591418, 124.51387048946626 45.381038007000235, 124.51387188598338 45.381036050179624, 124.51387271772366 45.38103393969447, 124.51387295313069 45.38103175561696, 124.51387258327331 45.3810295808114, 124.5138716221838 45.38102749779027, 124.51387010632628 45.38102558558375, 124.51386809321266 45.38102391674125, 124.51386565922083 45.381022554578934, 124.51386289669679 45.38102155077747, 124.51385991045122 45.38102094342122, 124.51385681378278 45.381020755553386, 124.51385372417941 45.38102099430171, 124.5138507588612 45.38102165060803, 124.51381886640894 45.38103120218549, 124.51385020108216 45.38102003500842, 124.51385121321101 45.3810196412264, 124.51387721321377 45.38100864122452, 124.51387967305877 45.38100735947473, 124.51388174060648 45.38100577046548, 124.51388333986264 45.38100393260219, 124.51388441204537 45.38100191343703, 124.51388491774546 45.38099978718609, 124.51388483837589 45.380997632001474, 124.51388417685385 45.38099552709877, 124.5138829574942 45.3809935498454, 124.51388122511553 45.3809917729169, 124.51387904339296 45.38099026162573, 124.51387649251738 45.38098907152064, 124.51387366624833 45.380988246344856, 124.51387066846763 45.38098781642839, 124.51386760936111 45.3809877975732, 124.51386460136867 45.380988190472266, 124.51386175505142 45.38098898068432, 124.51371671436009 45.38104106715219), (124.51390476659033 45.380568378539834, 124.51390355831883 45.38056928912104, 124.5139035173669 45.38056863974146, 124.51390476659033 45.380568378539834), (124.5136633428627 45.38099489305998, 124.51366598602345 45.38100261110201, 124.51356963304063 45.38104442465059, 124.51356724379933 45.38104569361084, 124.51356523267303 45.38104725456732, 124.51356251936033 45.381049805083244, 124.51356795343065 45.38104039994417, 124.5136633428627 45.38099489305998), (124.51367386105655 45.381025606221925, 124.51367450978022 45.38102750049614, 124.51364359928994 45.381038969525704, 124.51364039333305 45.38104012996109, 124.51367386105655 45.381025606221925), (124.51368229906942 45.38105024522247, 124.51368326914212 45.38105307783366, 124.51368123093464 45.381053809784184, 124.51364073060341 45.381066024189664, 124.51364462796404 45.38106400507227, 124.5136583240315 45.38105892328647, 124.51368229906942 45.38105024522247), (124.5137184331453 45.381011203146755, 124.5137184336954 45.38101119358729, 124.513846118978 45.38096284679534, 124.51381829555814 45.38097415004533, 124.5137184331453 45.381011203146755), (124.51377054423004 45.38093541596808, 124.51380214747799 45.38091532912542, 124.51402630423775 45.38083399790465, 124.51416677752081 45.380777819343386, 124.51437811291282 45.38069607640469, 124.51440633191967 45.380687165147016, 124.5143925695126 45.38069809789116, 124.51431512332904 45.380727220318064, 124.51418525797912 45.38077916645498, 124.5141032023632 45.38081052106118, 124.51404004167253 45.380834106332266, 124.51393947426517 45.380870084012216, 124.51380947428095 45.38091908400352, 124.51377054423004 45.38093541596808), (124.51476135281243 45.38031021142056, 124.51475819465183 45.38031102882733, 124.51475780870322 45.38031032840158, 124.51476127415643 45.380309966338544, 124.51476136466196 45.380310031703715, 124.51476135281243 45.38031021142056), (124.51472785701675 45.38031888092017, 124.51470249894703 45.3803254441767, 124.51470088505677 45.380325934552864, 124.51451288508123 45.38039193454091, 124.51440784814947 45.38043333297905, 124.51429102976047 45.380482256916714, 124.51415943615487 45.380534096818884, 124.5140223016434 45.38058415005839, 124.51400330286793 45.38059152460029, 124.51401207734291 45.38058311571813, 124.51407833167568 45.38055816808613, 124.51407904043785 45.38055815289383, 124.51408207787578 45.380557660622664, 124.51408492158721 45.38055676163707, 124.51441450410951 45.380423929886, 124.51448074602861 45.38040083134979, 124.51457250472536 45.38036492577085, 124.51467225893298 45.38032901425405, 124.51467347220104 45.3803285292292, 124.51470149878722 45.38031615386325, 124.51470234001937 45.38031612363445, 124.51472517141494 45.380313738269294, 124.51472785701675 45.38031888092017), (124.51393672156556 45.380617368679026, 124.51393095536184 45.38061960687538, 124.51394137691916 45.38061290730303, 124.51393672156556 45.380617368679026), (124.51372953413372 45.380699970949806, 124.51374057956433 45.380696554831495, 124.51375036548643 45.380694424031525, 124.51370864553444 45.38075944215308, 124.5136991572295 45.38075627938505, 124.51372953413372 45.380699970949806), (124.51372342667091 45.380924440174574, 124.51372348495642 45.38092342745691, 124.51372638138879 45.38091941700612, 124.51372659403876 45.38091939824289, 124.51372342667091 45.380924440174574), (124.51372184668371 45.38089715110511, 124.51371924217996 45.380875714106715, 124.51372885094082 45.38089653308279, 124.51372184668371 45.38089715110511), (124.51375107803311 45.380747897868034, 124.51375786378095 45.38073732266829, 124.51375902311929 45.38073768425425, 124.51376211743403 45.38073816667572, 124.51376528600596 45.380738208631605, 124.5137684038518 45.380737808466975, 124.5137713479893 45.38073698196619, 124.51386466899712 45.380702861314035, 124.51389504087534 45.38069113074617, 124.51389945453921 45.38069540860904, 124.5138407166532 45.38071898216712, 124.51375107803311 45.380747897868034), (124.51377819997525 45.38070562984742, 124.51378480421448 45.38069533750194, 124.51381320984018 45.38068074019292, 124.5138352369887 45.380675943953676, 124.51377819997525 45.38070562984742), (124.51395827065964 45.38063468047045, 124.51403751941399 45.380603919398894, 124.51417433802119 45.38055398559782, 124.51430678585226 45.380501815719974, 124.5144239723936 45.380452742177425, 124.51452745683903 45.38041194542259, 124.514713922646 45.38034648401999, 124.51471335480534 45.38034778886404, 124.51471304331315 45.38035001574906, 124.51471336365495 45.380352242010446, 124.51471387248894 45.38035339968467, 124.51468973774968 45.380360656966545, 124.51468858128871 45.38036104406581, 124.51456133092329 45.38040813873176, 124.51394688138836 45.380645461638366, 124.51394785513506 45.380644662003995, 124.51395827065964 45.38063468047045), (124.51472576117477 45.38037427693844, 124.51472712700424 45.38038085777386, 124.51471769652369 45.38038400183951, 124.51450269655085 45.38046200182552, 124.5143852658604 45.380509163052366, 124.51398743604787 45.38066009847476, 124.51392735816678 45.380684209894746, 124.51392325542858 45.38068023339304, 124.51457654448785 45.38042790938866, 124.51470285151169 45.38038116584219, 124.51472576117477 45.38037427693844), (124.51473726111612 45.38042968586825, 124.51473864269559 45.38043634257624, 124.514620169022 45.38048619792037, 124.5144626572791 45.38054501559301, 124.51430820970687 45.380600186023074, 124.51397457452906 45.38073171546237, 124.51397447926013 45.38073126946803, 124.5139734574377 45.38072924100228, 124.51397190590369 45.3807273869033, 124.51396968796946 45.38072523721668, 124.51400770568235 45.380709849058285, 124.51432945942334 45.380589940824684, 124.51446951185609 45.38053592191759, 124.51460036094352 45.38048797721111, 124.51472599487585 45.38043673190917, 124.51472891635929 45.3804352018837, 124.51473726111612 45.38042968586825), (124.51469613303712 45.3804804261701, 124.5146955052904 45.38048099900131, 124.51469532017202 45.38048125697336, 124.51461481228866 45.380519329583386, 124.51437856197407 45.380607051213175, 124.51424038006512 45.380662117983526, 124.51410461952443 45.380712029944114, 124.51397532930744 45.38076413721379, 124.51385847245197 45.38080734478959, 124.5138172275783 45.380813777488704, 124.51390677544742 45.38078418114175, 124.51390779024975 45.38078381400298, 124.51432350488638 45.38061992649299, 124.51447747104172 45.38056493648891, 124.51463547106111 45.38050593647841, 124.51463618070579 45.380505654908944, 124.51469613303712 45.3804804261701), (124.51448069149869 45.38062642336081, 124.51443831145968 45.38065242116296, 124.51436447490852 45.38067573796662, 124.51436332241855 45.38067614200482, 124.51415132244355 45.38075814199038, 124.51401140639341 45.38081410708703, 124.51378613846906 45.38089584146253, 124.51387591419986 45.38085677237993, 124.51415342549352 45.38075395344083, 124.51430073739759 45.380694835591136, 124.51448069149869 45.38062642336081), (124.5137850772699 45.38089630328016, 124.51378231296836 45.380897649406656, 124.51377040240386 45.38090521969415, 124.51377258986622 45.38090173760526, 124.5137850772699 45.38089630328016), (124.51375595396196 45.38088254425336, 124.51373729080716 45.380842107449496, 124.51375152470276 45.38086373200507, 124.51375310239175 45.380865621155095, 124.51375517016866 45.3808672587121, 124.51375764946164 45.38086858245162, 124.5137604460614 45.38086954207371, 124.51376345370177 45.38087010111428, 124.5137665580974 45.380870238330736, 124.51376964128633 45.38086994850905, 124.51377258611228 45.38086924266197, 124.51377528067673 45.38086814761056, 124.51377762259071 45.38086670496497, 124.51377952286525 45.380864969543396, 124.5137809092932 45.38086300728896, 124.5137815959251 45.38086123646152, 124.51378806613455 45.38086431751189, 124.51379081717599 45.38086536675369, 124.51379380582011 45.380866017606834, 124.51379391225107 45.38086602538727, 124.51375595396196 45.38088254425336), (124.51376059936071 45.38082260940302, 124.51375931547896 45.38082056470414, 124.51376604207536 45.380821760541515, 124.51376059936071 45.38082260940302), (124.5137429211017 45.38079445514675, 124.51373316118 45.380778911558785, 124.5137340653379 45.38077812042002, 124.5138546413557 45.38073922492611, 124.51385589688296 45.380738771583495, 124.51391833739524 45.38071371046183, 124.51392298087953 45.38071821106932, 124.51382405273915 45.38075824871869, 124.51382143477237 45.380759572797324, 124.51381924767308 45.38076124055125, 124.51381758063465 45.380763183966685, 124.51381650164195 45.380765323787976, 124.51381605469797 45.38076757274963, 124.51381625803005 45.38076983913528, 124.51381710334596 45.380772030517925, 124.51381855617232 45.380774057529315, 124.51382055726073 45.38077583750453, 124.51382302500322 45.3807772978532, 124.51382585876127 45.38077837901984, 124.51382894296944 45.38077903691265, 124.51383215184845 45.38077924470166, 124.51383535453489 45.38077899391287, 124.5138384204178 45.380778294773904, 124.51392240877497 45.38075228069456, 124.51389270783908 45.38076398963571, 124.51378038086804 45.380801114653096, 124.5137429211017 45.38079445514675), (124.5147372102384 45.380340419334715, 124.51473887925225 45.38033998735495, 124.51473983206111 45.38034181188403, 124.51473827549253 45.38034084982124, 124.5147372102384 45.380340419334715), (124.51480325739497 45.38040306342439, 124.5148041497698 45.38040605550394, 124.51479814558674 45.38041130286596, 124.51476830503333 45.38042386022562, 124.51476562308905 45.38041093814575, 124.51477576508418 45.38040423411839, 124.51477731321954 45.380405656515485, 124.51477956604195 45.380407069362576, 124.51478215582779 45.38040815826907, 124.51478499007463 45.380408884341286, 124.51478796754861 45.38040922164526, 124.5147909818998 45.38040915813316, 124.51479392546122 45.38040869607347, 124.51479669309444 45.38040785197013, 124.5147991859448 45.38040665597293, 124.51480131497223 45.38040515080066, 124.51480300413195 45.38040339021523, 124.51480325739497 45.38040306342439), (124.51364363052689 45.38109495490332, 124.51362494700147 45.38109938501044, 124.51361559102796 45.38109806932869, 124.51363089362447 45.381093454261176, 124.513641386094 45.3810913765415, 124.51364401832859 45.381090882996254, 124.51364363052689 45.38109495490332), (124.51482991323002 45.38030188884042, 124.51481731014852 45.38031823344352, 124.51481355144844 45.38031551882817, 124.51481603939182 45.38030805498218, 124.51482991323002 45.38030188884042), (124.51372960860964 45.38097876110845, 124.51382484902503 45.38093879413434, 124.51387257811389 45.38092080396496, 124.51387563130973 45.380921203767144, 124.51387874840259 45.38092117750332, 124.51388179876739 45.38092072464898, 124.51390085292714 45.38091649039822, 124.51372960860964 45.38097876110845), (124.51415232422677 45.38042005577407, 124.5141508203437 45.38041982820079, 124.51415065710346 45.38041981499071, 124.51420813676548 45.38039905838462, 124.514302392576 45.38036665058937, 124.51415232422677 45.38042005577407), (124.5140934872835 45.38041518856089, 124.51405831571783 45.380412342310606, 124.51411103488995 45.38039409335688, 124.51411364529925 45.380392958279565, 124.51411589930181 45.38039149218177, 124.51411702297115 45.38039041271041, 124.514191217713 45.38036502904321, 124.5144403691255 45.38027597420172, 124.51468883979216 45.380184794356026, 124.51493268571043 45.38008785560418, 124.5149748531971 45.38007194725583, 124.51497087355986 45.38009031477793, 124.51470657595115 45.38019204441717, 124.51457443531231 45.38023909877614, 124.51432171702255 45.38033499187717, 124.51419372329163 45.38037899214951, 124.5140934872835 45.38041518856089), (124.51616684881117 45.37937084009621, 124.51618789214781 45.37936177975055, 124.51629708526251 45.37932114976616, 124.51632455463222 45.379431027349156, 124.51616684881117 45.37937084009621), (124.51631596184727 45.379501559083955, 124.51631378113048 45.37951587000176, 124.5162967285658 45.37952079238399, 124.51631596184727 45.379501559083955), (124.5163101101274 45.37954123356265, 124.5163100981732 45.37954192983578, 124.51631063249418 45.3795440270054, 124.51631171853221 45.37954601550092, 124.51631265964377 45.379547080032566, 124.51624989439628 45.379567626531326, 124.51625358116493 45.37956393976785, 124.51630705520618 45.37954211539395, 124.5163101101274 45.37954123356265), (124.51500645037459 45.380075113217984, 124.51501001008897 45.380058683746164, 124.51504703448819 45.380044715670664, 124.51515930861888 45.37999860047469, 124.51527269711194 45.379949863312554, 124.51536662895636 45.37991723435436, 124.51544077752025 45.379895234237104, 124.51535831989429 45.37992714302229, 124.51522886331088 45.37998332475969, 124.51510172443909 45.380034385350704, 124.51500645037459 45.380075113217984), (124.51459711348679 45.38025621730622, 124.51453801443216 45.380278461866716, 124.51458938144435 45.38025897075436, 124.51459711348679 45.38025621730622), (124.51505840296508 45.380104580416976, 124.51506672172144 45.38010438844484, 124.51506325324459 45.380106923099675, 124.51501994131266 45.38012329428194, 124.51492319624869 45.380163189151276, 124.51447667245124 45.380332009100854, 124.51424589181302 45.38041293217739, 124.51424430033221 45.380413573099354, 124.51422030033436 45.38042457309751, 124.51421790092509 45.3804259208204, 124.51421591190115 45.38042756726893, 124.51421440680652 45.38042945156609, 124.51421344129142 45.380431504040466, 124.51421305105578 45.38043364880233, 124.51421325052848 45.38043580654964, 124.5142140323342 45.38043789750023, 124.51421472534824 45.38043890795297, 124.51415380988318 45.38046195702594, 124.51404879681304 45.38049696576335, 124.5139945810577 45.38051629487939, 124.51407655266041 45.38047221575506, 124.51434151734325 45.38037791912177, 124.51496851741945 45.38014191907988, 124.51505840296508 45.380104580416976), (124.51387854438951 45.38055040191629, 124.51382872739923 45.38056081818872, 124.51381307203654 45.38051306941818, 124.5138463557581 45.38052587084571, 124.513849252821 45.38052673603855, 124.5138523344666 45.380527183786505, 124.51385548087252 45.38052719668, 124.51385856969831 45.380526774217685, 124.51386148084238 45.38052593282601, 124.51399237915712 45.380476970858346, 124.51405723267905 45.38045355159473, 124.51404534351543 45.38045813386931, 124.51404278453683 45.38045936131089, 124.51404060999371 45.3804609138497, 124.51403890172001 45.380462733059524, 124.5140377240026 45.38046475047859, 124.51403770576108 45.38046481522468, 124.51387854438951 45.38055040191629), (124.51380111390012 45.38047659710964, 124.51379605352308 45.380461162947526, 124.51381965938062 45.38045689255795, 124.51380111390012 45.38047659710964), (124.51386581291997 45.38044854319091, 124.51397711024035 45.38042840895674, 124.51404227372667 45.38043368233221, 124.51397772331904 45.380456992135514, 124.51385410537029 45.38050322958851, 124.51382491133566 45.380492001115734, 124.51386581291997 45.38044854319091), (124.51550443277986 45.37987060137469, 124.51553518398484 45.37985765348771, 124.51553636808214 45.379857103165875, 124.51562636808859 45.37981110315846, 124.51562867085387 45.37980966847755, 124.51563054058612 45.37980794926698, 124.51563190791109 45.379806009316006, 124.51563199542541 45.37980578480644, 124.5157129859751 45.379774735498195, 124.51590170911993 45.37969784828655, 124.51609842607697 45.37962495316616, 124.51611410037418 45.3796188814613, 124.5161146239773 45.37962100550261, 124.51611575677956 45.379623069259274, 124.51611744109098 45.37962493673013, 124.5161196116936 45.37962653560522, 124.51611985511038 45.37962665560554, 124.5160052515683 45.37967216938914, 124.51587804345824 45.37972125254152, 124.51561918090542 45.37982619681342, 124.51550443277986 45.37987060137469), (124.51381229411034 45.38085802587572, 124.51381263388261 45.380857251020785, 124.51381295663505 45.38085505833929, 124.5138126661829 45.38085286341585, 124.51381177368832 45.380850750600146, 124.51381031344921 45.38084880108648, 124.51380834158209 45.38084708979352, 124.51380593386439 45.38084568248531, 124.51379468820664 45.38084032741351, 124.5138674479965 45.38082897954347, 124.51387141359577 45.380827957848815, 124.51399092270816 45.38078376119787, 124.51411965447056 45.380731869321714, 124.51425585501791 45.38068178832334, 124.51439364822745 45.38062687073666, 124.51457587500182 45.38055920853779, 124.51452662187718 45.38058340799622, 124.51428542416065 45.38067510298939, 124.51413833664105 45.380734134688645, 124.5138605745453 45.380837046538176, 124.51385961599537 45.38083743207183, 124.51381229411034 45.38085802587572), (124.51394624051706 45.38070251124782, 124.51400273152788 45.380679837947035, 124.51440056400467 45.38052890149584, 124.51451760620249 45.380481888337854, 124.51472603049866 45.380406273946264, 124.51470841976376 45.380417914918425, 124.51458531815695 45.3804681403697, 124.51445433892717 45.38051613563664, 124.51431443937454 45.380570096889635, 124.51399254062068 45.38069005915131, 124.51395081587197 45.380706945819796, 124.51394624051706 45.38070251124782)))</textarea>
            <div class="coord-settings" style="margin-bottom:8px;font-size:12px;color:#333;">
                <label>WKT坐标系：
                    <select id="coordSysSelect" style="margin-left:6px;">
                        <option value="wgs84" selected>WGS84</option>
                        <option value="gcj02">GCJ-02（国测局）</option>
                        <option value="bd09">BD-09（百度）</option>
                        <option value="cgcs2000">CGCS2000</option>
                    </select>
                </label>
                <!-- 已移除“不进行绘制坐标转换”选项，统一使用WGS84绘制 -->
            </div>

            <div class="button-group">
                <button id="drawButton" disabled>绘制轮廓</button>
                <button id="clearButton" disabled>清空轮廓</button>
            </div>
            <!-- 显示开关：仅保留显示亩数 -->
            <div class="display-toggles" style="margin-top:8px;font-size:12px;color:#333;">
                <label><input type="checkbox" id="toggleLabelsCheckbox"> 显示亩数</label>
            </div>
        </div>

        <div class="tab-pane" id="tabSplit">
            <!-- MultiPolygon → 多个 Polygon 分割器 -->
            <div class="split-section">
                <div class="title">MultiPolygon → 多个 Polygon 分割器</div>
                <div class="desc">输入一个 MULTIPOLYGON WKT，分割为多行 POLYGON WKT。</div>
                <textarea id="multiInput"></textarea>
                <div class="split-actions">
                    <button id="splitMultiBtn">分割为多个 POLYGON</button>
                    <button id="copyPolysBtn">复制结果</button>
                </div>
                <textarea id="polyOutput" readonly></textarea>
            </div>
        </div>

        <div class="tab-pane" id="tabBatch">
            <!-- 批量POLYGON → MULTIPOLYGON 生成器 -->
            <div class="batch-section">
                <div class="title">批量POLYGON → MULTIPOLYGON 合并器</div>
                <div class="desc">每行一个 POLYGON WKT（或用分号分隔）。生成后可一键填充到上方并绘制。</div>
                <textarea id="batchInput"></textarea>
                <div class="batch-actions">
                    <button id="generateMultiBtn">生成 MULTIPOLYGON</button>
                    <button id="copyMultiBtn">复制结果</button>
                </div>
                <textarea id="multiOutput" readonly></textarea>
            </div>
        </div>
        <div class="tab-pane" id="tabTrack">
            <div class="tip">请粘贴轨迹文本（支持两种格式：1）每行一条：定位时间yyyyMMddHHmmss, 经度, 纬度；2）单行#分隔：经度,纬度,定位时间yyyyMMddHHmmss#经度,纬度,定位时间yyyyMMddHHmmss#…）。</div>
            <div class="coord-settings" style="margin-bottom:8px;font-size:12px;color:#333;">
                <label>轨迹坐标系：
                    <select id="trackCoordSysSelect" style="margin-left:6px;">
                        <option value="wgs84" selected>WGS84</option>
                        <option value="gcj02">GCJ-02（国测局）</option>
                        <option value="bd09">BD-09（百度）</option>
                        <option value="cgcs2000">CGCS2000</option>
                    </select>
                </label>
            </div>
            <textarea id="trackTextarea" style="width:100%;height:120px;margin-bottom:10px;padding:8px;border:1px solid #ddd;border-radius:4px;font-family:monospace;resize:vertical;box-sizing:border-box;">20251026070913,124.504478,45.342070
20251026070923,124.504457,45.342095
20251026070933,124.504473,45.342090
20251026070943,124.504470,45.342091
20251026070953,124.504470,45.342092
20251026072557,124.504442,45.342061
20251026072607,124.504448,45.342046
20251026072617,124.504211,45.341974
20251026072627,124.503904,45.341932
20251026072637,124.503733,45.341892
20251026072647,124.503316,45.341757
20251026072657,124.502903,45.341637
20251026072707,124.502600,45.341977
20251026072717,124.502340,45.342350
20251026072727,124.502025,45.342477
20251026072737,124.501643,45.342732
20251026072747,124.501239,45.342690
20251026072757,124.500959,45.342962
20251026072807,124.500619,45.343330
20251026072817,124.500228,45.343719
20251026072827,124.499718,45.344275
20251026072837,124.499090,45.344970
20251026072847,124.498582,45.345561
20251026072857,124.498217,45.346022
20251026072907,124.498007,45.346464
20251026072917,124.498392,45.347121
20251026072927,124.498615,45.347829
20251026072937,124.498705,45.348489
20251026072947,124.498687,45.349042
20251026072957,124.498666,45.349617
20251026073007,124.498683,45.350207
20251026073017,124.498755,45.350742
20251026073027,124.498802,45.351288
20251026073037,124.499082,45.351873
20251026073047,124.499531,45.352439
20251026073057,124.499927,45.353023
20251026073107,124.500244,45.353657
20251026073117,124.500475,45.354266
20251026073127,124.500717,45.354936
20251026073137,124.500959,45.355563
20251026073148,124.501259,45.356153
20251026073158,124.501540,45.356684
20251026073208,124.501929,45.357104
20251026073218,124.502194,45.357453
20251026073228,124.502431,45.357795
20251026073238,124.502765,45.358104
20251026073248,124.503148,45.358367
20251026073258,124.503463,45.358696
20251026073308,124.503532,45.359118
20251026073318,124.503284,45.359578
20251026073328,124.502889,45.360018
20251026073338,124.502482,45.360476
20251026073348,124.502045,45.360940
20251026073358,124.501325,45.361107
20251026073408,124.500777,45.361455
20251026073418,124.500428,45.361913
20251026073428,124.500497,45.362429
20251026073438,124.500407,45.362956
20251026073448,124.500054,45.363433
20251026073458,124.499718,45.363888
20251026073508,124.499564,45.364131
20251026073518,124.499413,45.364417
20251026073528,124.499492,45.365015
20251026073538,124.499636,45.365657
20251026073548,124.499764,45.366264
20251026073558,124.499874,45.366848
20251026073608,124.499961,45.367379
20251026073618,124.500044,45.367879
20251026073628,124.500097,45.368377
20251026073638,124.500122,45.368852
20251026073648,124.500146,45.369348
20251026073658,124.500175,45.369852
20251026073708,124.500208,45.370337
20251026073718,124.500242,45.370760
20251026073728,124.500282,45.371191
20251026073738,124.500305,45.371649
20251026073748,124.500260,45.372122
20251026073758,124.500218,45.372558
20251026073808,124.500190,45.372852
20251026073818,124.500261,45.373016
20251026073828,124.500566,45.373071
20251026073838,124.500988,45.372975
20251026073848,124.501321,45.372866
20251026073858,124.501660,45.372846
20251026073908,124.502022,45.373022
20251026073918,124.502371,45.373202
20251026073928,124.502721,45.373360
20251026073938,124.503082,45.373537
20251026073948,124.503427,45.373718
20251026073958,124.503776,45.373905
20251026074008,124.504092,45.374068
20251026074018,124.504445,45.374252
20251026074028,124.504804,45.374441
20251026074038,124.505154,45.374636
20251026074048,124.505503,45.374826
20251026074058,124.505852,45.374990
20251026074108,124.506182,45.375192
20251026074118,124.506428,45.375439
20251026074128,124.506654,45.375684
20251026074138,124.506853,45.375958
20251026074148,124.507000,45.376194
20251026074158,124.507145,45.376461
20251026074208,124.507278,45.376743
20251026074218,124.507422,45.377016
20251026074228,124.507591,45.377296
20251026074238,124.507804,45.377522
20251026074248,124.508117,45.377737
20251026074258,124.508544,45.377922
20251026074308,124.508943,45.378088
20251026074318,124.509335,45.378236
20251026074328,124.509728,45.378397
20251026074338,124.510169,45.378591
20251026074348,124.510560,45.378781
20251026074358,124.511020,45.379022
20251026074408,124.511403,45.379255
20251026074418,124.511765,45.379476
20251026074428,124.512224,45.379747
20251026074438,124.512577,45.379943
20251026074448,124.512966,45.380150
20251026074458,124.513358,45.380356
20251026074508,124.513603,45.380385
20251026074518,124.513845,45.380275
20251026074528,124.514199,45.380148
20251026074538,124.514588,45.380005
20251026074548,124.514934,45.379865
20251026074558,124.515257,45.379726
20251026074608,124.515598,45.379591
20251026074618,124.515917,45.379464
20251026074628,124.516153,45.379356
20251026074638,124.516320,45.379299
20251026074648,124.516676,45.379180
20251026074658,124.517075,45.379019
20251026074708,124.517474,45.378853
20251026074718,124.517847,45.378707
20251026074728,124.518231,45.378531
20251026074738,124.518678,45.378304
20251026074748,124.519152,45.378073
20251026074758,124.519573,45.377861
20251026074808,124.519937,45.377683
20251026074818,124.520297,45.377523
20251026074828,124.520610,45.377645
20251026074838,124.520847,45.377799
20251026074848,124.521158,45.377995
20251026074858,124.521556,45.378241
20251026074908,124.521820,45.378411
20251026074918,124.522122,45.378600
20251026074928,124.522388,45.378768
20251026074938,124.522684,45.378935
20251026074948,124.522904,45.379060
20251026074958,124.523093,45.379178
20251026075008,124.523376,45.379287
20251026075018,124.523474,45.379307
20251026075028,124.523408,45.379346
20251026075038,124.523371,45.379397
20251026075048,124.523348,45.379479
20251026075058,124.523335,45.379560
20251026075108,124.523279,45.379473
20251026075118,124.523243,45.379441
20251026075128,124.523243,45.379441
20251026075137,124.523243,45.379441
20251026075147,124.523243,45.379441
20251026075157,124.523239,45.379440
20251026075207,124.523174,45.379412
20251026075217,124.523089,45.379379
20251026075227,124.523024,45.379355
20251026075237,124.522971,45.379334
20251026075247,124.522976,45.379337
20251026075257,124.522963,45.379332
20251026075307,124.522963,45.379332
20251026075317,124.522963,45.379332
20251026075327,124.522963,45.379332
20251026075337,124.522963,45.379332
20251026075347,124.522963,45.379332
20251026075357,124.522963,45.379332
20251026075407,124.522963,45.379332
20251026075417,124.522963,45.379332
20251026075427,124.522963,45.379332
20251026075437,124.522963,45.379332
20251026075447,124.522962,45.379332
20251026075457,124.522962,45.379332
20251026075507,124.522962,45.379332
20251026075517,124.522962,45.379332
20251026075527,124.522962,45.379332
20251026075537,124.522962,45.379332
20251026075547,124.522962,45.379332
20251026075557,124.522962,45.379332
20251026075607,124.522942,45.379323
20251026075617,124.522898,45.379303
20251026075627,124.522853,45.379281
20251026075637,124.522810,45.379259
20251026075647,124.522769,45.379237
20251026075657,124.522720,45.379210
20251026075707,124.522677,45.379184
20251026075717,124.522628,45.379156
20251026075727,124.522555,45.379109
20251026075737,124.522465,45.379049
20251026075747,124.522395,45.379010
20251026075757,124.522341,45.378974
20251026075807,124.522278,45.378932
20251026075817,124.522223,45.378893
20251026075827,124.522164,45.378861
20251026075837,124.522103,45.378822
20251026075847,124.522043,45.378783
20251026075857,124.521971,45.378736
20251026075907,124.521908,45.378695
20251026075917,124.521851,45.378653
20251026075927,124.521787,45.378606
20251026075937,124.521723,45.378557
20251026075947,124.521657,45.378506
20251026075957,124.521589,45.378460
20251026080007,124.521529,45.378422
20251026080017,124.521462,45.378381
20251026080027,124.521418,45.378356
20251026080037,124.521375,45.378330
20251026080047,124.521446,45.378369
20251026080057,124.521200,45.378178
20251026080107,124.520904,45.378016
20251026080117,124.520877,45.378001
20251026080127,124.520877,45.378001
20251026080137,124.520877,45.378001
20251026080147,124.520877,45.378001
20251026080157,124.520877,45.378001
20251026080207,124.520877,45.378001
20251026080217,124.520877,45.378001
20251026080227,124.520877,45.378001
20251026080237,124.520877,45.378001
20251026080247,124.520877,45.378001
20251026080257,124.520877,45.378001
20251026080307,124.520877,45.378001
20251026080317,124.520877,45.378001
20251026080327,124.520877,45.378001
20251026080337,124.520877,45.378001
20251026080347,124.520877,45.378001
20251026080357,124.520877,45.378001
20251026080407,124.520877,45.378001
20251026080417,124.520877,45.378001
20251026080427,124.520877,45.378001
20251026080437,124.520877,45.378001
20251026080447,124.520877,45.378001
20251026080457,124.520877,45.378001
20251026080507,124.520841,45.377985
20251026080517,124.520746,45.377941
20251026080527,124.520607,45.377867
20251026080537,124.520666,45.377893
20251026080547,124.520677,45.377902
20251026080557,124.520789,45.377974
20251026080607,124.520853,45.378012
20251026080617,124.520819,45.377982
20251026080627,124.521032,45.378106
20251026080637,124.521106,45.378155
20251026080647,124.521179,45.378203
20251026080657,124.521273,45.378262
20251026080707,124.521095,45.378142
20251026080717,124.521030,45.378115
20251026080727,124.521096,45.378164
20251026080737,124.521181,45.378220
20251026080747,124.521208,45.378237
20251026080757,124.521175,45.378197
20251026080807,124.521222,45.378228
20251026080817,124.521224,45.378228
20251026080827,124.521224,45.378228
20251026080837,124.521222,45.378228
20251026080847,124.521222,45.378228
20251026080857,124.521266,45.378250
20251026080907,124.521592,45.378439
20251026080917,124.521894,45.378660
20251026080927,124.522211,45.378872
20251026080937,124.522551,45.379088
20251026080947,124.522897,45.379281
20251026080957,124.523244,45.379435
20251026081007,124.523326,45.379527
20251026081017,124.523336,45.379460
20251026081027,124.523376,45.379348
20251026081037,124.523468,45.379303
20251026081047,124.523296,45.379252
20251026081057,124.523031,45.379149
20251026081107,124.522791,45.379003
20251026081117,124.522487,45.378818
20251026081127,124.522217,45.378648
20251026081137,124.521991,45.378508
20251026081147,124.521685,45.378313
20251026081157,124.521370,45.378113
20251026081207,124.521094,45.377928
20251026081217,124.520805,45.377765
20251026081227,124.520508,45.377570
20251026081237,124.520155,45.377558
20251026081247,124.519806,45.377736
20251026081257,124.519449,45.377912
20251026081307,124.519088,45.378096
20251026081317,124.518707,45.378281
20251026081327,124.518327,45.378472
20251026081337,124.517943,45.378659
20251026081347,124.517546,45.378820
20251026081357,124.517160,45.378970
20251026081407,124.516801,45.379122
20251026081417,124.516550,45.379222
20251026083907,124.519705,45.377988
20251026083917,124.519681,45.378001
20251026083927,124.519596,45.378045
20251026083937,124.519501,45.378089
20251026083947,124.519404,45.378140
20251026083957,124.519279,45.378205
20251026084007,124.519159,45.378263
20251026084017,124.519064,45.378309
20251026084027,124.518968,45.378355
20251026084037,124.518870,45.378401
20251026084047,124.518769,45.378446
20251026084057,124.518662,45.378497
20251026084107,124.518556,45.378549
20251026084117,124.518453,45.378596
20251026084127,124.518345,45.378647
20251026084137,124.518241,45.378694
20251026084147,124.518125,45.378745
20251026084157,124.518016,45.378795
20251026084207,124.517900,45.378844
20251026084217,124.517780,45.378892
20251026084227,124.517660,45.378941
20251026084237,124.517544,45.378989
20251026084247,124.517428,45.379037
20251026084257,124.517513,45.379003
20251026084306,124.517520,45.379000
20251026084316,124.517519,45.379000
20251026084326,124.517518,45.379000
20251026084336,124.517518,45.379000
20251026084346,124.517484,45.379014
20251026084356,124.517367,45.379062
20251026084406,124.517260,45.379108
20251026084416,124.517147,45.379157
20251026084426,124.517033,45.379202
20251026084436,124.516911,45.379255
20251026084446,124.516826,45.379291
20251026084456,124.516826,45.379291
20251026084506,124.516826,45.379291
20251026084516,124.516787,45.379308
20251026084526,124.516674,45.379356
20251026084536,124.516553,45.379408
20251026084546,124.516420,45.379462
20251026084556,124.516554,45.379406
20251026084606,124.516617,45.379373
20251026084616,124.516451,45.379443
20251026084626,124.516445,45.379466
20251026084636,124.516400,45.379540
20251026084646,124.516428,45.379506
20251026084656,124.516408,45.379481
20251026084706,124.516441,45.379495
20251026084716,124.516506,45.379467
20251026084726,124.516575,45.379440
20251026084736,124.516423,45.379491
20251026084746,124.516444,45.379504
20251026084756,124.516535,45.379486
20251026084806,124.516654,45.379436
20251026084816,124.516653,45.379436
20251026084826,124.516648,45.379438
20251026084836,124.516535,45.379479
20251026084846,124.516619,45.379424
20251026084856,124.516652,45.379408
20251026084906,124.516699,45.379387
20251026084916,124.516805,45.379341
20251026084926,124.516802,45.379339
20251026084936,124.516706,45.379349
20251026084946,124.516707,45.379349
20251026084956,124.516708,45.379349
20251026085006,124.516708,45.379349
20251026085016,124.516707,45.379349
20251026085026,124.516708,45.379349
20251026085036,124.516708,45.379348
20251026085046,124.516709,45.379348
20251026085056,124.516709,45.379348
20251026085106,124.516650,45.379362
20251026085116,124.516625,45.379365
20251026085126,124.516625,45.379365
20251026085136,124.516625,45.379365
20251026085146,124.516625,45.379365
20251026085156,124.516625,45.379365
20251026085206,124.516625,45.379365
20251026085216,124.516625,45.379365
20251026085226,124.516625,45.379365
20251026085236,124.516625,45.379365
20251026085246,124.516625,45.379365
20251026085256,124.516625,45.379365
20251026085306,124.516625,45.379365
20251026085316,124.516625,45.379365
20251026085326,124.516625,45.379365
20251026085336,124.516625,45.379365
20251026085346,124.516625,45.379365
20251026085356,124.516625,45.379365
20251026085406,124.516625,45.379365
20251026085416,124.516625,45.379365
20251026085426,124.516625,45.379365
20251026085436,124.516729,45.379357
20251026085446,124.516860,45.379318
20251026085456,124.516967,45.379275
20251026085506,124.517076,45.379227
20251026085516,124.517185,45.379183
20251026085526,124.517286,45.379140
20251026085536,124.517390,45.379096
20251026085546,124.517514,45.379041
20251026085556,124.517638,45.378993
20251026085606,124.517756,45.378944
20251026085616,124.517877,45.378893
20251026085626,124.517995,45.378846
20251026085636,124.518046,45.378823
20251026085646,124.518159,45.378773
20251026085656,124.518204,45.378754
20251026085706,124.518207,45.378752
20251026085716,124.518290,45.378713
20251026085726,124.518386,45.378670
20251026085736,124.518490,45.378622
20251026085746,124.518579,45.378581
20251026085756,124.518669,45.378538
20251026085806,124.518774,45.378488
20251026085816,124.518884,45.378437
20251026085826,124.518989,45.378389
20251026085836,124.519095,45.378336
20251026085846,124.519208,45.378282
20251026085856,124.519325,45.378223
20251026085906,124.519432,45.378166
20251026085916,124.519548,45.378110
20251026085926,124.519662,45.378051
20251026085936,124.519777,45.377997
20251026085946,124.519731,45.378008
20251026085956,124.519660,45.378018
20251026090006,124.519660,45.378018
20251026090016,124.519660,45.378018
20251026090026,124.519660,45.378018
20251026090036,124.519660,45.378018
20251026090046,124.519761,45.377950
20251026090056,124.519955,45.377845
20251026090106,124.520052,45.377860
20251026090116,124.520007,45.377899
20251026090126,124.519899,45.377950
20251026090136,124.519795,45.378002
20251026090146,124.519691,45.378050
20251026090156,124.519650,45.378070
20251026090206,124.519562,45.378113
20251026090216,124.519599,45.378094
20251026090226,124.519463,45.378150
20251026090236,124.519340,45.378215
20251026090246,124.519245,45.378262
20251026090256,124.519176,45.378297
20251026090306,124.519064,45.378351
20251026090316,124.518946,45.378408
20251026090326,124.518830,45.378461
20251026090336,124.518692,45.378526
20251026090346,124.518582,45.378580
20251026090356,124.518473,45.378630
20251026090406,124.518360,45.378680
20251026090416,124.518242,45.378735
20251026090426,124.518117,45.378796
20251026090436,124.518076,45.378826
20251026090446,124.517998,45.378864
20251026090456,124.517925,45.378893
20251026090506,124.517985,45.378869
20251026090516,124.517983,45.378870
20251026090526,124.517983,45.378870
20251026090536,124.517983,45.378870
20251026090546,124.517983,45.378870
20251026090556,124.517983,45.378870
20251026090606,124.517983,45.378870
20251026090616,124.517962,45.378878
20251026090626,124.517878,45.378912
20251026090636,124.517792,45.378949
20251026090646,124.517723,45.378977
20251026090656,124.517650,45.379007
20251026090706,124.517675,45.378996
20251026090716,124.517675,45.378996
20251026090726,124.517675,45.378996
20251026090736,124.517675,45.378996
20251026090746,124.517645,45.379009
20251026090756,124.517575,45.379039
20251026090806,124.517510,45.379066
20251026090816,124.517445,45.379092
20251026090826,124.517377,45.379120
20251026090836,124.517306,45.379148
20251026090846,124.517326,45.379139
20251026090856,124.517230,45.379181
20251026090906,124.517135,45.379222
20251026090916,124.517044,45.379258
20251026090926,124.516968,45.379295
20251026090936,124.516885,45.379329
20251026090946,124.516794,45.379369
20251026090956,124.516687,45.379414
20251026091006,124.516801,45.379357
20251026091016,124.516764,45.379386
20251026091026,124.516643,45.379441
20251026091036,124.516538,45.379486
20251026091046,124.516580,45.379467
20251026091056,124.516580,45.379467
20251026091106,124.516579,45.379467
20251026091116,124.516579,45.379467
20251026091126,124.516579,45.379467
20251026091136,124.516579,45.379467
20251026091146,124.516579,45.379467
20251026091156,124.516632,45.379445
20251026091206,124.516542,45.379419
20251026091216,124.516413,45.379457
20251026091226,124.516279,45.379495
20251026091236,124.516174,45.379521
20251026091246,124.516065,45.379562
20251026091256,124.515972,45.379598
20251026091306,124.515880,45.379631
20251026091316,124.515771,45.379671
20251026091326,124.515749,45.379680
20251026091336,124.515637,45.379726
20251026091346,124.515601,45.379739
20251026091356,124.515497,45.379781
20251026091406,124.515391,45.379824
20251026091416,124.515277,45.379870
20251026091426,124.515167,45.379914
20251026091436,124.515059,45.379957
20251026091446,124.515059,45.379958
20251026091456,124.514938,45.380006
20251026091506,124.514836,45.380049
20251026091516,124.514721,45.380090
20251026091526,124.514608,45.380135
20251026091535,124.514487,45.380181
20251026091545,124.514364,45.380225
20251026091555,124.514323,45.380241
20251026091605,124.514199,45.380286
20251026091615,124.514108,45.380317
20251026091625,124.514048,45.380338
20251026091635,124.513995,45.380356
20251026091645,124.514069,45.380342
20251026091655,124.513963,45.380400
20251026091705,124.513837,45.380443
20251026091715,124.513905,45.380422
20251026091725,124.514063,45.380341
20251026091735,124.513888,45.380401
20251026091745,124.513881,45.380410
20251026091755,124.514035,45.380367
20251026091805,124.513953,45.380434
20251026091815,124.513901,45.380455
20251026091825,124.513874,45.380468
20251026091835,124.513786,45.380499
20251026091845,124.513873,45.380485
20251026091855,124.513872,45.380492
20251026091905,124.513828,45.380512
20251026091915,124.513837,45.380513
20251026091925,124.513848,45.380552
20251026091935,124.513854,45.380528
20251026091945,124.513815,45.380542
20251026091955,124.513810,45.380554
20251026092005,124.513818,45.380588
20251026092015,124.513822,45.380519
20251026092025,124.513803,45.380506
20251026092035,124.513865,45.380506
20251026092045,124.513902,45.380496
20251026092055,124.513888,45.380532
20251026092105,124.513929,45.380522
20251026092115,124.513858,45.380474
20251026092125,124.513849,45.380443
20251026092135,124.513903,45.380406
20251026092145,124.513902,45.380406
20251026092155,124.513902,45.380406
20251026092205,124.513902,45.380406
20251026092215,124.513902,45.380406
20251026092225,124.513902,45.380406
20251026092235,124.513902,45.380406
20251026092245,124.513979,45.380406
20251026092255,124.514040,45.380385
20251026092305,124.514098,45.380361
20251026092315,124.514203,45.380324
20251026092325,124.514321,45.380281
20251026092335,124.514445,45.380236
20251026092345,124.514576,45.380188
20251026092355,124.514707,45.380137
20251026092405,124.514837,45.380088
20251026092415,124.514968,45.380036
20251026092425,124.515015,45.380017
20251026092435,124.515016,45.380017
20251026092445,124.515016,45.380017
20251026092455,124.515016,45.380017
20251026092505,124.515016,45.380017
20251026092515,124.515016,45.380017
20251026092525,124.515030,45.380011
20251026092535,124.515130,45.379972
20251026092545,124.515247,45.379923
20251026092555,124.515362,45.379876
20251026092605,124.515471,45.379830
20251026092615,124.515595,45.379781
20251026092625,124.515727,45.379729
20251026092635,124.515858,45.379677
20251026092645,124.515991,45.379626
20251026092655,124.516125,45.379576
20251026092705,124.516216,45.379540
20251026092715,124.516259,45.379523
20251026092725,124.516175,45.379539
20251026092735,124.516118,45.379554
20251026092745,124.516118,45.379554
20251026092755,124.516118,45.379554
20251026092805,124.516118,45.379554
20251026092815,124.516118,45.379554
20251026092825,124.516118,45.379554
20251026092835,124.516224,45.379519
20251026092845,124.516422,45.379529
20251026092855,124.516400,45.379538
20251026092905,124.516463,45.379496
20251026092915,124.516462,45.379497
20251026092925,124.516462,45.379497
20251026092935,124.516462,45.379497
20251026092945,124.516462,45.379496
20251026092955,124.516462,45.379496
20251026093005,124.516462,45.379496
20251026093015,124.516462,45.379496
20251026093025,124.516462,45.379496
20251026093035,124.516462,45.379496
20251026093045,124.516462,45.379496
20251026093055,124.516462,45.379496
20251026093105,124.516462,45.379496
20251026093115,124.516462,45.379496
20251026093125,124.516462,45.379497
20251026093135,124.516461,45.379497
20251026093145,124.516460,45.379497
20251026093155,124.516397,45.379504
20251026093205,124.516300,45.379532
20251026093215,124.516202,45.379572
20251026093225,124.516091,45.379615
20251026093235,124.515989,45.379653
20251026093245,124.515894,45.379688
20251026093255,124.515795,45.379728
20251026093305,124.515705,45.379765
20251026093315,124.515658,45.379783
20251026093325,124.515585,45.379811
20251026093335,124.515617,45.379802
20251026093345,124.515527,45.379848
20251026093355,124.515451,45.379880
20251026093405,124.515360,45.379907
20251026093415,124.515265,45.379940
20251026093425,124.515151,45.379989
20251026093435,124.515039,45.380035
20251026093445,124.514925,45.380078
20251026093455,124.514808,45.380124
20251026093505,124.514681,45.380175
20251026093515,124.514557,45.380221
20251026093525,124.514433,45.380266
20251026093535,124.514310,45.380310
20251026093545,124.514184,45.380355
20251026093555,124.514070,45.380394
20251026093605,124.514104,45.380384
20251026093615,124.514104,45.380384
20251026093625,124.514104,45.380384
20251026093635,124.514026,45.380411
20251026093645,124.513882,45.380411
20251026093655,124.513802,45.380496
20251026093705,124.513854,45.380516
20251026093715,124.513985,45.380467
20251026093725,124.514082,45.380432
20251026093735,124.514201,45.380389
20251026093745,124.514329,45.380345
20251026093755,124.514454,45.380298
20251026093805,124.514582,45.380249
20251026093815,124.514714,45.380202
20251026093825,124.514850,45.380150
20251026093835,124.514979,45.380100
20251026093845,124.515110,45.380044
20251026093855,124.515237,45.379993
20251026093905,124.515366,45.379937
20251026093915,124.515492,45.379889
20251026093925,124.515627,45.379836
20251026093935,124.515753,45.379785
20251026093945,124.515886,45.379731
20251026093955,124.516013,45.379682
20251026094005,124.516039,45.379671
20251026094015,124.516160,45.379624
20251026094025,124.516264,45.379583
20251026094035,124.516363,45.379543
20251026094045,124.516140,45.379616
20251026094055,124.516130,45.379618
20251026094105,124.516130,45.379618
20251026094115,124.516207,45.379591
20251026094125,124.516346,45.379452
20251026094135,124.516139,45.379373
20251026094145,124.515983,45.379435
20251026094155,124.515902,45.379462
20251026094205,124.515902,45.379463
20251026094215,124.515902,45.379463
20251026094225,124.515903,45.379463
20251026094235,124.515902,45.379463
20251026094245,124.515902,45.379463
20251026094255,124.515902,45.379463
20251026094305,124.515902,45.379463
20251026094315,124.515906,45.379461
20251026094325,124.515982,45.379434
20251026094335,124.516036,45.379414
20251026094345,124.516180,45.379352
20251026094355,124.516309,45.379304
20251026094405,124.516342,45.379436
20251026094415,124.516326,45.379541
20251026094425,124.516460,45.379500
20251026094435,124.516465,45.379500
20251026094445,124.516452,45.379505
20251026094455,124.516364,45.379554
20251026094505,124.516290,45.379586
20251026094515,124.516204,45.379617
20251026094525,124.516237,45.379604
20251026094535,124.516131,45.379647
20251026094545,124.516039,45.379683
20251026094555,124.515958,45.379715
20251026094605,124.515891,45.379740
20251026094615,124.515803,45.379777
20251026094625,124.515820,45.379770
20251026094635,124.515711,45.379813
20251026094645,124.515772,45.379790
20251026094655,124.515745,45.379800
20251026094705,124.515661,45.379833
20251026094715,124.515653,45.379835
20251026094725,124.515585,45.379863
20251026094735,124.515554,45.379876
20251026094745,124.515462,45.379911
20251026094755,124.515355,45.379953
20251026094805,124.515257,45.379999
20251026094815,124.515168,45.380046
20251026094825,124.515066,45.380088
20251026094835,124.514961,45.380132
20251026094845,124.514853,45.380172
20251026094855,124.514733,45.380218
20251026094905,124.514604,45.380266
20251026094915,124.514468,45.380318
20251026094925,124.514334,45.380368
20251026094935,124.514197,45.380416
20251026094945,124.514053,45.380468
20251026094955,124.514149,45.380431
20251026095005,124.513976,45.380417
20251026095015,124.513777,45.380453
20251026095025,124.513817,45.380575
20251026095035,124.513927,45.380552
20251026095045,124.513941,45.380548
20251026095055,124.514056,45.380507
20251026095105,124.514161,45.380472
20251026095115,124.514272,45.380430
20251026095125,124.514229,45.380434
20251026095135,124.514253,45.380423
20251026095145,124.514371,45.380382
20251026095155,124.514484,45.380342
20251026095205,124.514580,45.380305
20251026095215,124.514688,45.380264
20251026095225,124.514797,45.380224
20251026095235,124.514931,45.380173
20251026095245,124.515028,45.380133
20251026095255,124.515073,45.380116
20251026095305,124.515099,45.380097
20251026095315,124.515116,45.380092
20251026095325,124.514986,45.380095
20251026095335,124.514999,45.380035
20251026095345,124.514920,45.380060
20251026095355,124.514743,45.380132
20251026095405,124.514716,45.380146
20251026095415,124.514716,45.380146
20251026095425,124.514716,45.380146
20251026095435,124.514716,45.380146
20251026095445,124.514538,45.380215
20251026095455,124.514230,45.380339
20251026095505,124.514221,45.380420
20251026095515,124.514226,45.380443
20251026095525,124.514189,45.380473
20251026095535,124.514194,45.380472
20251026095545,124.514125,45.380502
20251026095555,124.514066,45.380530
20251026095605,124.514125,45.380488
20251026095615,124.513972,45.380545
20251026095625,124.513852,45.380585
20251026095635,124.513952,45.380549
20251026095645,124.513952,45.380550
20251026095655,124.513952,45.380550
20251026095705,124.513952,45.380550
20251026095715,124.513952,45.380550
20251026095725,124.513952,45.380550
20251026095735,124.513952,45.380550
20251026095745,124.513951,45.380550
20251026095755,124.513882,45.380602
20251026095805,124.513870,45.380617
20251026095815,124.513767,45.380661
20251026095825,124.513640,45.380708
20251026095835,124.513700,45.380701
20251026095845,124.513720,45.380686
20251026095855,124.513679,45.380762
20251026095905,124.513712,45.380773
20251026095915,124.513766,45.380859
20251026095925,124.513714,45.380780
20251026095935,124.513708,45.380815
20251026095945,124.513750,45.380906
20251026095955,124.513716,45.380909
20251026100005,124.513664,45.380981
20251026100015,124.513555,45.381033
20251026100025,124.513503,45.381123
20251026100035,124.513470,45.381114
20251026100045,124.513605,45.381066
20251026100055,124.513718,45.381024
20251026100105,124.513826,45.380984
20251026100115,124.513922,45.380945
20251026100125,124.513800,45.380995
20251026100135,124.513637,45.381054
20251026100144,124.513554,45.381097
20251026100154,124.513655,45.381077
20251026100204,124.513733,45.381050
20251026100214,124.513843,45.381010
20251026100224,124.513869,45.380999
20251026100234,124.513688,45.381064
20251026100244,124.513562,45.381102
20251026100254,124.513626,45.381111
20251026100304,124.513723,45.381088
20251026100314,124.513831,45.381045
20251026100324,124.513857,45.381032
20251026100334,124.513660,45.381091
20251026100344,124.513658,45.381112
20251026100354,124.513706,45.381100
20251026100404,124.513834,45.381056
20251026100414,124.513774,45.381083
20251026100424,124.513857,45.381055
20251026100434,124.513656,45.381077
20251026100444,124.513528,45.381101
20251026100454,124.513578,45.381054
20251026100504,124.513684,45.381008
20251026100514,124.513808,45.380962
20251026100524,124.513915,45.380924
20251026100534,124.513709,45.381002
20251026100544,124.513705,45.380976
20251026100554,124.513817,45.380929
20251026100604,124.513947,45.380880
20251026100614,124.514070,45.380836
20251026100624,124.514193,45.380789
20251026100634,124.514323,45.380737
20251026100644,124.514448,45.380690
20251026100654,124.514294,45.380752
20251026100704,124.514126,45.380815
20251026100714,124.513978,45.380870
20251026100724,124.513877,45.380910
20251026100734,124.513967,45.380890
20251026100744,124.514094,45.380848
20251026100754,124.514068,45.380851
20251026100804,124.514239,45.380786
20251026100814,124.514370,45.380732
20251026100824,124.514327,45.380754
20251026100834,124.514368,45.380734
20251026100844,124.514489,45.380663
20251026100854,124.514375,45.380729
20251026100904,124.514482,45.380644
20251026100914,124.514455,45.380659
20251026100924,124.514555,45.380599
20251026100934,124.514662,45.380546
20251026100944,124.514540,45.380607
20251026100954,124.514653,45.380535
20251026101004,124.514629,45.380551
20251026101014,124.514732,45.380496
20251026101024,124.514845,45.380450
20251026101034,124.514731,45.380511
20251026101044,124.514709,45.380487
20251026101054,124.514826,45.380427
20251026101104,124.514837,45.380436
20251026101114,124.514763,45.380476
20251026101124,124.514741,45.380370
20251026101134,124.514729,45.380350
20251026101144,124.514782,45.380390
20251026101154,124.514735,45.380300
20251026101204,124.514789,45.380398
20251026101214,124.514820,45.380358
20251026101224,124.514792,45.380349
20251026101234,124.514797,45.380342
20251026101244,124.514811,45.380343
20251026101254,124.514778,45.380300
20251026101304,124.514772,45.380391
20251026101314,124.514802,45.380301
20251026101324,124.514910,45.380253
20251026101334,124.514853,45.380282
20251026101344,124.514803,45.380282
20251026101354,124.514864,45.380261
20251026101404,124.514885,45.380254
20251026101414,124.514821,45.380337
20251026101424,124.514767,45.380298
20251026101434,124.514700,45.380305
20251026101444,124.514742,45.380285
20251026101454,124.514742,45.380285
20251026101504,124.514742,45.380285
20251026101514,124.514742,45.380285
20251026101524,124.514742,45.380286
20251026101534,124.514742,45.380286
20251026101544,124.514742,45.380285
20251026101554,124.514735,45.380289
20251026101604,124.514665,45.380319
20251026101614,124.514565,45.380355
20251026101624,124.514473,45.380391
20251026101634,124.514407,45.380414
20251026101644,124.514363,45.380431
20251026101654,124.514242,45.380480
20251026101704,124.514212,45.380493
20251026101714,124.514077,45.380547
20251026101724,124.514106,45.380535
20251026101734,124.513944,45.380596
20251026101744,124.513916,45.380614
20251026101754,124.513772,45.380688
20251026101804,124.513695,45.380808
20251026101814,124.513708,45.380915
20251026101824,124.513700,45.381054
20251026101834,124.513675,45.380981
20251026101844,124.513793,45.380906
20251026101854,124.513903,45.380867
20251026101904,124.514019,45.380824
20251026101914,124.514159,45.380768
20251026101924,124.514298,45.380715
20251026101934,124.514371,45.380686
20251026101944,124.514447,45.380662
20251026101954,124.514566,45.380589
20251026102004,124.514646,45.380543
20251026102014,124.514827,45.380428
20251026102024,124.514793,45.380314
20251026102034,124.514708,45.380336
20251026102044,124.514614,45.380369
20251026102054,124.514520,45.380402
20251026102104,124.514416,45.380443
20251026102114,124.514299,45.380492
20251026102124,124.514167,45.380544
20251026102134,124.514030,45.380594
20251026102144,124.513878,45.380653
20251026102154,124.513859,45.380659
20251026102204,124.513735,45.380686
20251026102214,124.513638,45.380716
20251026102325,124.513711,45.380972
20251026102335,124.513760,45.380894
20251026102345,124.513868,45.380847
20251026102355,124.514000,45.380799
20251026102405,124.514146,45.380744
20251026102416,124.514293,45.380685
20251026102426,124.514449,45.380625
20251026102436,124.514535,45.380593
20251026102446,124.514708,45.380508
20251026102456,124.514827,45.380404
20251026102506,124.514839,45.380328
20251026102516,124.514696,45.380371
20251026102526,124.514569,45.380418
20251026102536,124.514437,45.380468
20251026102546,124.514297,45.380523
20251026102556,124.514153,45.380579
20251026102606,124.514010,45.380634
20251026102616,124.513857,45.380693
20251026102626,124.513764,45.380727
20251026102636,124.513935,45.380638
20251026102646,124.514008,45.380569
20251026102656,124.514007,45.380569
20251026102706,124.514007,45.380569
20251026102716,124.514007,45.380569
20251026102726,124.514007,45.380569
20251026102736,124.514007,45.380569
20251026102746,124.514007,45.380569
20251026102756,124.514007,45.380569
20251026102806,124.513976,45.380582
20251026103206,124.513797,45.380855
20251026103216,124.513755,45.380835
20251026103226,124.513864,45.380818
20251026103236,124.513983,45.380774
20251026103246,124.514112,45.380722
20251026103256,124.514248,45.380672
20251026103306,124.514386,45.380617
20251026103316,124.514525,45.380565
20251026103326,124.514623,45.380529
20251026103336,124.514826,45.380433
20251026103346,124.514839,45.380356
20251026103356,124.514725,45.380394
20251026103406,124.514623,45.380432
20251026103416,124.514510,45.380472
20251026103426,124.514393,45.380519
20251026103436,124.514260,45.380569
20251026103446,124.514129,45.380620
20251026103456,124.513995,45.380670
20251026103506,124.513860,45.380724
20251026103516,124.513848,45.380729
20251026103526,124.513724,45.380769
20251026103536,124.513692,45.380797
20251026103546,124.513782,45.380813
20251026103556,124.513900,45.380774
20251026103606,124.514027,45.380724
20251026103616,124.514168,45.380669
20251026103626,124.514316,45.380610
20251026103636,124.514470,45.380555
20251026103646,124.514628,45.380496
20251026103656,124.514662,45.380482
20251026103706,124.514849,45.380403
20251026103716,124.514836,45.380349
20251026103726,124.514718,45.380427
20251026103736,124.514593,45.380478
20251026103746,124.514462,45.380526
20251026103756,124.514322,45.380580
20251026103806,124.514166,45.380638
20251026103816,124.514000,45.380700
20251026103826,124.513832,45.380768
20251026103836,124.513945,45.380733
20251026103846,124.513959,45.380734
20251026103856,124.513959,45.380734
20251026103906,124.513959,45.380734
20251026103916,124.513894,45.380671
20251026103926,124.513887,45.380560
20251026103936,124.514099,45.380446
20251026103946,124.514490,45.380282
20251026103956,124.514862,45.380108
20251026104006,124.515180,45.379984
20251026104016,124.515323,45.379919
20251026104026,124.515639,45.379771
20251026104036,124.515870,45.379683
20251026104046,124.516119,45.379627
20251026104056,124.516296,45.379567
20251026104106,124.516377,45.379473
20251026104116,124.516219,45.379338
20251026104126,124.515954,45.379442
20251026104136,124.515714,45.379532
20251026104146,124.515694,45.379539
20251026104156,124.515694,45.379539
20251026104206,124.515694,45.379539
20251026104216,124.515694,45.379539
20251026104226,124.515711,45.379533
20251026104236,124.515718,45.379530
20251026104246,124.515459,45.379645
20251026104256,124.515240,45.379722
20251026104306,124.515240,45.379722
20251026104316,124.515240,45.379722
20251026104326,124.515240,45.379722
20251026104336,124.515240,45.379722
20251026104346,124.515240,45.379722
20251026104356,124.515240,45.379722
20251026104406,124.515240,45.379722
20251026104416,124.515053,45.379805
20251026104426,124.514792,45.379930
20251026104436,124.514479,45.380035
20251026104446,124.514084,45.380181
20251026104456,124.513976,45.380221
20251026104506,124.513671,45.380342
20251026104516,124.513589,45.380386
20251026104526,124.513585,45.380389
20251026104536,124.513583,45.380390
20251026104546,124.513581,45.380391
20251026104556,124.513553,45.380410
20251026104606,124.513512,45.380482
20251026104616,124.513378,45.380730
20251026104626,124.513122,45.381007
20251026104636,124.512816,45.381279
20251026104646,124.512519,45.381525
20251026104656,124.512261,45.381744
20251026104706,124.512008,45.381964
20251026104716,124.511707,45.382224
20251026104726,124.511408,45.382470
20251026104736,124.511059,45.382816
20251026104746,124.510654,45.383055
20251026104756,124.510159,45.383217
20251026104806,124.509592,45.383380
20251026104816,124.508979,45.383412
20251026104826,124.508399,45.383336
20251026104836,124.507906,45.383253
20251026104846,124.507496,45.383179
20251026104856,124.507040,45.383098
20251026104906,124.506566,45.383016
20251026104916,124.506020,45.382929
20251026110716,124.502423,45.377497
20251026110726,124.502356,45.377409
20251026110736,124.502331,45.377323
20251026110746,124.502309,45.377230
20251026110756,124.502283,45.377131
20251026110806,124.502269,45.377082
20251026110816,124.502243,45.376989
20251026110826,124.502233,45.377004
20251026110836,124.502217,45.377111
20251026110846,124.502216,45.377111
20251026110856,124.502216,45.377111
20251026110906,124.502216,45.377111
20251026110916,124.502216,45.377111
20251026110926,124.502216,45.377111
20251026110936,124.502216,45.377111
20251026110946,124.502216,45.377111
20251026110956,124.502216,45.377110
20251026111006,124.502217,45.377055
20251026111016,124.502226,45.376925
20251026111026,124.502204,45.376840
20251026111036,124.502177,45.376746
20251026111046,124.502148,45.376643
20251026111056,124.502147,45.376646
20251026111106,124.502128,45.376571
20251026111116,124.502106,45.376485
20251026111126,124.502083,45.376396
20251026111136,124.502079,45.376380
20251026111146,124.502055,45.376295
20251026111156,124.502050,45.376225
20251026111206,124.502046,45.376188
20251026111216,124.502068,45.376231
20251026111226,124.502087,45.376302
20251026111236,124.502111,45.376390
20251026111246,124.502134,45.376479
20251026111256,124.502157,45.376574
20251026111306,124.502185,45.376669
20251026111316,124.502214,45.376768
20251026111326,124.502240,45.376859
20251026111336,124.502268,45.376960
20251026111346,124.502294,45.377058
20251026111356,124.502321,45.377157
20251026111406,124.502346,45.377255
20251026111416,124.502339,45.377215
20251026111426,124.502430,45.377249
20251026111436,124.502393,45.377242
20251026111446,124.502392,45.377232
20251026111455,124.502376,45.377160
20251026111506,124.502355,45.377079
20251026111516,124.502330,45.376988
20251026111526,124.502304,45.376891
20251026111536,124.502275,45.376788
20251026111546,124.502248,45.376687
20251026111556,124.502218,45.376581
20251026111606,124.502187,45.376470
20251026111616,124.502157,45.376354
20251026111626,124.502127,45.376238
20251026111636,124.502157,45.376357
20251026111646,124.502135,45.376333
20251026111656,124.502116,45.376311
20251026111706,124.501985,45.376243
20251026111716,124.501803,45.376234
20251026111726,124.501616,45.376201
20251026111736,124.501426,45.376168
20251026111746,124.501354,45.376086
20251026111756,124.501333,45.376013
20251026111806,124.501307,45.375922
20251026111816,124.501282,45.375822
20251026111826,124.501255,45.375721
20251026111836,124.501226,45.375611
20251026111846,124.501197,45.375501
20251026111856,124.501172,45.375391
20251026111906,124.501164,45.375358
20251026111916,124.501148,45.375288
20251026111925,124.501238,45.375231
20251026111936,124.501231,45.375232
20251026111946,124.501173,45.375254
20251026111955,124.501174,45.375258
20251026112006,124.501174,45.375258
20251026112016,124.501174,45.375258
20251026112025,124.501187,45.375311
20251026112036,124.501205,45.375400
20251026112046,124.501229,45.375499
20251026112056,124.501256,45.375605
20251026112106,124.501286,45.375713
20251026112116,124.501315,45.375821
20251026112126,124.501341,45.375931
20251026112136,124.501372,45.376037
20251026112146,124.501402,45.376184
20251026112156,124.501496,45.376184
20251026112206,124.501470,45.376153
20251026112216,124.501426,45.376066
20251026112226,124.501402,45.375982
20251026112236,124.501380,45.375888
20251026112246,124.501378,45.375882
20251026112256,124.501355,45.375782
20251026112306,124.501325,45.375673
20251026112316,124.501298,45.375564
20251026112326,124.501266,45.375446
20251026112336,124.501237,45.375314
20251026112346,124.501219,45.375206
20251026112356,124.501219,45.375185
20251026112406,124.501214,45.375134
20251026112416,124.501215,45.375133
20251026112426,124.501206,45.375068
20251026112436,124.501208,45.375149
20251026112446,124.501208,45.375149
20251026112456,124.501208,45.375149
20251026112506,124.501208,45.375149
20251026112516,124.501208,45.375149
20251026112526,124.501208,45.375149
20251026112536,124.501208,45.375149
20251026112546,124.501208,45.375149
20251026112556,124.501208,45.375149
20251026112606,124.501208,45.375149
20251026112616,124.501188,45.375271
20251026112626,124.501211,45.375341
20251026112635,124.501215,45.375402
20251026112645,124.501215,45.375402
20251026112655,124.501215,45.375402
20251026112705,124.501215,45.375402
20251026112715,124.501215,45.375402
20251026112725,124.501215,45.375402
20251026112735,124.501215,45.375402
20251026112745,124.501215,45.375402
20251026112755,124.501215,45.375402
20251026112805,124.501216,45.375412
20251026112815,124.501076,45.375455
20251026112825,124.501056,45.375362
20251026112835,124.501051,45.375245
20251026112845,124.501052,45.375245
20251026112855,124.501051,45.375245
20251026112905,124.501052,45.375245
20251026112915,124.501052,45.375245
20251026112925,124.501052,45.375245
20251026112935,124.501058,45.375046
20251026112945,124.501026,45.374737
20251026112955,124.500997,45.374437
20251026113005,124.500950,45.374151
20251026113015,124.500915,45.373834
20251026113025,124.500882,45.373518
20251026113035,124.500774,45.373212
20251026113045,124.500600,45.373050
20251026113055,124.500622,45.373051
20251026113105,124.500621,45.373051
20251026113115,124.500613,45.373052
20251026113125,124.500613,45.373052
20251026113135,124.500612,45.373051
20251026113145,124.500612,45.373051
20251026113155,124.500612,45.373051
20251026113205,124.500605,45.373052
20251026113215,124.500713,45.373048
20251026113225,124.500753,45.373047
20251026113235,124.500611,45.373214
20251026113245,124.500646,45.373244
20251026113255,124.500645,45.373244
20251026114822,124.500646,45.373244
20251026114832,124.500657,45.373224
20251026114842,124.500655,45.373226
20251026114852,124.500654,45.373231
20251026114902,124.500654,45.373233
20251026114912,124.500655,45.373235
20251026114922,124.500664,45.373214
20251026114932,124.500665,45.373217
20251026114942,124.500665,45.373222
20251026114952,124.500663,45.373226
20251026115002,124.500660,45.373227
20251026115012,124.500658,45.373226
20251026115022,124.500654,45.373216
20251026115032,124.500654,45.373220
20251026115042,124.500656,45.373224
20251026115052,124.500657,45.373229
20251026115102,124.500659,45.373232
20251026115112,124.500660,45.373232
20251026115122,124.500656,45.373212
20251026115132,124.500652,45.373213
20251026115142,124.500649,45.373216
20251026115152,124.500647,45.373225
20251026115202,124.500684,45.373108
20251026115212,124.500362,45.373049
20251026115222,124.500191,45.372936
20251026115232,124.500204,45.372704
20251026115242,124.500249,45.372258
20251026115252,124.500300,45.371801
20251026115302,124.500288,45.371147
20251026115312,124.500229,45.370479
20251026115322,124.500184,45.369804
20251026115332,124.500149,45.369130
20251026115342,124.500111,45.368390
20251026115352,124.500018,45.367624
20251026115402,124.499884,45.366823
20251026115412,124.499731,45.366062
20251026115422,124.499591,45.365406
20251026115432,124.499429,45.364674
20251026115442,124.499639,45.364006
20251026115452,124.500085,45.363408
20251026115502,124.500429,45.362926
20251026115512,124.500509,45.362805
20251026115522,124.500454,45.362284
20251026115532,124.500580,45.361714
20251026115542,124.500995,45.361238
20251026115552,124.501799,45.361064
20251026115602,124.502405,45.360576
20251026115612,124.502953,45.359957
20251026115622,124.503461,45.359364
20251026115632,124.503460,45.358707
20251026115642,124.503115,45.358362
20251026115652,124.502644,45.358004
20251026115702,124.502217,45.357489
20251026115712,124.501722,45.356886
20251026115722,124.501321,45.356324
20251026115732,124.501083,45.355794
20251026115742,124.500815,45.355186
20251026115752,124.500599,45.354574
20251026115802,124.500351,45.353935
20251026115812,124.500326,45.353881
20251026115822,124.500326,45.353881
20251026115832,124.500321,45.353867
20251026115842,124.500199,45.353531
20251026115852,124.499857,45.352911
20251026115902,124.499417,45.352301
20251026115912,124.498962,45.351677
20251026115922,124.498767,45.351037
20251026115932,124.498741,45.350608
20251026115942,124.498689,45.350260
20251026115952,124.498668,45.349864
20251026120002,124.498673,45.349261
20251026120012,124.498719,45.348655
20251026120022,124.498651,45.348035
20251026120032,124.498534,45.347386
20251026120042,124.498231,45.346884
20251026120052,124.498125,45.346678
20251026120102,124.498041,45.346249
20251026120112,124.498577,45.345591
20251026120122,124.498906,45.345172
20251026120132,124.499417,45.344621
20251026120142,124.499962,45.344025
20251026120152,124.500387,45.343543
20251026120202,124.500738,45.343217
20251026120212,124.501089,45.342808
20251026120222,124.501512,45.342726
20251026120232,124.502016,45.342493
20251026120242,124.502419,45.342262
20251026120252,124.502784,45.341741
20251026120302,124.503203,45.341728
20251026120312,124.503735,45.341889
20251026120322,124.504188,45.341972
20251026120332,124.504545,45.342075
20251026120342,124.504552,45.342070
20251026120352,124.504518,45.342077
20251026120402,124.504465,45.342087
20251026120412,124.504387,45.342124</textarea>
            <div class="button-group">
                <button id="drawTrackButton" disabled style="flex: 1;">绘制轨迹</button>
                <button id="showTrackPointsButton" disabled style="flex: 1;" class="btn-warning">打点</button>
                <button id="clearTrackButton" disabled style="flex: 1;">清空轨迹</button>
            </div>
            <!-- 回放控制 -->
            <div class="split-section" style="margin-top:8px;">
                <div class="title">轨迹回放</div>
                <div class="playback-actions" style="display:flex;gap:8px;margin-bottom:8px;">
                    <button id="playbackStartBtn" disabled>开始</button>
                    <button id="playbackPauseBtn" disabled>继续</button>
                    <button id="playbackStopBtn" disabled>结束</button>
                </div>
                <div class="playback-speed" style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
                    <label>速度：
                        <select id="playbackSpeedSelect" disabled>
                            <option value="1" selected>1×</option>
                            <option value="2">2×</option>
                            <option value="4">4×</option>
                            <option value="8">8×</option>
                            <option value="16">16×</option>
                            <option value="32">32×</option>
                            <option value="64">64×</option>
                            <option value="128">128×</option>
                            <option value="256">256×</option>
                            <option value="512">512×</option>
                            <option value="1024">1024×</option>
                        </select>
                    </label>
                    <span id="playbackTimeLabel" style="font-size:12px;color:#666;">时间：—</span>
                </div>
                <div class="playback-time" style="display:flex;flex-direction:column;gap:4px;margin-bottom:8px;">
                    <label class="playback-time-label" style="display:flex;align-items:center;gap:8px;flex:1 1 auto;min-width:0;">
                        <span class="playback-time-text" style="white-space:nowrap;">起始时间：</span>
                        <input type="range" id="playbackTimeSlider" disabled min="0" max="0" step="1000" value="0" style="flex:1 1 auto;min-width:0;max-width:100%;vertical-align:middle;">
                    </label>
                    <span id="playbackTimeCursor" style="font-size:12px;color:#666;align-self:flex-end;">—</span>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let map;
    let currentPolygons = []; // 存储多边形和其标签
    let currentTracks = []; // 存储轨迹折线及相关覆盖物
    let mapLoaded = false;
    let mapLabelHandlers = []; // 存储地图事件处理器
    let labelsEnabled = false; // 标签显示开关（默认关闭）
    let isDrawing = false; // 绘制进行中防止重复点击

    window.onload = function () {
        if (typeof T === 'undefined') {
            alert("天地图API加载失败，请检查网络或密钥！");
            return;
        }
        initMap();
        bindDrawEvent();
        bindMinimizeEvent();
        bindTabs();
        bindBatchGenerator();
        bindMultiSplitter();
        bindLabelsToggle(); // 绑定标签显示开关
        bindTrackEvents();  // 绑定轨迹绘制与清空
        bindPlaybackControls(); // 绑定轨迹回放
    };

    function initMap() {
        showLoading();
        disableButtons(true);

        try {
            map = new T.Map("mapContainer", {
                zoom: 12,
                center: new T.LngLat(116.40769, 39.90403)
            });

            // 已移除测试标签
            map.enableScrollWheelZoom();

            // 添加地图类型控件
            const mapTypeCtrl = new T.Control.MapType({
                mapTypes: [TMAP_NORMAL_MAP, TMAP_SATELLITE_MAP, TMAP_TERRAIN_MAP],
                position: T_ANCHOR_TOP_LEFT
            });
            map.addControl(mapTypeCtrl);

            // 加载影像底图（卫星）
            const tk = "648f621977051d0199ff0f965d3fd322";

            // 方案1：使用默认地图类型（作为备选）
            map.setMapType(TMAP_SATELLITE_MAP);

            // 方案2：手动添加影像图层（底图 + 标注）
            const vecLayer = new T.TileLayer(`https://t0.tianditu.gov.cn/img_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=img&STYLE=default&TILEMATRIXSET=w&FORMAT=tiles&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk=${tk}`);
            const cvaLayer = new T.TileLayer(`https://t0.tianditu.gov.cn/cia_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=cia&STYLE=default&TILEMATRIXSET=w&FORMAT=tiles&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk=${tk}`);

            // 添加图层并监听加载状态
            vecLayer.addEventListener("load", function () {
                console.log("影像底图加载完成");
            });

            vecLayer.addEventListener("error", function (e) {
                console.error("影像底图加载错误:", e);
                alert("影像底图加载错误，将使用默认地图类型");
            });

            map.addLayer(vecLayer);
            map.addLayer(cvaLayer);

            // 监听地图加载事件
            map.addEventListener("loaded", function () {
                console.log("地图加载完成");
                markMapLoaded();
            });
            map.addEventListener("load", function () {
                console.log("地图load事件触发");
                markMapLoaded();
            });
            map.addEventListener("tilesloaded", function () {
                console.log("地图瓦片加载完成");
                markMapLoaded();
            });
            // 监听地图加载失败事件
            map.addEventListener("error", function (e) {
                console.error("地图加载错误:", e);
                alert("地图加载错误: " + e.message);
                hideLoading();
            });

            // 监听地图移动事件，用于更新标签位置
            const moveHandler = function () {
                updateAllLabelsPosition();
            };
            map.addEventListener("move", moveHandler);
            map.addEventListener("zoom", moveHandler);

            // 存储事件处理器，用于清理
            mapLabelHandlers.push({ event: "move", handler: moveHandler });
            mapLabelHandlers.push({ event: "zoom", handler: moveHandler });

            // 超时容错
            setTimeout(() => {
                if (!mapLoaded) markMapLoaded();
            }, 8000);

        } catch (error) {
            alert("地图初始化失败：" + error.message);
            console.error(error);
            hideLoading();
        }
    }

    function markMapLoaded() {
        if (!mapLoaded) {
            mapLoaded = true;
            hideLoading();
            disableButtons(false);
            disableTrackButtons(false);
            // 仅开启速度选择，回放按钮按状态控制
            const speedSel = document.getElementById('playbackSpeedSelect');
            if (speedSel) speedSel.disabled = false;
            updatePlaybackButtonsState('idle');
        }
    }

    function showLoading() {
        const loading = document.getElementById("mapLoading");
        loading.style.display = "flex";
        loading.style.opacity = "1";
    }

    function hideLoading() {
        const loading = document.getElementById("mapLoading");
        loading.style.opacity = "0";
        setTimeout(() => loading.style.display = "none", 300);
    }

    function disableButtons(disabled) {
        document.getElementById("drawButton").disabled = disabled;
        document.getElementById("clearButton").disabled = disabled;
    }

    function disableTrackButtons(disabled) {
        const drawTrackBtn = document.getElementById("drawTrackButton");
        const showTrackPointsBtn = document.getElementById("showTrackPointsButton");
        const clearTrackBtn = document.getElementById("clearTrackButton");
        if (drawTrackBtn) drawTrackBtn.disabled = disabled;
        if (showTrackPointsBtn) showTrackPointsBtn.disabled = disabled;
        if (clearTrackBtn) clearTrackBtn.disabled = disabled;
    }
    // 回放控件的禁用/启用
    function disablePlaybackButtons(disabled) {
        ["playbackStartBtn","playbackPauseBtn","playbackStopBtn","playbackSpeedSelect","playbackTimeSlider"].forEach(id=>{
            const el = document.getElementById(id);
            if (el) el.disabled = disabled;
        });
    }

    // 回放按钮状态管理：空闲/播放/暂停
    function updatePlaybackButtonsState(state){
        try {
            const startBtn = document.getElementById('playbackStartBtn');
            const pauseBtn = document.getElementById('playbackPauseBtn');
            const stopBtn = document.getElementById('playbackStopBtn');
            if (!startBtn || !pauseBtn || !stopBtn) return;
            if (state === 'idle') {
                startBtn.disabled = false;
                pauseBtn.disabled = true;
                stopBtn.disabled = true;
                pauseBtn.textContent = '继续';
            } else if (state === 'playing') {
                startBtn.disabled = true;
                pauseBtn.disabled = false;
                stopBtn.disabled = false;
                pauseBtn.textContent = '暂停';
            } else if (state === 'paused') {
                startBtn.disabled = true;
                pauseBtn.disabled = false;
                stopBtn.disabled = false;
                pauseBtn.textContent = '继续';
            }
        } catch(e) { console.warn('更新按钮状态失败:', e); }
    }

    function bindDrawEvent() {
        document.getElementById("drawButton").addEventListener("click", function () {
            if (isDrawing) { console.log('绘制进行中，忽略重复点击'); return; }
            isDrawing = true;
            disableButtons(true);
            showLoading();
            try {
                const wktStr = document.getElementById("wktTextarea").value.trim();
                if (!wktStr) { alert("请输入WKT字符串！"); return; }
                clearOverlays();
                const geojson = parseWkt(wktStr);
    
                const polygonData = [];
                if (geojson.type === "Polygon") {
                    polygonData.push({ index: 1, coordinates: geojson.coordinates });
                } else if (geojson.type === "MultiPolygon") {
                    geojson.coordinates.forEach((polygon, index) => {
                        polygonData.push({ index: index + 1, coordinates: polygon });
                    });
                }
    
                // 重置并绘制
                polygonInfoList = [];
                polygonData.forEach(pd => processPolygon(pd.index, pd.coordinates));
    
                // 视图居中到所有已绘制轮廓
                try { fitViewportToPolygons(); } catch (e) { console.warn('视图居中失败', e); }
    
                // 在视图稳定后再创建/更新标签
                setTimeout(() => {
                    if (labelsEnabled) {
                        try {
                            createAllLabels();
                            updateAllLabelsPosition();
                        } catch (e) {
                            console.warn('创建或更新标签失败:', e);
                        }
                    }
                }, 150);
            } catch (e) {
                alert('绘制失败：' + (e && e.message ? e.message : e));
                console.error('绘制异常:', e);
            } finally {
                hideLoading();
                isDrawing = false;
                disableButtons(false);
            }
        });

        document.getElementById("clearButton").addEventListener("click", function () {
            if (isDrawing) { console.log('绘制进行中，暂不清空'); return; }
            clearOverlays();
            console.log("已清空所有轮廓");
        });
    }

    // 存储多边形数据，用于后续标签创建
    let polygonInfoList = [];

    // 处理单个多边形的绘制和面积计算
    function processPolygon(actualPolygonIndex, polygonCoords) {
        console.log('开始处理多边形', actualPolygonIndex);

        // 坐标系选择（绘制始终使用WGS84坐标）
        const coordSys = (document.getElementById('coordSysSelect') && document.getElementById('coordSysSelect').value) || 'wgs84';

        // 统一转换为WGS84用于绘制与面积计算
        function toWgs(point){
            const lng = point[0], lat = point[1];
            if (coordSys === 'wgs84' || coordSys === 'cgcs2000') {
                return [lng, lat];
            } else if (coordSys === 'gcj02') {
                const w = gcj02ToWgs84(lng, lat);
                return [w.lng, w.lat];
            } else if (coordSys === 'bd09') {
                const gcj = bd09ToGcj02(lng, lat);
                const w = gcj02ToWgs84(gcj.lng, gcj.lat);
                return [w.lng, w.lat];
            }
            return [lng, lat];
        }
        const coordsWGS84 = polygonCoords.map(ring => ring.map(toWgs));
        let outerRingWGS = coordsWGS84[0] || [];

        // 生成用于绘制的坐标（直接使用WGS84坐标）
        const rings = coordsWGS84.map(ring => ring.map(([lng, lat]) => new T.LngLat(lng, lat)));


         // 创建半透明填充的多边形（无边框）
          const polygon = new T.Polygon(rings, {
              color: "#FFD700",
              weight: 1,
              opacity: 1,
              fillColor: "#FFFF00",
              fillOpacity: 0.35
          });
 
          // 使用WGS84坐标计算面积（更准确的面积计算）
         let areaSqm;
         let areaMu;



         try {
             // 检查Turf.js是否可用
             if (typeof turf !== 'undefined' && turf.area) {
                 // 使用Turf.js计算多边形面积
                // 构造GeoJSON格式的多边形
                const geoJsonPolygon = {
                    type: "Polygon",
                    coordinates: coordsWGS84
                };


                 // 使用Turf.js计算面积（平方米）
                 areaSqm = turf.area(geoJsonPolygon);
                 areaMu = (areaSqm / 666.6667).toFixed(4); // 转换为亩
                 console.log(`多边形${actualPolygonIndex}面积计算结果(Turf.js): ${areaSqm}平方米 = ${areaMu}亩`);
             } else {
                 // 如果Turf.js不可用，回退到之前的计算方法
                 console.warn('Turf.js不可用，使用备用计算方法');
                 // 计算带孔洞的多边形面积
                 areaSqm = 0;
                 // 计算外环面积
                 outerRingWGS = coordsWGS84[0] || [];
                 areaSqm += calculatePolygonArea(outerRingWGS);

                 // 减去内环（孔洞）面积
                 for (let i = 1; i < coordsWGS84.length; i++) {
                     const innerRingArea = calculatePolygonArea(coordsWGS84[i]);
                     areaSqm -= innerRingArea;
                 }

                  areaMu = (areaSqm / 666.6667).toFixed(4); // 使用更精确的转换系数
                  console.log(`多边形${actualPolygonIndex}面积计算结果(备用): ${areaSqm}平方米 = ${areaMu}亩`);
              }
          } catch (error) {
              console.error(`面积计算失败:`, error);
              areaSqm = 0;
              areaMu = '0.0000';
          }

          // 计算多边形的中心点和底部中心点（WGS84）
          const centerPoint = calculatePolygonCenter(outerRingWGS);
          const bottomCenterPoint = calculatePolygonBottomCenter(outerRingWGS);

          // 添加多边形到地图
          if (map) {
              map.addOverLay(polygon);
              console.log(`多边形${actualPolygonIndex}已添加到地图`);
          } else {
              console.error('地图对象不存在');
          }

          // 存储多边形信息，用于后续标签创建
          polygonInfoList.push({
              index: actualPolygonIndex,
              polygon: polygon,
              area: areaMu,
              bottomCenter: { lng: bottomCenterPoint.lng, lat: bottomCenterPoint.lat },
              ringPoints: rings
          });
      }

    // 视图居中：根据已绘制的GCJ-02点
    function fitViewportToPolygons() {
        const points = [];
        try {
            if (!map || !map.setViewport) return;
            polygonInfoList.forEach(info => {
                if (!info || !info.ringPoints) return;
                info.ringPoints.forEach(ring => {
                    ring.forEach(ll => points.push(ll));
                });
            });
            if (!points.length) return;
            map.setViewport(points);
        } catch (e) {
            try {
                const lngs = points.map(p => p.lng);
                const lats = points.map(p => p.lat);
                const center = new T.LngLat(
                    (Math.min(...lngs) + Math.max(...lngs)) / 2,
                    (Math.min(...lats) + Math.max(...lats)) / 2
                );
                if (map && map.panTo) map.panTo(center);
            } catch (e2) {
                console.warn('视图居中失败:', e2);
            }
        }
    }

    // 统一创建所有多边形的标签
    function createAllLabels() {
        const mapContainer = document.getElementById('mapContainer');
        if (!mapContainer || !map) return;

        polygonInfoList.forEach(info => {
            if (!info) return;
            // 防止重复创建
            if (info.labelRef) return;
            // 创建标签元素
            const labelDiv = document.createElement('div');
            labelDiv.className = 'area-label';
            labelDiv.innerHTML = `多边形${info.index}：${info.area}亩`;

            // 添加到地图容器并根据屏幕边界定位到轮廓下方
            mapContainer.appendChild(labelDiv);
            positionLabelForPolygon(labelDiv, info);

            // 记录引用，避免重复创建
            info.labelRef = labelDiv;

            // 存储到 currentPolygons 以复用现有定位/清理逻辑
            const labelObj = {
                domElement: labelDiv,
                isDomLabel: true,
                polygonInfo: info
            };
            currentPolygons.push({ polygon: info.polygon, label: labelObj });
        });

        // 不清空 polygonInfoList，便于开关随时创建/隐藏标签
    }

    // 根据多边形屏幕边界定位标签，保证始终在轮廓下方
    function positionLabelForPolygon(labelDiv, info) {
        if (!map || !info || !info.ringPoints) return;
        const points = [];
        info.ringPoints.forEach(ring => {
            ring.forEach(ll => {
                const p = map.lngLatToContainerPoint(ll);
                points.push(p);
            });
        });
        if (!points.length) return;
        const minX = Math.min(...points.map(p => p.x));
        const maxX = Math.max(...points.map(p => p.x));
        const maxY = Math.max(...points.map(p => p.y));
        const container = document.getElementById('mapContainer');
        const labelWidth = labelDiv.offsetWidth;
        const labelHeight = labelDiv.offsetHeight;
        const targetLeft = Math.round((minX + maxX) / 2 - labelWidth / 2);
        const targetTop = Math.round(maxY + 6);
        const clampedLeft = Math.max(0, Math.min(targetLeft, container.clientWidth - labelWidth));
        const clampedTop = Math.max(0, Math.min(targetTop, container.clientHeight - labelHeight));
        labelDiv.style.left = clampedLeft + 'px';
        labelDiv.style.top = clampedTop + 'px';
    }

    // 更新所有标签位置（地图move/zoom时调用）
    function updateAllLabelsPosition() {
        try {
            if (!map) return;
            const container = document.getElementById('mapContainer');
            if (!container) return;
            currentPolygons.forEach(item => {
                if (!item || !item.label) return;
                const labelObj = item.label;
                if (labelObj.isDomLabel && labelObj.domElement && labelObj.polygonInfo) {
                    // 确保标签在容器中
                    if (!labelObj.domElement.parentNode) {
                        container.appendChild(labelObj.domElement);
                    }
                    positionLabelForPolygon(labelObj.domElement, labelObj.polygonInfo);
                }
            });
        } catch (e) {
            console.warn('更新标签位置时出错:', e);
        }
    }
    // 确保在全局可用（处理第三方库事件回调作用域差异）
    window.updateAllLabelsPosition = updateAllLabelsPosition;

    // 绑定“显示亩数标签”开关（默认隐藏）
    function bindLabelsToggle() {
        const cb = document.getElementById('toggleLabelsCheckbox');
        const container = document.getElementById('mapContainer');
        if (!cb || !container) return;
        // 默认隐藏标签
        container.classList.add('labels-hidden');
        cb.addEventListener('change', () => {
            labelsEnabled = cb.checked;
            if (labelsEnabled) {
                container.classList.remove('labels-hidden');
                const hasAnyLabel = currentPolygons.some(item => item && item.label && item.label.domElement);
                if (!hasAnyLabel) {
                    try { createAllLabels(); } catch (e) { console.warn('创建标签失败:', e); }
                }
                updateAllLabelsPosition();
            } else {
                container.classList.add('labels-hidden');
            }
        });
    }

    /**
     * 计算多边形中心点（比底部中心更适合显示标签）
     */
    function calculatePolygonCenter(outerRing) {
        let sumLng = 0, sumLat = 0;
        const len = outerRing.length;

        for (let i = 0; i < len; i++) {
            sumLng += outerRing[i][0];
            sumLat += outerRing[i][1];
        }

        return {
            lng: sumLng / len,
            lat: sumLat / len
        };
    }

    /**
     * 计算多边形面积（球面多边形面积计算）
     * 使用更准确的球面坐标面积计算方法，确保面积与视觉大小一致
     */
    function calculatePolygonArea(coordinates) {
        // 地球半径（米）- 使用更精确的值
        const R = 6371000.8;
        const n = coordinates.length;

        // 将所有坐标转换为弧度
        const coordsRad = coordinates.map(point => [
            point[0] * Math.PI / 180,
            point[1] * Math.PI / 180
        ]);

        let areaRad = 0;

        // 使用更准确的球面多边形面积公式（Girard定理）
        for (let i = 0; i < n; i++) {
            const j = (i + 1) % n;
            const lon1 = coordsRad[i][0];
            const lat1 = coordsRad[i][1];
            const lon2 = coordsRad[j][0];
            const lat2 = coordsRad[j][1];

            // 计算球面多边形面积增量
            const dlon = lon2 - lon1;
            const sinLat1 = Math.sin(lat1);
            const sinLat2 = Math.sin(lat2);
            const cosLat1 = Math.cos(lat1);
            const cosLat2 = Math.cos(lat2);

            // 使用更精确的公式
            areaRad += dlon * (sinLat1 * cosLat2 * Math.cos(dlon / 2) + sinLat2 * cosLat1);
        }

        // 计算总面积（平方米）
        const areaSqm = Math.abs(areaRad) * R * R * 0.5;

        return areaSqm;
    }

    /**
     * 清空所有多边形和标签（同时处理 polygonInfoList 与 currentPolygons）
     */
    function clearOverlays() {
        try {
            // 先移除 polygonInfoList 中记录的多边形与其DOM标签
            polygonInfoList.forEach(info => {
                if (info && info.polygon && map && map.removeOverLay) {
                    try { map.removeOverLay(info.polygon); } catch (e) { console.warn('移除多边形失败:', e); }
                }
                if (info && info.labelRef && info.labelRef.parentNode) {
                    try { info.labelRef.parentNode.removeChild(info.labelRef); } catch (e) { console.warn('移除DOM标签失败:', e); }
                    info.labelRef = null;
                }
            });

            // 再处理 currentPolygons（兼容旧路径与标签对象）
            currentPolygons.forEach(item => {
                if (item.polygon && map && map.removeOverLay) {
                    try { map.removeOverLay(item.polygon); } catch (e) { console.warn('移除多边形失败:', e); }
                }
                if (item.label) {
                    if (item.label.domElement && item.label.domElement.parentNode) {
                        try { item.label.domElement.parentNode.removeChild(item.label.domElement); } catch (e) { console.warn('移除DOM标签失败:', e); }
                    } else if (map && map.removeOverLay && !item.label.isDomLabel) {
                        try { map.removeOverLay(item.label); } catch (e) { console.warn('移除地图覆盖物标签失败:', e); }
                    }
                }
            });

            // 清空记录数组
            currentPolygons = [];
            polygonInfoList = [];

            console.log('已清空所有多边形和标签（保留事件监听器）');
        } catch (error) {
            console.error('清空覆盖物时出错:', error);
        }
    }

    // 其他辅助函数（保持不变）
    function bindMinimizeEvent() {
        const container = document.querySelector(".wkt-input-container");
        const btn = document.getElementById("minimizeBtn");
        const minIcon = btn?.querySelector(".min-icon");
        const restoreIcon = btn?.querySelector(".restore-icon");

        btn?.addEventListener("click", () => {
            const minimized = container.classList.toggle("minimized");
            if (minIcon && restoreIcon) {
                if (minimized) {
                    minIcon.style.display = "none";
                    restoreIcon.style.display = "";
                } else {
                    minIcon.style.display = "";
                    restoreIcon.style.display = "none";
                }
            }
        });
    }

    // 在脚本内部补充：页签切换（3个页签）
     function bindTabs() {
         const tabs = [
             { btn: document.getElementById('tabDrawBtn'), pane: document.getElementById('tabDraw'), key: 'draw' },
             { btn: document.getElementById('tabTrackBtn'), pane: document.getElementById('tabTrack'), key: 'track' },
             { btn: document.getElementById('tabSplitBtn'), pane: document.getElementById('tabSplit'), key: 'split' },
             { btn: document.getElementById('tabBatchBtn'), pane: document.getElementById('tabBatch'), key: 'batch' },
         ];
         if (tabs.some(t => !t.btn || !t.pane)) return;
         function activate(key) {
             tabs.forEach(t => {
                 const active = t.key === key;
                 t.btn.classList.toggle('active', active);
                 t.pane.classList.toggle('active', active);
             });
         }
         tabs.forEach(t => t.btn.addEventListener('click', () => activate(t.key)));
         activate('draw');
     }
    function updateParserStatus() {
        const el = document.getElementById('parserStatus');
        if (!el) return;
        const ok = (typeof Terraformer !== 'undefined' && Terraformer.WKT && typeof Terraformer.WKT.parse === 'function');
        if (ok) {
            el.textContent = 'Terraformer WKT Parser';
            el.style.color = '#2f8f2f';
        } else {
            el.textContent = '本地回退解析（仅支持POLYGON/MULTIPOLYGON）';
            el.style.color = '#c77d1e';
        }
    }
     function parseWkt(wkt) {
         wkt = wkt.trim();
         // 优先使用成熟库（Terraformer WKT Parser）
         if (typeof Terraformer !== 'undefined' && Terraformer.WKT && Terraformer.WKT.parse) {
             try {
                 return Terraformer.WKT.parse(wkt);
             } catch (e) {
                 console.warn('Terraformer解析失败，尝试本地回退解析:', e);
             }
         } else {
             // 不再提示“未加载”，由状态栏展示回退信息
         }
         // 回退解析：仅支持 POLYGON / MULTIPOLYGON
         const typeMatch = wkt.match(/^\s*(POLYGON|MULTIPOLYGON)\s*\(/i);
         if (!typeMatch) throw new Error('仅支持POLYGON/MULTIPOLYGON');
         const type = typeMatch[1].toUpperCase();
         const inner = wkt.substring(wkt.indexOf('('));
         if (type === 'POLYGON') {
             const coords = parsePolygonCoords(inner.replace(/^\(/, '').replace(/\)$/, ''));
             return { type: 'Polygon', coordinates: coords };
         } else {
             const trimmed = inner.replace(/^\(\(/, '').replace(/\)\)$/, '');
             const coords = parseMultiPolygonCoords(trimmed);
             return { type: 'MultiPolygon', coordinates: coords };
         }
     }

     function bindMultiSplitter() {
         const input = document.getElementById('multiInput');
         const output = document.getElementById('polyOutput');
         const splitBtn = document.getElementById('splitMultiBtn');
         const copyBtn = document.getElementById('copyPolysBtn');
         if (!input || !output || !splitBtn || !copyBtn) return;

         // 本地WKT序列化辅助
         function ringToText(ring) {
             if (!ring || !ring.length) return '()';
             const first = ring[0];
             const last = ring[ring.length - 1];
             const closed = (first[0] === last[0] && first[1] === last[1]) ? ring : ring.concat([[first[0], first[1]]]);
             return '(' + closed.map(pt => pt[0] + ' ' + pt[1]).join(', ') + ')';
         }
         function toWktPolygonCoords(coords) {
             return 'POLYGON(' + coords.map(ringToText).join(', ') + ')';
         }
         function toWktMulti(coords) {
             return 'MULTIPOLYGON(' + coords.map(poly => '(' + poly.map(ringToText).join(', ') + ')').join(', ') + ')';
         }

         function polygonsFromMulti(text) {
             const geo = parseWkt(text.trim());
             if (geo.type !== 'MultiPolygon') throw new Error('请输入有效的 MULTIPOLYGON WKT');
             const polys = geo.coordinates.map(rings => toWktPolygonCoords(rings));
             return polys;
         }
         splitBtn.addEventListener('click', () => {
             try {
                 const list = polygonsFromMulti(input.value.trim());
                 output.value = list.join('\n');
             } catch (e) {
                 alert('分割失败：' + e.message);
             }
         });
         copyBtn.addEventListener('click', async () => {
             const val = output.value.trim();
             if (!val) { alert('没有可复制的结果'); return; }
             try { await navigator.clipboard.writeText(val); alert('已复制到剪贴板'); } catch (e) { console.warn('复制失败', e); }
         });
     }

     function bindBatchGenerator() {
         const batchInput = document.getElementById('batchInput');
         const output = document.getElementById('multiOutput');
         const genBtn = document.getElementById('generateMultiBtn');
         const copyBtn = document.getElementById('copyMultiBtn');

         // 本地WKT序列化辅助（与分割器保持一致）
         function ringToText(ring) {
             if (!ring || !ring.length) return '()';
             const first = ring[0];
             const last = ring[ring.length - 1];
             const closed = (first[0] === last[0] && first[1] === last[1]) ? ring : ring.concat([[first[0], first[1]]]);
             return '(' + closed.map(pt => pt[0] + ' ' + pt[1]).join(', ') + ')';
         }
         function toWktMulti(coords) {
             return 'MULTIPOLYGON(' + coords.map(poly => '(' + poly.map(ringToText).join(', ') + ')').join(', ') + ')';
         }

         genBtn.addEventListener('click', () => {
             try {
                 const lines = batchInput.value.trim().split(/\n|;/).map(s => s.trim()).filter(Boolean);
                 if (lines.length === 0) throw new Error('请按每行或分号输入至少一个POLYGON');
                 const polygons = lines.map((line, idx) => {
                     const g = parseWkt(line);
                     if (g.type !== 'Polygon') throw new Error(`第${idx + 1}行不是有效的POLYGON WKT`);
                     return g;
                 });
                 const multiGeo = { type: 'MultiPolygon', coordinates: polygons.map(p => p.coordinates) };
                 output.value = toWktMulti(multiGeo.coordinates);
             } catch (e) {
                 alert('生成失败：' + e.message);
             }
         });

         copyBtn.addEventListener('click', async () => {
             const val = output.value.trim();
             if (!val) { alert('没有可复制的结果'); return; }
             try { await navigator.clipboard.writeText(val); alert('已复制到剪贴板'); } catch (e) { console.warn('复制失败', e); }
         });

     }

     function setExampleWkt() {
         const exampleWkt = "MULTIPOLYGON(" +
             "(" +
             "(116.35 39.93, 116.39 39.93, 116.39 39.90, 116.35 39.90, 116.35 39.93)," + // 外环
             "(116.36 39.92, 116.38 39.92, 116.38 39.91, 116.36 39.91, 116.36 39.92)" +  // 内环
             ")," +
             "(" +
             "(116.40 39.95, 116.43 39.97, 116.46 39.96, 116.49 39.98, 116.52 39.95, 116.55 39.93, 116.58 39.94, 116.61 39.92, 116.64 39.95, 116.40 39.95)" +
             ")" +
             ")";
         document.getElementById("wktTextarea").value = exampleWkt;
     }

     function parsePolygonCoords(coordStr) {
         const ringStrs = coordStr.split(/\)\s*,\s*\(/).map(s => s.replace(/[()]/g, '').trim());
         const rings = [];
         ringStrs.forEach(ringStr => {
             const pts = ringStr.split(/,\s*/).map(pointStr => {
                 const [lng, lat] = pointStr.split(/\s+/).map(Number);
                 if (isNaN(lng) || isNaN(lat)) throw new Error("坐标格式错误：" + pointStr);
                 return [lng, lat];
             });
             // 自动拆分：如果一个ring中包含多次回到起点（闭合），则拆分为多个环
             // 兼容用户将外环与内环错误地写在同一对括号中的情况
             let start = 0;
             while (start < pts.length) {
                 const startPt = pts[start];
                 let closeIdx = -1;
                 for (let i = start + 1; i < pts.length; i++) {
                     if (pts[i][0] === startPt[0] && pts[i][1] === startPt[1]) {
                         closeIdx = i;
                         break;
                     }
                 }
                 if (closeIdx === -1) {
                     // 未找到闭合：将剩余点视为一个环，并强制闭合
                     const ring = pts.slice(start);
                     if (ring.length && (ring[0][0] !== ring[ring.length - 1][0] || ring[0][1] !== ring[ring.length - 1][1])) {
                         ring.push([ring[0][0], ring[0][1]]);
                     }
                     rings.push(ring);
                     break;
                 } else {
                     const ring = pts.slice(start, closeIdx + 1);
                     rings.push(ring);
                     start = closeIdx + 1;
                 }
             }
         });
         return rings;
     }

     function parseMultiPolygonCoords(coordStr) {
         const polygonStrs = coordStr.split(/\)\s*\)\s*,\s*\(\s*\(/).map(s => s.replace(/[()]/g, '').trim());
         return polygonStrs.map(polygonStr => parsePolygonCoords(polygonStr));
     }

     function wgs84ToGcj02(lng, lat) {
         const x_PI = 3.14159265358979324 * 3000.0 / 180.0;
         const PI = 3.1415926535897932384626;
         const a = 6378245.0;
         const ee = 0.00669342162296594323;

         if (outOfChina(lng, lat)) return { lng, lat };

         let dlat = transformLat(lng - 105.0, lat - 35.0);
         let dlng = transformLng(lng - 105.0, lat - 35.0);
         const radlat = lat / 180.0 * PI;
         let magic = Math.sin(radlat);
         magic = 1 - ee * magic * magic;
         const sqrtmagic = Math.sqrt(magic);
         dlat = (dlat * 180.0) / ((a * (1 - ee)) / (magic * sqrtmagic) * PI);
         dlng = (dlng * 180.0) / (a / sqrtmagic * Math.cos(radlat) * PI);

         return { lng: lng + dlng, lat: lat + dlat };

         function outOfChina(lng, lat) {
             return (lng < 72.004 || lng > 137.8347) || (lat < 0.8293 || lat > 55.8271);
         }

         function transformLat(x, y) {
             let ret = -100.0 + 2.0 * x + 3.0 * y + 0.2 * y * y + 0.1 * x * y + 0.2 * Math.sqrt(Math.abs(x));
             ret += (20.0 * Math.sin(6.0 * x * PI) + 20.0 * Math.sin(2.0 * x * PI)) * 2.0 / 3.0;
             ret += (20.0 * Math.sin(y * PI) + 40.0 * Math.sin(y / 3.0 * PI)) * 2.0 / 3.0;
             ret += (160.0 * Math.sin(y / 12.0 * PI) + 320 * Math.sin(y * PI / 30.0)) * 2.0 / 3.0;
             return ret;
         }

         function transformLng(x, y) {
             let ret = 300.0 + x + 2.0 * y + 0.1 * x * x + 0.1 * x * y + 0.1 * Math.sqrt(Math.abs(x));
             ret += (20.0 * Math.sin(6.0 * x * PI) + 20.0 * Math.sin(2.0 * x * PI)) * 2.0 / 3.0;
             ret += (20.0 * Math.sin(x * PI) + 40.0 * Math.sin(x / 3.0 * PI)) * 2.0 / 3.0;
             ret += (150.0 * Math.sin(x / 12.0 * PI) + 300.0 * Math.sin(x / 30.0 * PI)) * 2.0 / 3.0;
             return ret;
         }
     }

     function gcj02ToWgs84(lng, lat) {
         const g = wgs84ToGcj02(lng, lat);
         return { lng: lng * 2 - g.lng, lat: lat * 2 - g.lat };
     }

     function bd09ToGcj02(bdLng, bdLat) {
         const x_PI = 3.14159265358979324 * 3000.0 / 180.0;
         const x = bdLng - 0.0065;
         const y = bdLat - 0.006;
         const z = Math.sqrt(x * x + y * y) - 0.00002 * Math.sin(y * x_PI);
         const theta = Math.atan2(y, x) - 0.000003 * Math.cos(x * x_PI);
         const ggLng = z * Math.cos(theta);
         const ggLat = z * Math.sin(theta);
         return { lng: ggLng, lat: ggLat };
     }

     function calculatePolygonBottomCenter(outerRing) {
         let minLat = Infinity;
         let bottomPoints = [];
         outerRing.forEach(point => {
             const lat = point[1];
             if (lat < minLat) {
                 minLat = lat;
                 bottomPoints = [point];
             } else if (lat === minLat) {
                 bottomPoints.push(point);
             }
         });

         const sumLng = bottomPoints.reduce((sum, point) => sum + point[0], 0);
         const centerLng = sumLng / bottomPoints.length;

         return { lng: centerLng, lat: minLat };
     }

     function fitBounds(geojson) {
         try {
             const allPoints = [];
             function collectPoints(coords) {
                 if (typeof coords[0] === 'number') {
                     allPoints.push(coords);
                 } else {
                     coords.forEach(coord => collectPoints(coord));
                 }
             }
             collectPoints(geojson.coordinates);

             if (allPoints.length === 0) return;

             const lats = allPoints.map(p => p[1]);
             const lngs = allPoints.map(p => p[0]);
             const minLng = Math.min(...lngs);
             const maxLng = Math.max(...lngs);
             const minLat = Math.min(...lats);
             const maxLat = Math.max(...lats);

             const sw = wgs84ToGcj02(minLng, minLat);
             const ne = wgs84ToGcj02(maxLng, maxLat);

             // 修复setViewport方法的使用，确保参数格式正确
             if (map && map.setViewport) {
                 map.setViewport([
                     new T.LngLat(sw.lng, sw.lat),
                     new T.LngLat(ne.lng, ne.lat)
                 ], { padding: [50, 50] });
             } else {
                 console.warn('地图对象或setViewport方法不可用');
             }
         } catch (error) {
             console.error('调整视图范围时出错:', error);
         }
     }
// 轨迹绘制与解析
    function bindTrackEvents() {
        const drawBtn = document.getElementById('drawTrackButton');
        const showPointsBtn = document.getElementById('showTrackPointsButton');
        const clearBtn = document.getElementById('clearTrackButton');
        const ta = document.getElementById('trackTextarea');
        if (!drawBtn || !showPointsBtn || !clearBtn || !ta) return;

        drawBtn.addEventListener('click', function(){
            try {
                const text = ta.value.trim();
                if (!text) { alert('请粘贴轨迹文本（时间戳,经度,纬度）'); return; }
                const points = parseTrackText(text);
                if (points.length < 2) { alert('有效轨迹点不足，至少需要两点'); return; }
                drawTrackFromPoints(points);
                fitViewportToTrack(points);
            } catch (e) {
                alert('绘制轨迹失败：' + (e && e.message ? e.message : e));
                console.error('绘制轨迹异常:', e);
            }
        });

        showPointsBtn.addEventListener('click', function(){
            try {
                const text = ta.value.trim();
                if (!text) { alert('请粘贴轨迹文本（时间戳,经度,纬度）'); return; }
                const points = parseTrackText(text);
                if (points.length === 0) { alert('未找到有效轨迹点'); return; }
                showTrackPoints(points);
                fitViewportToTrack(points);
            } catch (e) {
                alert('显示轨迹点失败：' + (e && e.message ? e.message : e));
                console.error('显示轨迹点异常:', e);
            }
        });

        clearBtn.addEventListener('click', function(){
            clearTrackOverlays();
            console.log('已清空轨迹');
        });
    }

    function showTrackPoints(points) {
        // 先移除旧轨迹（不影响轮廓）
        clearTrackOverlays(false);
        
        if (!map || !points || points.length === 0) {
            console.log('无轨迹点可显示');
            return;
        }
        
        console.log(`准备显示${points.length}个轨迹点`);
        
        // 使用批量处理和更小的图标来提高性能
        // 创建一个更小的红点SVG图标
        const smallRedDotIcon = new T.Icon({
            iconUrl: 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="1" height="1"><circle cx="0.5" cy="0.5" r="0.3" fill="%23FF0000"/></svg>',
            iconSize: new T.Point(1, 1),
            iconAnchor: new T.Point(0.5, 0.5)
        });
        
        // 优化批量添加点的速度
        const batchSize = 2000; // 增加每批处理的点数
        const concurrentBatches = 4; // 并发批次数量
        
        // 预创建点击事件处理函数，避免重复创建
        function createClickHandler(point, index) {
            return function() {
                const infoWindow = new T.InfoWindow({
                    content: `点${index + 1}<br/>经度: ${point.lng.toFixed(6)}<br/>纬度: ${point.lat.toFixed(6)}`,
                    offset: new T.Point(0, -20)
                });
                infoWindow.open(map, point);
            };
        }
        
        // 使用setTimeout实现更高效的批量添加，避免阻塞UI
        let currentIndex = 0;
        
        function addBatch() {
            if (currentIndex >= points.length) {
                console.log(`已显示${points.length}个轨迹点`);
                return;
            }
            
            // 添加当前批次的点
            const endIndex = Math.min(currentIndex + batchSize, points.length);
            const markersToAdd = [];
            
            // 先创建所有标记
            for (let i = currentIndex; i < endIndex; i++) {
                const point = points[i];
                const index = i;
                
                const marker = new T.Marker(point, {
                    icon: smallRedDotIcon
                });
                
                // 添加点击事件
                marker.addEventListener('click', createClickHandler(point, index));
                
                markersToAdd.push(marker);
            }
            
            // 批量添加到地图和数组
            markersToAdd.forEach(marker => {
                map.addOverLay(marker);
                currentTracks.push(marker);
            });
            
            currentIndex = endIndex;
            
            // 使用setTimeout而不是requestAnimationFrame，减少对渲染周期的依赖
            // 设置为0，将任务放入微任务队列，但允许UI有短暂的呼吸空间
            setTimeout(addBatch, 0);
        }
        
        // 启动批量添加
        addBatch();
    }
    
    // 恢复原始的clearTrackOverlays函数
    function clearTrackOverlays(resetArray = true){        
        try {
            currentTracks.forEach(pl => {
                if (pl && map && map.removeOverLay) {
                    try { map.removeOverLay(pl); } catch (e) { console.warn('移除轨迹失败:', e); }
                }
            });
            if (resetArray) currentTracks = [];
        } catch (e) {
            console.warn('清空轨迹时出错:', e);
        }
    }

    function parseTrackText(text){
        // 选择输入坐标系（优先使用轨迹页签专属选择器，若未设置则回退到绘制页签选择器）
        const coordSysEl = document.getElementById('trackCoordSysSelect') || document.getElementById('coordSysSelect');
        const coordSys = (coordSysEl && coordSysEl.value) || 'wgs84';
        const isHash = text.indexOf('#') !== -1;
        const items = isHash ? text.split('#') : text.split(/\r?\n/);
        const pts = [];
        for (let i=0;i<items.length;i++){
            const raw = items[i];
            if (!raw) continue;
            const line = raw.trim();
            if (!line) continue;
            const parts = line.split(',');
            if (parts.length < 3) continue;
            let lng = parseFloat((parts[isHash ? 0 : 1] || '').trim());
            let lat = parseFloat((parts[isHash ? 1 : 2] || '').trim());
            // 初步过滤：数值合法性与正常范围
            if (!isFinite(lng) || !isFinite(lat)) continue;
            if (lng === 0 || lat === 0) continue; // 丢弃0.0异常点
            if (lng < -180 || lng > 180 || lat < -90 || lat > 90) continue; // 超出经纬度范围丢弃

            // 将输入坐标转换为WGS84
            let w;
            if (coordSys === 'wgs84' || coordSys === 'cgcs2000') {
                w = { lng, lat };
            } else if (coordSys === 'gcj02') {
                w = gcj02ToWgs84(lng, lat);
            } else if (coordSys === 'bd09') {
                const g = bd09ToGcj02(lng, lat);
                w = gcj02ToWgs84(g.lng, g.lat);
            } else {
                w = { lng, lat };
            }
            // 转换结果兜底检查
            if (!isFinite(w.lng) || !isFinite(w.lat)) continue;
            if (w.lng < -180 || w.lng > 180 || w.lat < -90 || w.lat > 90) continue;

            // 使用WGS84坐标绘制到地图
            pts.push(new T.LngLat(w.lng, w.lat));
        }
        return pts;
    }

    function drawTrackFromPoints(points){
        // 先移除旧轨迹（不影响轮廓）
        clearTrackOverlays(false);
        const polyline = new T.Polyline(points, {
            color: '#FF3B30',
            weight: 1,
            opacity: 0.9
        });
        if (map) {
            map.addOverLay(polyline);
        }
        currentTracks.push(polyline);
    }

    function clearTrackOverlays(resetArray = true){
        try {
            currentTracks.forEach(pl => {
                if (pl && map && map.removeOverLay) {
                    try { map.removeOverLay(pl); } catch (e) { console.warn('移除轨迹失败:', e); }
                }
            });
            if (resetArray) currentTracks = [];
        } catch (e) {
            console.warn('清空轨迹时出错:', e);
        }
    }


    function fitViewportToTrack(points){
        try {
            if (!map || !map.setViewport || !points || !points.length) return;
            map.setViewport(points);
        } catch (e) {
            console.warn('轨迹视图居中失败:', e);
        }
    }

    // ========= 轨迹回放功能 =========
    let playbackState = { points: [], idx: 0, speed: 1, timer: null, running: false, marker: null, line: null, path: [] };

    function bindPlaybackControls(){
        const startBtn = document.getElementById('playbackStartBtn');
        const pauseBtn = document.getElementById('playbackPauseBtn');
        const stopBtn = document.getElementById('playbackStopBtn');
        const speedSel = document.getElementById('playbackSpeedSelect');
        const timeSlider = document.getElementById('playbackTimeSlider');
        const timeCursor = document.getElementById('playbackTimeCursor');
        const ta = document.getElementById('trackTextarea');
        if (!startBtn || !pauseBtn || !stopBtn || !speedSel) return;

        // 初始按钮状态
        updatePlaybackButtonsState('idle');

        startBtn.addEventListener('click', function(){
            try {
                const text = (ta && ta.value || '').trim();
                if (!text) { alert('请粘贴轨迹文本（时间戳,经度,纬度）'); return; }
                const pts = parseTrackTextWithTime(text);
                if (pts.length < 2) { alert('有效轨迹点不足，至少需要两点'); return; }
                startPlayback(pts);
                // 状态在startPlayback中已设置为playing
            } catch (e) {
                alert('开始回放失败：' + (e && e.message ? e.message : e));
                console.error('开始回放异常:', e);
            }
        });

        pauseBtn.addEventListener('click', function(){
            if (!playbackState.running) {
                // 继续
                playbackState.running = true;
                scheduleNext();
                updatePlaybackButtonsState('playing');
            } else {
                // 暂停
                if (playbackState.timer) { clearTimeout(playbackState.timer); playbackState.timer = null; }
                playbackState.running = false;
                updatePlaybackButtonsState('paused');
            }
        });

        stopBtn.addEventListener('click', function(){ 
            stopPlayback(); 
            updatePlaybackButtonsState('idle');
        });

        speedSel.addEventListener('change', function(){
            const v = parseFloat(speedSel.value);
            playbackState.speed = (isFinite(v) && v > 0) ? v : 1;
        });

        if (timeSlider) {
            timeSlider.addEventListener('input', function(){
                const ms = parseInt(timeSlider.value, 10);
                const txt = formatTimeForLabel(ms);
                if (timeCursor) timeCursor.textContent = txt;
            });
            timeSlider.addEventListener('change', function(){
                jumpToSliderTime();
            });
        }
    }

    function parseTrackTextWithTime(text){
        const coordSysEl = document.getElementById('trackCoordSysSelect') || document.getElementById('coordSysSelect');
        const coordSys = (coordSysEl && coordSysEl.value) || 'wgs84';
        const isHash = text.indexOf('#') !== -1;
        const items = isHash ? text.split('#') : text.split(/\r?\n/);
        const out = [];
        for (let i=0;i<items.length;i++){
            const raw = items[i];
            if (!raw) continue;
            const line = raw.trim();
            if (!line) continue;
            const parts = line.split(',');
            if (parts.length < 3) continue;
            const tsRaw = (parts[isHash ? 2 : 0] || '').trim();
            const ts = (tsRaw || '').replace(/\D/g,'');
            let lng = parseFloat((parts[isHash ? 0 : 1] || '').trim());
            let lat = parseFloat((parts[isHash ? 1 : 2] || '').trim());
            if (!isFinite(lng) || !isFinite(lat)) continue;
            if (lng === 0 || lat === 0) continue;
            if (lng < -180 || lng > 180 || lat < -90 || lat > 90) continue;
            const t = parseTimestamp(ts);
            if (!t) continue;
            let w;
            if (coordSys === 'wgs84' || coordSys === 'cgcs2000') {
                w = { lng, lat };
            } else if (coordSys === 'gcj02') {
                w = gcj02ToWgs84(lng, lat);
            } else if (coordSys === 'bd09') {
                const g = bd09ToGcj02(lng, lat);
                w = gcj02ToWgs84(g.lng, g.lat);
            } else { w = { lng, lat }; }
            if (!isFinite(w.lng) || !isFinite(w.lat)) continue;
            if (w.lng < -180 || w.lng > 180 || w.lat < -90 || w.lat > 90) continue;
            out.push({ ll: new T.LngLat(w.lng, w.lat), time: t, ts });
        }
        out.sort((a,b)=>a.time - b.time);
        return out;
    }

    function parseTimestamp(ts){
        const tstr = (ts || '').replace(/\D/g,'');
        const m = tstr && tstr.match(/^\d{14}$/);
        if (!m) return null;
        const y = parseInt(tstr.slice(0,4),10);
        const M = parseInt(tstr.slice(4,6),10) - 1;
        const d = parseInt(tstr.slice(6,8),10);
        const h = parseInt(tstr.slice(8,10),10);
        const m2 = parseInt(tstr.slice(10,12),10);
        const s = parseInt(tstr.slice(12,14),10);
        const dt = new Date(y,M,d,h,m2,s);
        return isNaN(dt.getTime()) ? null : dt;
    }

    function startPlayback(points){
        console.log('[Playback] startPlayback: 点数=', points && points.length);
        stopPlayback();
        playbackState.points = points;
        playbackState.idx = 0;
        playbackState.speed = playbackState.speed || 1;
        playbackState.running = true;
        // 配置时间滑动条，并尊重现有滑块位置作为起始
        configureTimeSlider(points);
        // 启用滑块
        const slider = document.getElementById('playbackTimeSlider');
        if (slider) slider.disabled = false;
        let initIdx = 0;
        if (slider && slider.min && slider.max) {
            const ms = parseInt(slider.value, 10);
            if (isFinite(ms)) initIdx = findIndexByTime(points, ms);
        }
        playbackState.idx = initIdx;
        const first = points[initIdx];
        console.log('[Playback] 首点:', first && first.ts, first && first.ll, 'initIdx=', initIdx);
        playbackState.path = points.slice(0, initIdx+1).map(p=>p.ll);
        playbackState.line = new T.Polyline(playbackState.path, { color: '#00FFFF', weight: 1, opacity: 0.9 });
        if (map) {
            map.addOverLay(playbackState.line);
        }
        currentTracks.push(playbackState.line);
        // 创建并定位DOM标记以保证可见移动
        ensurePlaybackDom(first.ll);
        updatePlaybackDom(first.ll);
        updatePlaybackTimeLabel(first.ts);
        try { fitViewportToTrack(points.map(p=>p.ll)); } catch(e){}
        // 更新按钮状态
        updatePlaybackButtonsState('playing');
        scheduleNext();
    }

    function scheduleNext(){
        if (!playbackState.running) return;
        if (!playbackState.points || playbackState.idx >= playbackState.points.length - 1) {
            playbackState.running = false;
            console.log('[Playback] 回放结束：idx=', playbackState.idx, '点数=', playbackState.points ? playbackState.points.length : 0);
            updatePlaybackButtonsState('idle'); // 播放结束后按钮回到初始状态：开始可点，继续/结束灰化
            return;
        }
        const next = playbackState.points[playbackState.idx+1];
        const speed = playbackState.speed || 1;
        const delay = Math.max(4, Math.round(1000 / speed)); // 1x=1000ms/点，2x=500ms/点...
        console.log('[Playback] scheduleNext: idx=', playbackState.idx, '->', playbackState.idx+1, 'delay=', delay, 'speed=', speed);
        playbackState.timer = setTimeout(()=>{
            playbackState.idx++;
            const nextLL = next.ll;
            console.log('[Playback] 下一点:', next && next.ts, nextLL);
            try {
                // 维护路径数组
                playbackState.path = playbackState.path || [];
                playbackState.path.push(nextLL);
                console.log('[Playback] 路径长度=', playbackState.path.length);
                // 使用DOM标记进行移动（容器/图层坐标）
                if (!playbackDom.el) console.log('[Playback] DOM标记不存在，将尝试创建');
                updatePlaybackDom(nextLL);
                // 折线更新：优先setLngLats，兜底重建
                if (playbackState.line && typeof playbackState.line.setLngLats === 'function') {
                    try { playbackState.line.setLngLats(playbackState.path); }
                    catch(e){
                        console.warn('[Playback] setLngLats失败，重建折线', e);
                        if (map) { try { map.removeOverLay(playbackState.line); } catch(e){} }
                        playbackState.line = new T.Polyline(playbackState.path, { color: '#00FFFF', weight: 1, opacity: 0.9 });
                        if (map) map.addOverLay(playbackState.line);
                    }
                } else {
                    console.log('[Playback] 折线不支持setLngLats，重建');
                    if (playbackState.line && map) { try { map.removeOverLay(playbackState.line); } catch(e){} }
                    playbackState.line = new T.Polyline(playbackState.path, { color: '#00FFFF', weight: 1, opacity: 0.9 });
                    if (map) map.addOverLay(playbackState.line);
                }
            } catch(e) { console.warn('更新回放覆盖物失败:', e); }
            updatePlaybackTimeLabel(next.ts);
            scheduleNext();
        }, delay);
    }

    function stopPlayback(){
        if (playbackState.timer) { clearTimeout(playbackState.timer); playbackState.timer = null; }
        playbackState.running = false;
        playbackState.idx = 0;
        try {
            // 移除DOM标记
            removePlaybackDom();
            if (playbackState.marker && map) map.removeOverLay(playbackState.marker);
            if (playbackState.line && map) map.removeOverLay(playbackState.line);
        } catch(e){}
        playbackState.marker = null;
        playbackState.line = null;
        updatePlaybackTimeLabel('—');
        // 按钮回到初始状态
        updatePlaybackButtonsState('idle');
    }

    function updatePlaybackTimeLabel(text){
        const el = document.getElementById('playbackTimeLabel');
        if (el) el.textContent = '时间：' + (text || '—');
    }

    // 时间滑动条：配置与跳转
    function configureTimeSlider(points){
        try {
            const slider = document.getElementById('playbackTimeSlider');
            const cursor = document.getElementById('playbackTimeCursor');
            if (!slider || !points || !points.length) return;
            const minMs = points[0].time.getTime();
            const maxMs = points[points.length - 1].time.getTime();
            const prev = parseInt(slider.value, 10);
            slider.min = String(minMs);
            slider.max = String(maxMs);
            slider.step = '1000'; // 以秒为步进
            let val = (isFinite(prev) && prev >= minMs && prev <= maxMs) ? prev : minMs;
            slider.value = String(val);
            if (cursor) cursor.textContent = formatTimeForLabel(val);
        } catch(e) { console.warn('配置时间滑动条失败:', e); }
    }
    function formatTimeForLabel(ms){
        if (!isFinite(ms)) return '—';
        const d = new Date(ms);
        const pad = n => String(n).padStart(2,'0');
        const y = d.getFullYear();
        const M = pad(d.getMonth()+1);
        const da = pad(d.getDate());
        const h = pad(d.getHours());
        const m = pad(d.getMinutes());
        const s = pad(d.getSeconds());
        return `${y}-${M}-${da} ${h}:${m}:${s}`;
    }
    function findIndexByTime(points, ms){
        try {
            if (!points || !points.length) return 0;
            const n = points.length;
            const minMs = points[0].time.getTime();
            const maxMs = points[n-1].time.getTime();
            if (!isFinite(ms)) return 0;
            if (ms <= minMs) return 0;
            if (ms >= maxMs) return n-1;
            let lo = 0, hi = n - 1, ans = 0;
            while (lo <= hi) {
                const mid = (lo + hi) >> 1;
                const t = points[mid].time.getTime();
                if (t < ms) { lo = mid + 1; ans = lo; }
                else { hi = mid - 1; ans = mid; }
            }
            return Math.max(0, Math.min(n-1, ans));
        } catch(e){ console.warn('findIndexByTime失败:', e); return 0; }
    }
    function jumpToSliderTime(){
        try {
            const slider = document.getElementById('playbackTimeSlider');
            if (!slider || !playbackState.points || !playbackState.points.length) return;
            const ms = parseInt(slider.value, 10);
            if (!isFinite(ms)) return;
            const idx = findIndexByTime(playbackState.points, ms);
            playbackState.idx = idx;
            const pts = playbackState.points;
            const ll = pts[idx].ll;
            playbackState.path = pts.slice(0, idx+1).map(p=>p.ll);
            // 更新折线
            try {
                if (playbackState.line && typeof playbackState.line.setLngLats === 'function') {
                    playbackState.line.setLngLats(playbackState.path);
                } else {
                    if (playbackState.line && map) { try { map.removeOverLay(playbackState.line); } catch(e){} }
                    playbackState.line = new T.Polyline(playbackState.path, { color: '#00FFFF', weight: 1, opacity: 0.9 });
                    if (map) map.addOverLay(playbackState.line);
                }
            } catch(e){ console.warn('滑块更新折线失败:', e); }
            // 更新标记与时间
            ensurePlaybackDom(ll);
            updatePlaybackDom(ll);
            updatePlaybackTimeLabel(pts[idx].ts);
            // 若正在播放，立即按新位置继续
            if (playbackState.running) {
                if (playbackState.timer) { clearTimeout(playbackState.timer); playbackState.timer = null; }
                scheduleNext();
            }
        } catch(e) { console.warn('滑块跳转失败:', e); }
    }

    // DOM标记：使用容器坐标实现可见移动
    let playbackDom = { el: null, lastLL: null, bound: false };

    function ensurePlaybackDom(ll){
        try {
            playbackDom.lastLL = ll;
            const pane = (map && map.getPanes && map.getPanes().overlayPane) || document.getElementById('mapContainer');
            if (!pane) { console.warn('未找到overlayPane或mapContainer'); return; }
            if (!playbackDom.el) {
                const el = document.createElement('div');
                el.id = 'playbackDomMarker';
                el.style.position = 'absolute';
                el.style.width = '0';
                el.style.height = '0';
                el.style.borderLeft = '3px solid transparent';
                el.style.borderRight = '3px solid transparent';
                el.style.borderBottom = '4px solid #2C64A7';
                el.style.borderTop = '0';
                el.style.transform = 'translate(-50%, -50%)';
                el.style.zIndex = '9999';
                // 添加伪元素来增强箭头效果
                el.style.clipPath = 'polygon(50% 0, 100% 100%, 0 100%)';
                pane.appendChild(el);
                playbackDom.el = el;
                console.log('[Playback] 创建DOM标记，父节点=', pane === document.getElementById('mapContainer') ? '#mapContainer' : 'overlayPane');
                bindPlaybackDomEvents();
            }
            updatePlaybackDom(ll);
        } catch(e) { console.warn('创建DOM标记失败:', e); }
    }

    function updatePlaybackDom(ll){
        try {
            playbackDom.lastLL = ll;
            if (!map || !playbackDom.el || !ll) { console.log('[Playback] update取消：map/el/ll缺失'); return; }
            let p;
            if (typeof map.lngLatToLayerPoint === 'function') {
                p = map.lngLatToLayerPoint(ll);
                console.log('[Playback] 使用layerPoint定位:', ll && ll.lng, ll && ll.lat, '=>', p && p.x, p && p.y);
            } else if (typeof map.lngLatToContainerPoint === 'function') {
                p = map.lngLatToContainerPoint(ll);
                console.log('[Playback] 使用containerPoint定位:', ll && ll.lng, ll && ll.lat, '=>', p && p.x, p && p.y);
            } else {
                console.warn('地图对象不支持lngLat到像素坐标转换');
                return;
            }
            playbackDom.el.style.left = p.x + 'px';
            playbackDom.el.style.top = p.y + 'px';
        } catch(e) { console.warn('更新DOM标记位置失败:', e); }
    }

    function bindPlaybackDomEvents(){
        if (playbackDom.bound) return;
        const updater = function(){
            try {
                if (!map || !playbackDom.el || !playbackDom.lastLL) return;
                let p;
                if (typeof map.lngLatToLayerPoint === 'function') {
                    p = map.lngLatToLayerPoint(playbackDom.lastLL);
                } else if (typeof map.lngLatToContainerPoint === 'function') {
                    p = map.lngLatToContainerPoint(playbackDom.lastLL);
                }
                if (!p) return;
                playbackDom.el.style.left = p.x + 'px';
                playbackDom.el.style.top = p.y + 'px';
            } catch(e){}
        };
        try {
            map.addEventListener('move', updater);
            map.addEventListener('zoom', updater);
            playbackDom.bound = true;
        } catch(e){}
    }

    function removePlaybackDom(){
        try {
            const el = playbackDom.el;
            playbackDom.lastLL = null;
            if (el && el.parentNode) el.parentNode.removeChild(el);
        } catch(e){}
        playbackDom.el = null;
        playbackDom.bound = false;
    }

</script>
</body>

</html>
